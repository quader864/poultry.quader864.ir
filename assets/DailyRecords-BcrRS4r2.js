import{c as K,r as o,j as e,X as oe,D as yt,d as be,A as Ue,L as G,C as Fe,e as Me,U as jt}from"./index-Dfm8v7ej.js";import{T as He}from"./terminal-El62Yd0f.js";import{C as Be}from"./code-Cz-X-tP-.js";import{P as ve}from"./package-CVn6tmlZ.js";import{S as Ye}from"./scale-BPmcQ8e1.js";import{C as kt}from"./chart-column-Ce_C-a0j.js";import{S as wt}from"./search-Dn7-SK0M.js";import{H as Ne}from"./history-Cu61MKP7.js";import{T as Ae}from"./trash-2-CPaVpvFj.js";import{C as qe}from"./calendar-BiSLq1V8.js";import{A as Nt}from"./arrow-up-right-m4QcI24d.js";import{P as At}from"./pen-line-D_Y1Rmdy.js";import{T as Oe}from"./trending-up-kJZdgiUt.js";import{u as Ce,s as Ct,m as St,a as It,i as Et,b as ce,g as ye,c as je,d as Pt,e as De,S as zt,f as W,h as Mt,j as Bt,k as Y,l as Ot,n as V,o as F,p as $,q as H,r as Ze,t as Xe,v as Je,w as Dt,x as Lt,y as Le,z as _t,A as _e,B as Tt,L as re,C as Kt,D as Wt,E as Se,F as Qe,R as Rt,G as Gt,H as Vt,Z as Ie,I as et,J as $t,K as Ut,M as Ft,N as Ht,O as ie,P as Yt,Q as tt,T as qt,U as Zt,V as Xt,W as Jt,X as Te,Y as at,_ as Qt,$ as st,a0 as ea,a1 as ta,a2 as T,a3 as aa,a4 as sa,a5 as ra,a6 as ia,a7 as la,a8 as Ke,a9 as rt,aa as it,ab as pe,ac as na,ad as me,ae as he,af as fe,ag as ge,ah as oa,ai as ca}from"./AreaChart-BOdwOr6u.js";import da from"./MovementForm-CKKhGg0y.js";import{C as xa}from"./clock-BmYM6Lvn.js";import{A as ua}from"./arrow-right-3TF_Vu5w.js";import{I as We}from"./info-KoxbNrkG.js";import{F as pa}from"./file-text-iiieCMsC.js";import{P as ma}from"./plus-C0UQRdeK.js";import{C as ha}from"./circle-check-VEIAJ82F.js";import"./droplets-XYTlFp_P.js";import"./wind-Cp8vbkoN.js";import"./thermometer-DEO5nHHu.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],ga=K("arrow-down-left",fa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],va=K("circle-stop",ba);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],ja=K("layout-list",ya);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Re=K("lock-open",ka);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Na=K("star",wa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],lt=K("table",Aa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Sa=K("upload",Ca);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],Ea=K("weight",Ia);var nt=t=>null;nt.displayName="Cell";var ot=(t,a,r)=>{var s=Ce();return(l,i)=>c=>{t==null||t(l,i,c),s(Ct({activeIndex:String(i),activeDataKey:a,activeCoordinate:l.tooltipPosition,activeGraphicalItemId:r}))}},ct=t=>{var a=Ce();return(r,s)=>l=>{t==null||t(r,s,l),a(St())}},dt=(t,a,r)=>{var s=Ce();return(l,i)=>c=>{t==null||t(l,i,c),s(It({activeIndex:String(i),activeDataKey:a,activeCoordinate:l.tooltipPosition,activeGraphicalItemId:r}))}},Ge=(t,a,r)=>{var s=r??t;if(!ce(s))return ye(s,a,0)},Pa=(t,a,r)=>{var s={},l=t.filter(Et),i=t.filter(d=>d.stackId==null),c=l.reduce((d,n)=>(d[n.stackId]||(d[n.stackId]=[]),d[n.stackId].push(n),d),s),x=Object.entries(c).map(d=>{var[n,u]=d,g=u.map(v=>v.dataKey),b=Ge(a,r,u[0].barSize);return{stackId:n,dataKeys:g,barSize:b}}),h=i.map(d=>{var n=[d.dataKey].filter(g=>g!=null),u=Ge(a,r,d.barSize);return{stackId:void 0,dataKeys:n,barSize:u}});return[...x,...h]};function Ve(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,s)}return r}function se(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?Ve(Object(r),!0).forEach(function(s){za(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function za(t,a,r){return(a=Ma(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function Ma(t){var a=Ba(t,"string");return typeof a=="symbol"?a:a+""}function Ba(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function Oa(t,a,r,s,l){var i=s.length;if(!(i<1)){var c=ye(t,r,0,!0),x,h=[];if(je(s[0].barSize)){var d=!1,n=r/i,u=s.reduce((p,f)=>p+(f.barSize||0),0);u+=(i-1)*c,u>=r&&(u-=(i-1)*c,c=0),u>=r&&n>0&&(d=!0,n*=.9,u=i*n);var g=(r-u)/2>>0,b={offset:g-c,size:0};x=s.reduce((p,f)=>{var j,k={stackId:f.stackId,dataKeys:f.dataKeys,position:{offset:b.offset+b.size+c,size:d?n:(j=f.barSize)!==null&&j!==void 0?j:0}},N=[...p,k];return b=N[N.length-1].position,N},h)}else{var v=ye(a,r,0,!0);r-2*v-(i-1)*c<=0&&(c=0);var m=(r-2*v-(i-1)*c)/i;m>1&&(m>>=0);var y=je(l)?Math.min(m,l):m;x=s.reduce((p,f,j)=>[...p,{stackId:f.stackId,dataKeys:f.dataKeys,position:{offset:v+(m+c)*j+(m-y)/2,size:y}}],h)}return x}}var Da=(t,a,r,s,l,i,c)=>{var x=ce(c)?a:c,h=Oa(r,s,l!==i?l:i,t,x);return l!==i&&h!=null&&(h=h.map(d=>se(se({},d),{},{position:se(se({},d.position),{},{offset:d.position.offset-l/2})}))),h},La=(t,a)=>{var r=Pt(a);if(!(!t||r==null||a==null)){var{stackId:s}=a;if(s!=null){var l=t[s];if(l){var{stackedData:i}=l;if(i)return i.find(c=>c.key===r)}}}};function _a(t,a){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&je(t.zIndex)?t.zIndex:a}var Ta="Invariant failed";function Ka(t,a){throw new Error(Ta)}function ke(){return ke=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},ke.apply(null,arguments)}function le(t){return o.createElement(zt,ke({shapeType:"rectangle",activeClassName:"recharts-active-bar"},t))}var Wa=function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s,l)=>{if(De(a))return a;var i=De(s)||ce(s);return i?a(s,l):(i||Ka(),r)}},Ra=(t,a,r)=>r,Ga=(t,a)=>a,ee=W([Xe,Ga],(t,a)=>t.filter(r=>r.type==="bar").find(r=>r.id===a)),Va=W([ee],t=>t==null?void 0:t.maxBarSize),$a=(t,a,r,s)=>s,Ua=W([Y,Xe,V,$,Ra],(t,a,r,s,l)=>a.filter(i=>t==="horizontal"?i.xAxisId===r:i.yAxisId===s).filter(i=>i.isPanorama===l).filter(i=>i.hide===!1).filter(i=>i.type==="bar")),Fa=(t,a,r)=>{var s=Y(t),l=V(t,a),i=$(t,a);if(!(l==null||i==null))return s==="horizontal"?Le(t,"yAxis",i,r):Le(t,"xAxis",l,r)},Ha=(t,a)=>{var r=Y(t),s=V(t,a),l=$(t,a);if(!(s==null||l==null))return r==="horizontal"?_e(t,"xAxis",s):_e(t,"yAxis",l)},Ya=W([Ua,_t,Ha],Pa),qa=(t,a,r)=>{var s,l,i=ee(t,a);if(i!=null){var c=V(t,a),x=$(t,a);if(!(c==null||x==null)){var h=Y(t),d=Je(t),{maxBarSize:n}=i,u=ce(n)?d:n,g,b;return h==="horizontal"?(g=F(t,"xAxis",c,r),b=H(t,"xAxis",c,r)):(g=F(t,"yAxis",x,r),b=H(t,"yAxis",x,r)),(s=(l=Ze(g,b,!0))!==null&&l!==void 0?l:u)!==null&&s!==void 0?s:0}}},xt=(t,a,r)=>{var s=Y(t),l=V(t,a),i=$(t,a);if(!(l==null||i==null)){var c,x;return s==="horizontal"?(c=F(t,"xAxis",l,r),x=H(t,"xAxis",l,r)):(c=F(t,"yAxis",i,r),x=H(t,"yAxis",i,r)),Ze(c,x)}},Za=W([Ya,Je,Dt,Lt,qa,xt,Va],Da),Xa=(t,a,r)=>{var s=V(t,a);if(s!=null)return F(t,"xAxis",s,r)},Ja=(t,a,r)=>{var s=$(t,a);if(s!=null)return F(t,"yAxis",s,r)},Qa=(t,a,r)=>{var s=V(t,a);if(s!=null)return H(t,"xAxis",s,r)},es=(t,a,r)=>{var s=$(t,a);if(s!=null)return H(t,"yAxis",s,r)},ts=W([Za,ee],(t,a)=>{if(!(t==null||a==null)){var r=t.find(s=>s.stackId===a.stackId&&a.dataKey!=null&&s.dataKeys.includes(a.dataKey));if(r!=null)return r.position}}),as=W([Fa,ee],La),ss=W([Mt,Bt,Xa,Ja,Qa,es,ts,Y,Ot,xt,as,ee,$a],(t,a,r,s,l,i,c,x,h,d,n,u,g)=>{var{chartData:b,dataStartIndex:v,dataEndIndex:m}=h;if(!(u==null||c==null||a==null||x!=="horizontal"&&x!=="vertical"||r==null||s==null||l==null||i==null||d==null)){var{data:y}=u,p;if(y!=null&&y.length>0?p=y:p=b==null?void 0:b.slice(v,m+1),p!=null)return Ms({layout:x,barSettings:u,pos:c,parentViewBox:a,bandSize:d,xAxis:r,yAxis:s,xAxisTicks:l,yAxisTicks:i,stackedData:n,displayedData:p,offset:t,cells:g,dataStartIndex:v})}}),rs=["index"];function we(){return we=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},we.apply(null,arguments)}function is(t,a){if(t==null)return{};var r,s,l=ls(t,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(l[r]=t[r])}return l}function ls(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var ut=o.createContext(void 0),ns=t=>{var a=o.useContext(ut);if(a!=null)return a.stackId;if(t!=null)return Tt(t)},os=(t,a)=>"recharts-bar-stack-clip-path-".concat(t,"-").concat(a),cs=t=>{var a=o.useContext(ut);if(a!=null){var{stackId:r}=a;return"url(#".concat(os(r,t),")")}},ds=t=>{var{index:a}=t,r=is(t,rs),s=cs(a);return o.createElement(re,we({className:"recharts-bar-stack-layer",clipPath:s},r))},xs=["onMouseEnter","onMouseLeave","onClick"],us=["value","background","tooltipPosition"],ps=["id"],ms=["onMouseEnter","onClick","onMouseLeave"];function _(){return _=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},_.apply(null,arguments)}function $e(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,s)}return r}function P(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?$e(Object(r),!0).forEach(function(s){hs(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function hs(t,a,r){return(a=fs(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function fs(t){var a=gs(t,"string");return typeof a=="symbol"?a:a+""}function gs(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function ne(t,a){if(t==null)return{};var r,s,l=bs(t,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(l[r]=t[r])}return l}function bs(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var vs=t=>{var{dataKey:a,name:r,fill:s,legendType:l,hide:i}=t;return[{inactive:i,dataKey:a,type:l,color:s,value:et(r,a),payload:t}]},ys=o.memo(t=>{var{dataKey:a,stroke:r,strokeWidth:s,fill:l,name:i,hide:c,unit:x,tooltipType:h,id:d}=t,n={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:r,strokeWidth:s,fill:l,dataKey:a,nameKey:void 0,name:et(i,a),hide:c,type:h,color:l,unit:x,graphicalItemId:d}};return o.createElement($t,{tooltipEntrySettings:n})});function js(t){var a=ie(at),{data:r,dataKey:s,background:l,allOtherBarProps:i}=t,{onMouseEnter:c,onMouseLeave:x,onClick:h}=i,d=ne(i,xs),n=ot(c,s,i.id),u=ct(x),g=dt(h,s,i.id);if(!l||r==null)return null;var b=Qt(l);return o.createElement(Ie,{zIndex:_a(l,Se.barBackground)},r.map((v,m)=>{var{value:y,background:p,tooltipPosition:f}=v,j=ne(v,us);if(!p)return null;var k=n(v,m),N=u(v,m),w=g(v,m),E=P(P(P(P(P({option:l,isActive:String(m)===a},j),{},{fill:"#eee"},p),b),st(d,v,m)),{},{onMouseEnter:k,onMouseLeave:N,onClick:w,dataKey:s,index:m,className:"recharts-bar-background-rectangle"});return o.createElement(le,_({key:"background-bar-".concat(m)},E))}))}function ks(t){var{showLabels:a,children:r,rects:s}=t,l=s==null?void 0:s.map(i=>{var c={x:i.x,y:i.y,width:i.width,lowerWidth:i.width,upperWidth:i.width,height:i.height};return P(P({},c),{},{value:i.value,payload:i.payload,parentViewBox:i.parentViewBox,viewBox:c,fill:i.fill})});return o.createElement(sa,{value:a?l:void 0},r)}function ws(t){var{shape:a,activeBar:r,baseProps:s,entry:l,index:i,dataKey:c}=t,x=ie(at),h=ie(ia),d=r&&String(i)===x&&(h==null||c===h),n=d?r:a;return d?o.createElement(Ie,{zIndex:Se.activeBar},o.createElement(le,_({},s,{name:String(s.name)},l,{isActive:d,option:n,index:i,dataKey:c}))):o.createElement(le,_({},s,{name:String(s.name)},l,{isActive:d,option:n,index:i,dataKey:c}))}function Ns(t){var{shape:a,baseProps:r,entry:s,index:l,dataKey:i}=t;return o.createElement(le,_({},r,{name:String(r.name)},s,{isActive:!1,option:a,index:l,dataKey:i}))}function As(t){var a,{data:r,props:s}=t,l=(a=ra(s))!==null&&a!==void 0?a:{},{id:i}=l,c=ne(l,ps),{shape:x,dataKey:h,activeBar:d}=s,{onMouseEnter:n,onClick:u,onMouseLeave:g}=s,b=ne(s,ms),v=ot(n,h,i),m=ct(g),y=dt(u,h,i);return r?o.createElement(o.Fragment,null,r.map((p,f)=>o.createElement(ds,_({index:f,key:"rectangle-".concat(p==null?void 0:p.x,"-").concat(p==null?void 0:p.y,"-").concat(p==null?void 0:p.value,"-").concat(f),className:"recharts-bar-rectangle"},st(b,p,f),{onMouseEnter:v(p,f),onMouseLeave:m(p,f),onClick:y(p,f)}),d?o.createElement(ws,{shape:x,activeBar:d,baseProps:c,entry:p,index:f,dataKey:h}):o.createElement(Ns,{shape:x,baseProps:c,entry:p,index:f,dataKey:h})))):null}function Cs(t){var{props:a,previousRectanglesRef:r}=t,{data:s,layout:l,isAnimationActive:i,animationBegin:c,animationDuration:x,animationEasing:h,onAnimationEnd:d,onAnimationStart:n}=a,u=r.current,g=ea(a,"recharts-bar-"),[b,v]=o.useState(!1),m=!b,y=o.useCallback(()=>{typeof d=="function"&&d(),v(!1)},[d]),p=o.useCallback(()=>{typeof n=="function"&&n(),v(!0)},[n]);return o.createElement(ks,{showLabels:m,rects:s},o.createElement(ta,{animationId:g,begin:c,duration:x,isActive:i,easing:h,onAnimationEnd:y,onAnimationStart:p,key:g},f=>{var j=f===1?s:s==null?void 0:s.map((k,N)=>{var w=u&&u[N];if(w)return P(P({},k),{},{x:T(w.x,k.x,f),y:T(w.y,k.y,f),width:T(w.width,k.width,f),height:T(w.height,k.height,f)});if(l==="horizontal"){var E=T(0,k.height,f),z=T(k.stackedBarStart,k.y,f);return P(P({},k),{},{y:z,height:E})}var C=T(0,k.width,f),S=T(k.stackedBarStart,k.x,f);return P(P({},k),{},{width:C,x:S})});return f>0&&(r.current=j??null),j==null?null:o.createElement(re,null,o.createElement(As,{props:a,data:j}))}),o.createElement(aa,{label:a.label}),a.children)}function Ss(t){var a=o.useRef(null);return o.createElement(Cs,{previousRectanglesRef:a,props:t})}var pt=0,Is=(t,a)=>{var r=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:r,errorVal:tt(t,a)}};class Es extends o.PureComponent{render(){var{hide:a,data:r,dataKey:s,className:l,xAxisId:i,yAxisId:c,needClip:x,background:h,id:d}=this.props;if(a||r==null)return null;var n=qt("recharts-bar",l),u=d;return o.createElement(re,{className:n,id:d},x&&o.createElement("defs",null,o.createElement(Zt,{clipPathId:u,xAxisId:i,yAxisId:c})),o.createElement(re,{className:"recharts-bar-rectangles",clipPath:x?"url(#clipPath-".concat(u,")"):void 0},o.createElement(js,{data:r,dataKey:s,background:h,allOtherBarProps:this.props}),o.createElement(Ss,this.props)))}}var Ps={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:pt,xAxisId:0,yAxisId:0,zIndex:Se.bar};function zs(t){var{xAxisId:a,yAxisId:r,hide:s,legendType:l,minPointSize:i,activeBar:c,animationBegin:x,animationDuration:h,animationEasing:d,isAnimationActive:n}=t,{needClip:u}=Ut(a,r),g=Ft(),b=Qe(),v=Ht(t.children,nt),m=ie(f=>ss(f,t.id,b,v));if(g!=="vertical"&&g!=="horizontal")return null;var y,p=m==null?void 0:m[0];return p==null||p.height==null||p.width==null?y=0:y=g==="vertical"?p.height/2:p.width/2,o.createElement(Yt,{xAxisId:a,yAxisId:r,data:m,dataPointFormatter:Is,errorBarOffset:y},o.createElement(Es,_({},t,{layout:g,needClip:u,data:m,xAxisId:a,yAxisId:r,hide:s,legendType:l,minPointSize:i,activeBar:c,animationBegin:x,animationDuration:h,animationEasing:d,isAnimationActive:n})))}function Ms(t){var{layout:a,barSettings:{dataKey:r,minPointSize:s},pos:l,bandSize:i,xAxis:c,yAxis:x,xAxisTicks:h,yAxisTicks:d,stackedData:n,displayedData:u,offset:g,cells:b,parentViewBox:v,dataStartIndex:m}=t,y=a==="horizontal"?x:c,p=n?y.scale.domain():null,f=Xt({numericAxis:y}),j=y.scale(f);return u.map((k,N)=>{var w,E,z,C,S,O;if(n){var M=n[N+m];if(M==null)return null;w=Jt(M,p)}else w=tt(k,r),Array.isArray(w)||(w=[f,w]);var I=Wa(s,pt)(w[1],N);if(a==="horizontal"){var L,[q,Z]=[x.scale(w[0]),x.scale(w[1])];E=Te({axis:c,ticks:h,bandSize:i,offset:l.offset,entry:k,index:N}),z=(L=Z??q)!==null&&L!==void 0?L:void 0,C=l.size;var de=q-Z;if(S=la(de)?0:de,O={x:E,y:g.top,width:C,height:g.height},Math.abs(I)>0&&Math.abs(S)<Math.abs(I)){var X=Ke(S||I)*(Math.abs(I)-Math.abs(S));z-=X,S+=X}}else{var[U,J]=[c.scale(w[0]),c.scale(w[1])];if(E=U,z=Te({axis:x,ticks:d,bandSize:i,offset:l.offset,entry:k,index:N}),C=J-U,S=l.size,O={x:g.left,y:z,width:g.width,height:S},Math.abs(I)>0&&Math.abs(C)<Math.abs(I)){var te=Ke(C||I)*(Math.abs(I)-Math.abs(C));C+=te}}if(E==null||z==null||C==null||S==null)return null;var xe=P(P({},k),{},{stackedBarStart:j,x:E,y:z,width:C,height:S,value:n?w:w[1],payload:k,background:O,tooltipPosition:{x:E+C/2,y:z+S/2},parentViewBox:v},b&&b[N]&&b[N].props);return xe}).filter(Boolean)}function Bs(t){var a=Wt(t,Ps),r=ns(a.stackId),s=Qe();return o.createElement(Rt,{id:a.id,type:"bar"},l=>o.createElement(o.Fragment,null,o.createElement(Gt,{legendPayload:vs(a)}),o.createElement(ys,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:l}),o.createElement(Vt,{type:"bar",id:l,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:r,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:s}),o.createElement(Ie,{zIndex:a.zIndex},o.createElement(zs,_({},a,{id:l})))))}var mt=o.memo(Bs,Kt);mt.displayName="Bar";var Os=["axis"],Ds=o.forwardRef((t,a)=>o.createElement(rt,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Os,tooltipPayloadSearcher:it,categoricalChartProps:t,ref:a})),Ls=["axis","item"],_s=o.forwardRef((t,a)=>o.createElement(rt,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Ls,tooltipPayloadSearcher:it,categoricalChartProps:t,ref:a}));const Ts=({onClose:t})=>e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3rem] shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(He,{size:28})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-slate-800 uppercase tracking-tighter",children:"Unified Movement Registry API"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:"Endpoint: /flocks/:flockId/cycles/:cycleId/movements"})]})]}),e.jsx("button",{onClick:t,className:"p-3 bg-slate-100 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-2xl transition-all shadow-sm",children:e.jsx(oe,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-10 space-y-12 no-scrollbar",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(yt,{className:"text-blue-500",size:24}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Core Schemas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-blue-400 mb-6 flex items-center gap-2",children:[e.jsx(Be,{size:12})," BIRD INFLOW (in)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-blue-300 leading-relaxed overflow-x-auto",children:`{
  "type": "in",
  "reason": "purchase",
  "birdMetrics": {
    "count": 5000,
    "ageAtMovement": 4,
    "breed": "Lohmann Brown"
  },
  "weightMetrics": {
    "startWeightGrams": 1200
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-amber-400 mb-6 flex items-center gap-2",children:[e.jsx(ve,{size:12})," RESOURCE INTAKE (feed)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-amber-300 leading-relaxed overflow-x-auto",children:`{
  "type": "feed",
  "date": "2024-03-20T10:00:00Z",
  "feedMetrics": {
    "consumedKg": 350,
    "purchasedKg": 1000,
    "feedType": "Starter",
    "supplier": "Cargill Node 4"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-emerald-400 mb-6 flex items-center gap-2",children:[e.jsx(Be,{size:12})," EGG COLLECTION"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-emerald-300 leading-relaxed overflow-x-auto",children:`{
  "type": "egg_collection",
  "reason": "daily_collection",
  "eggMetrics": {
    "count": 4850,
    "totalWeightKg": 291
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-6 flex items-center gap-2",children:[e.jsx(Ea,{size:12})," MASS SAMPLE (weight)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-indigo-300 leading-relaxed overflow-x-auto",children:`{
  "type": "weight",
  "weightMetrics": {
    "averageWeightGrams": 1890,
    "startWeightGrams": 1850,
    "endWeightGrams": 1920,
    "measurementMethod": "scale"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-50 rounded-[2.5rem] border border-slate-200",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-slate-500 mb-6 flex items-center gap-2",children:[e.jsx(Ye,{size:12})," MANUAL ADJUSTMENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-slate-700 leading-relaxed border border-slate-100 shadow-inner",children:`{
  "type": "adjustment",
  "reason": "inspection",
  "birdMetrics": {
    "count": -2
  },
  "notes": "Physical audit correction"
}`})]}),e.jsxs("div",{className:"p-8 bg-rose-50 rounded-[2.5rem] border border-rose-100",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-rose-500 mb-6 flex items-center gap-2",children:[e.jsx(be,{size:12})," MORTALITY EVENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-rose-700 leading-relaxed border border-rose-100 shadow-inner",children:`{
  "type": "mortality",
  "reason": "disease",
  "mortalityMetrics": {
    "count": 3
  },
  "notes": "Respiratory infection"
}`})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-[2.5rem] p-8 flex items-center gap-8 shadow-sm",children:[e.jsx(be,{size:48,className:"text-amber-600 shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-black text-amber-900 uppercase tracking-tight",children:"Security & Immutability"}),e.jsxs("p",{className:"text-[11px] font-medium text-amber-800 leading-relaxed",children:["All records once committed are assigned a ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"NODE_ID"})," and entered into the audit trail. Deletion requires an explicit ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"permanent=true"})," flag and high-level clearance."]})]})]})]}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end bg-white",children:e.jsx("button",{onClick:t,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all",children:"Close Documentation"})})]})}),Ks=({currentCycle:t,movementsCount:a,flockName:r,selectedCycleId:s,formatDate:l})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4 animate-in slide-in-from-top-4 duration-700",children:[e.jsxs("div",{className:"bg-slate-900 rounded-2xl lg:rounded-3xl p-4 lg:p-6 text-white border border-white/5 shadow-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 transition-transform duration-1000",children:e.jsx(Ue,{size:60})}),e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1",children:"Cycle Integrity"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black tracking-tighter uppercase",children:(t==null?void 0:t.status)||"N/A"}),e.jsxs("div",{className:"mt-2 lg:mt-3 flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(t==null?void 0:t.status)==="active"?"bg-emerald-500 animate-pulse":"bg-slate-500"}`}),e.jsxs("span",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400",children:["Since ",t?l(t.startDate):"---"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm group",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Total Logs"}),e.jsx("h4",{className:"text-2xl lg:text-3xl font-black text-slate-900 tabular-nums",children:a}),e.jsxs("p",{className:"text-[9px] lg:text-[10px] font-bold text-blue-600 mt-1 lg:mt-2",children:["ID: ",s]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Production Node"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black text-slate-900 uppercase truncate",children:r||"---"}),e.jsx("p",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400 mt-1 lg:mt-2 uppercase tracking-widest",children:"Fleet Active"})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm flex flex-col justify-between",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"System Health"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs lg:text-sm font-black text-slate-800 font-mono uppercase",children:"Nominal"}),e.jsx(be,{size:18,className:"text-emerald-500"})]})]})]}),Ws=({viewMode:t,setViewMode:a,searchTerm:r,setSearchTerm:s,selectedCycleId:l,onCycleChange:i,cycles:c,loadingCycles:x,onInitCycle:h,onEndCycle:d,onDeleteCycle:n,endingCycle:u,canEndCycle:g,onShowDocs:b,isRtl:v,t:m,userRole:y})=>e.jsx("div",{className:"p-4 lg:p-8 border-b border-slate-100 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"flex bg-white border border-slate-200 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>a("list"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="list"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(ja,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"List"})]}),e.jsxs("button",{onClick:()=>a("visual"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="visual"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(kt,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Visual"})]})]}),e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(wt,{className:`absolute ${v?"right-4":"left-4"} top-1/2 -translate-y-1/2 text-slate-400`,size:16}),e.jsx("input",{type:"text",placeholder:v?"جستجوی فید داده...":"Search stream...",className:`w-full ${v?"pr-10":"pl-10"} py-2.5 bg-white border border-slate-200 rounded-xl text-xs font-bold shadow-sm focus:ring-4 focus:ring-blue-500/10 outline-none`,value:r,onChange:p=>s(p.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-white border border-slate-200 rounded-xl px-3 py-1.5 shadow-sm gap-2 h-[42px] flex-1 min-w-[140px]",children:[e.jsx(Ne,{size:14,className:"text-slate-400 shrink-0"}),e.jsxs("select",{value:l,onChange:p=>i(p.target.value),className:"bg-transparent border-none text-[9px] font-black uppercase tracking-widest text-slate-700 outline-none cursor-pointer w-full",children:[e.jsx("option",{value:"",children:x?m.loading:m.selectCycle}),c.map(p=>e.jsxs("option",{value:p.cycleId,children:[p.cycleId," ",p.status==="active"?"• ACT":""]},p.cycleId))]}),x&&e.jsx(G,{size:12,className:"animate-spin text-blue-500 shrink-0"})]}),e.jsxs("button",{onClick:h,className:"h-[42px] px-4 bg-blue-600 text-white rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-600/20 transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest flex-1 min-w-[130px]",children:[e.jsx(Fe,{size:14})," ",m.initiateCycle]}),g&&e.jsxs("button",{onClick:d,disabled:u,className:"h-[42px] px-4 bg-rose-50 text-rose-600 border border-rose-100 rounded-xl hover:bg-rose-600 hover:text-white transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest flex-1 min-w-[110px]",children:[u?e.jsx(G,{size:12,className:"animate-spin"}):e.jsx(va,{size:14}),m.endCycle]}),y==="Admin"&&l&&e.jsxs("button",{onClick:n,disabled:u,className:"h-[42px] px-4 bg-white border border-rose-100 text-rose-500 rounded-xl hover:bg-rose-600 hover:text-white transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest flex-1 min-w-[110px]",children:[u?e.jsx(G,{size:12,className:"animate-spin"}):e.jsx(Ae,{size:14}),m.purgeCycle]}),e.jsxs("button",{onClick:b,className:"h-[42px] px-4 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest shadow-sm flex-1 sm:flex-none",children:[e.jsx(He,{size:14})," ",m.reference]})]})]})}),Rs=({level:t})=>{const a=t==="high"?3:t==="medium"?2:1;return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 text-amber-400",children:[...Array(3)].map((r,s)=>e.jsx(Na,{size:10,fill:s<a?"currentColor":"none",className:s<a?"":"text-slate-200"},s))}),e.jsx("span",{className:"text-[8px] font-black uppercase text-slate-400 tracking-widest",children:t})]})},Gs=({movements:t,formatDate:a,onEdit:r,onDelete:s,onLock:l,onUnlock:i,onViewHistory:c})=>{const x=n=>{var g,b,v,m,y,p,f,j,k,N;switch(n.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"adjustment":case"sale":return((g=n.birdMetrics)==null?void 0:g.count)??0;case"mortality":return((b=n.mortalityMetrics)==null?void 0:b.count)??((v=n.birdMetrics)==null?void 0:v.count)??0;case"egg_collection":case"egg_breakage":return((m=n.eggMetrics)==null?void 0:m.count)??0;case"weight_measurement":case"weight":return((y=n.weightMetrics)==null?void 0:y.averageWeightGrams)??((p=n.weightMetrics)==null?void 0:p.grams)??((f=n.weightMetrics)==null?void 0:f.startWeightGrams)??((j=n.weightMetrics)==null?void 0:j.endWeightGrams)??0;case"feed_consumption":case"feed":return((k=n.feedMetrics)==null?void 0:k.consumedKg)??((N=n.feedMetrics)==null?void 0:N.purchasedKg)??0;default:return 0}},h=n=>{switch(n.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"mortality":case"sale":case"adjustment":return"Birds";case"egg_collection":case"egg_breakage":return"Eggs";case"weight_measurement":case"weight":return"Grams";case"feed_consumption":case"feed":return"KG";default:return""}},d=n=>{const u=n.type.toLowerCase();return u==="in"?"Bird Inflow":u==="out"?"Bird Outflow":u==="weight"?"Mass Sample":u==="feed"?"Resource Intake":n.type.replace(/_/g," ")};return e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full text-left text-sm border-collapse min-w-[1100px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/80 text-slate-400 font-black border-b border-slate-200 uppercase tracking-[0.2em] text-[9px] lg:text-[10px]",children:[e.jsx("th",{className:"px-6 py-4 w-20 text-center",children:"Vector"}),e.jsx("th",{className:"px-6 py-4",children:"Event Time"}),e.jsx("th",{className:"px-6 py-4",children:"Type / Reason"}),e.jsx("th",{className:"px-6 py-4",children:"Quantity"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Consensus"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50 bg-white",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-24 text-center opacity-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(qe,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Registry Empty"})]})})}):t.map(n=>{var u;return e.jsxs("tr",{className:`hover:bg-blue-50/10 transition-all group ${n.locked?"bg-slate-50/30":""}`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`w-10 h-10 mx-auto rounded-xl flex items-center justify-center transition-transform group-hover:scale-110 ${n.type==="bird_inflow"||n.type==="in"||n.type==="egg_collection"?"bg-emerald-50 text-emerald-600":n.type==="mortality"||n.type==="egg_breakage"||n.type==="bird_outflow"||n.type==="out"?"bg-rose-50 text-rose-600":n.type==="weight"||n.type==="weight_measurement"?"bg-blue-50 text-blue-600":n.type==="feed"||n.type==="feed_consumption"?"bg-amber-50 text-amber-600":"bg-slate-50 text-slate-500"}`,children:n.type==="bird_inflow"||n.type==="in"||n.type==="egg_collection"?e.jsx(ga,{size:18}):e.jsx(Nt,{size:18})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-xs font-black text-slate-900",children:a(n.date)}),e.jsxs("div",{className:"text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-0.5 font-mono",children:["NODE ID: ",n._id.slice(-6).toUpperCase()]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[7px] font-black uppercase tracking-widest self-start",children:d(n)}),e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-tight ml-1",children:((u=n.reason)==null?void 0:u.replace(/_/g," "))||"standard"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-end gap-1",children:[e.jsx("span",{className:"text-base font-black text-slate-900 tabular-nums",children:x(n).toLocaleString()}),e.jsx("span",{className:"text-[8px] font-bold text-slate-400 uppercase mb-1",children:h(n)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Rs,{level:n.confidence})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${n.locked?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:n.locked?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:10})," Locked"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:10})," Editable"]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(n),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all",title:"View Audit Trail",children:e.jsx(Ne,{size:16})}),!n.locked&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(n),className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all",title:"Edit Metrics",children:e.jsx(At,{size:16})}),e.jsx("button",{onClick:()=>s(n),className:"p-2 text-rose-600 hover:bg-rose-50 rounded-lg transition-all",title:"Soft Delete",children:e.jsx(Ae,{size:16})})]}),e.jsx("button",{onClick:()=>n.locked?i(n):l(n),className:`p-2 rounded-lg transition-all ${n.locked?"text-amber-600 hover:bg-amber-50":"text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,title:n.locked?"Request Unlock":"Verify & Lock",children:n.locked?e.jsx(Me,{size:16}):e.jsx(Re,{size:16})})]})})]},n._id)})})]})})},Vs=({loading:t,data:a})=>{if(t)return e.jsxs("div",{className:"h-[300px] flex flex-col items-center justify-center gap-4 opacity-40",children:[e.jsx(G,{size:32,className:"animate-spin text-blue-600"}),e.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.4em]",children:"Compiling Analytics..."})]});const r=a.weights&&a.weights.length>0,s=a.eggs&&a.eggs.length>0,l=a.feed&&a.feed.length>0;return e.jsx("div",{className:"p-6 lg:p-14 space-y-8 lg:space-y-14 animate-in fade-in duration-700",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-3xl p-6 lg:p-10 shadow-sm group min-h-[400px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-2xl group-hover:rotate-6 transition-transform",children:e.jsx(Ye,{size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-black text-slate-900 uppercase tracking-tight",children:"Mass Velocity"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Weight Growth (G)"})]})]}),e.jsx(Oe,{size:20,className:"text-emerald-500"})]}),e.jsx("div",{className:"flex-1 min-h-[250px] w-full relative",children:r?e.jsx(pe,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(na,{data:a.weights,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"massCurve",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.15}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(me,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(he,{dataKey:"date",hide:!0}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:9,fontWeight:900,fill:"#94a3b8"}}),e.jsx(ge,{contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 10px 25px -5px rgb(0 0 0 / 0.1)"}}),e.jsx(oa,{type:"monotone",dataKey:"grams",stroke:"#3b82f6",strokeWidth:4,fillOpacity:1,fill:"url(#massCurve)",animationDuration:1e3})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-slate-300 text-[10px] font-black uppercase tracking-widest",children:"Awaiting Data"})})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-3xl p-6 lg:p-10 shadow-sm group min-h-[400px] flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-8 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl group-hover:scale-110 transition-transform",children:e.jsx(Oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-black text-slate-900 uppercase tracking-tight",children:"Yield Efficiency"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Egg Collection Yield"})]})]})}),e.jsx("div",{className:"flex-1 min-h-[250px] w-full relative",children:s?e.jsx(pe,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(_s,{data:a.eggs,children:[e.jsx(me,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(he,{dataKey:"date",hide:!0}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:9,fontWeight:900,fill:"#94a3b8"}}),e.jsx(ge,{contentStyle:{borderRadius:"16px",border:"none"}}),e.jsx(mt,{dataKey:"count",fill:"#10b981",radius:[4,4,0,0],animationDuration:1e3})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-slate-300 text-[10px] font-black uppercase tracking-widest",children:"Awaiting Data"})})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2rem] lg:rounded-[3.5rem] p-8 lg:p-12 xl:col-span-2 shadow-2xl relative overflow-hidden min-h-[400px] flex flex-col",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 text-white",children:e.jsx(ve,{size:120})}),e.jsxs("div",{className:"flex items-center gap-5 mb-10 relative z-10 shrink-0",children:[e.jsx("div",{className:"p-4 bg-white/10 text-white rounded-2xl",children:e.jsx(ve,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-white uppercase tracking-tight",children:"Resource Drain Matrix"}),e.jsx("p",{className:"text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] mt-1",children:"Consolidated Feed Intake (KG)"})]})]}),e.jsx("div",{className:"flex-1 min-h-[300px] relative z-10 w-full",children:l?e.jsx(pe,{width:"100%",height:"100%",minWidth:0,minHeight:0,children:e.jsxs(Ds,{data:a.feed,children:[e.jsx(me,{strokeDasharray:"3 3",vertical:!1,stroke:"#ffffff10"}),e.jsx(he,{dataKey:"date",hide:!0}),e.jsx(fe,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#64748b"}}),e.jsx(ge,{contentStyle:{backgroundColor:"#0f172a",borderRadius:"16px",border:"1px solid #1e293b",color:"white"},itemStyle:{color:"#60a5fa",fontWeight:900}}),e.jsx(ca,{type:"stepAfter",dataKey:"consumedKg",stroke:"#3b82f6",strokeWidth:4,dot:{r:6,fill:"#3b82f6",strokeWidth:3,stroke:"#0f172a"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-slate-700 text-[10px] font-black uppercase tracking-widest",children:"Awaiting Data Feed"})})]})]})})},$s=({movement:t,flockId:a,onClose:r,api:s})=>{const[l,i]=o.useState([]),[c,x]=o.useState(!0);o.useEffect(()=>{(async()=>{try{const n=t.flockId||a;if(!n||n==="all"){i([]),x(!1);return}const u=await s.getMovementHistory(n,t.cycleId,t._id);let g=[];u&&Array.isArray(u.history)?g=u.history:u&&Array.isArray(u.data)?g=u.data:Array.isArray(u)&&(g=u),i(g)}catch(n){console.error("Audit history inaccessible",n),i([])}finally{x(!1)}})()},[t._id,a,t.cycleId,s,t.flockId]);const h=Array.isArray(l)?l:[];return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Ne,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Audit Trail"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mt-1",children:["Ref: ",t._id.slice(-8).toUpperCase()]})]})]}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-xl transition-all shadow-sm",children:e.jsx(oe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 no-scrollbar",children:c?e.jsxs("div",{className:"py-20 flex flex-col items-center gap-4 opacity-40",children:[e.jsx(G,{className:"animate-spin text-blue-600",size:32}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Querying Node History..."})]}):h.length===0?e.jsxs("div",{className:"py-20 text-center flex flex-col items-center gap-4 opacity-30",children:[e.jsx(Ue,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"No revision history found"})]}):e.jsxs("div",{className:"space-y-8 relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-px bg-slate-100"}),h.map((d,n)=>e.jsxs("div",{className:"relative pl-14 group",children:[e.jsx("div",{className:"absolute left-[21px] top-0 w-2.5 h-2.5 rounded-full bg-slate-200 border-2 border-white group-hover:bg-blue-500 transition-colors"}),e.jsxs("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 group-hover:bg-white group-hover:border-blue-200 group-hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[8px] font-black uppercase tracking-widest",children:d.action}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-slate-50",children:[e.jsx(xa,{size:12,className:"text-slate-400"})," ",new Date(d.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-blue-600 uppercase",children:[e.jsx(jt,{size:12})," ",d.userName||"Operator"]})]}),d.changes&&Array.isArray(d.changes)&&d.changes.length>0&&e.jsx("div",{className:"space-y-3 pt-3 border-t border-slate-100",children:d.changes.map((u,g)=>e.jsxs("div",{className:"flex items-center gap-3 text-[11px] font-medium",children:[e.jsx("span",{className:"text-slate-400 font-black uppercase tracking-tighter w-24 truncate",children:u.field}),e.jsx("span",{className:"text-rose-500 line-through opacity-50",children:String(u.oldValue)}),e.jsx(ua,{size:10,className:"text-slate-300"}),e.jsx("span",{className:"text-emerald-600 font-black",children:String(u.newValue)})]},g))})]})]},n))]})}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em]",children:"Close View"})})]})})},Us=({flockId:t,onClose:a,onSuccess:r,api:s,t:l,isRtl:i})=>{const[c,x]=o.useState(new Date().getFullYear()),[h,d]=o.useState(1),[n,u]=o.useState(!1),[g,b]=o.useState(""),v=async m=>{if(m.preventDefault(),!t||t==="all")return b("Please select a valid flock first.");u(!0),b("");try{await s.createCycle(t,{year:c,n:h}),r()}catch(y){b(y.message||"Provisioning failed")}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-300",dir:i?"rtl":"ltr",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Fe,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-slate-900 uppercase tracking-tighter",children:i?"شروع دوره جدید":"Initiate New Cycle"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:"Lifecycle Provisioning Protocol"})]})]}),e.jsx("button",{onClick:a,className:"p-2 text-slate-400 hover:text-rose-500 transition-colors",children:e.jsx(oe,{size:24})})]}),e.jsxs("form",{onSubmit:v,className:"p-8 space-y-8",children:[g&&e.jsxs("div",{className:"p-4 bg-rose-50 border border-rose-100 rounded-2xl text-rose-600 text-xs font-black uppercase flex items-center gap-3",children:[e.jsx(We,{size:16})," ",g]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:i?"سال شمسی":"Calendar Year"}),e.jsx("input",{type:"number",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-lg font-black tabular-nums focus:ring-8 focus:ring-blue-500/5 outline-none",value:c,onChange:m=>x(Number(m.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:i?"شماره دوره (N)":"Sequence No (N)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-lg font-black tabular-nums focus:ring-8 focus:ring-blue-500/5 outline-none",value:h,onChange:m=>d(Number(m.target.value))})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 p-5 rounded-[1.5rem] flex items-start gap-4",children:[e.jsx(We,{className:"text-blue-600 shrink-0",size:20}),e.jsx("p",{className:"text-[11px] font-medium text-blue-700 leading-relaxed",children:i?"شناسه دوره به صورت ترکیبی (سال-شماره) در سیستم ثبت می‌شود. شروع دوره جدید به صورت خودکار باعث فعال‌سازی تله‌متری می‌شود.":"Cycle ID will be registered as (Year-N). Initiating a new cycle activates node telemetry automatically."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 py-4 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-slate-600",children:i?"انصراف":"Cancel"}),e.jsx("button",{disabled:n,type:"submit",className:"flex-[2] py-4 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition-all flex items-center justify-center gap-3",children:n?e.jsx(G,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:16})," Confirm Activation"]})})]})]})]})})},Fs=({flockId:t,cycleId:a,onClose:r,onSuccess:s,api:l})=>{const[i,c]=o.useState([]),[x,h]=o.useState(!1),[d,n]=o.useState(""),u=o.useRef(null),g=m=>{var f;const y=(f=m.target.files)==null?void 0:f[0];if(!y)return;const p=new FileReader;p.onload=j=>{var z;const N=((z=j.target)==null?void 0:z.result).split(`
`),w=N[0].split(",").map(C=>C.trim()),E=N.slice(1).filter(C=>C.trim()).map(C=>{const S=C.split(",").map(M=>M.trim()),O={type:"weight_measurement",confidence:"high"};return w.forEach((M,I)=>{M==="weight"&&(O.weightMetrics={averageWeightGrams:parseFloat(S[I])}),M==="date"&&(O.date=S[I]),M==="count"&&(O.birdMetrics={count:parseInt(S[I])})}),O});c([...i,...E])},p.readAsText(y)},b=()=>{c([...i,{date:new Date().toISOString().split("T")[0],type:"weight_measurement",weightMetrics:{averageWeightGrams:0}}])},v=async()=>{if(i.length!==0){h(!0);try{await l.submitBulkMovement(t,a,i),s()}catch(m){n(m.message||"Bulk ingestion protocol failed")}finally{h(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[250] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3.5rem] shadow-2xl w-full max-w-6xl max-h-[85vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-10 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-xl",children:e.jsx(lt,{size:32})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tighter",children:"Bulk Ingestion Engine"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] mt-2",children:["Node Proxy: ",t.slice(-8).toUpperCase()," • Cycle: ",a]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{var m;return(m=u.current)==null?void 0:m.click()},className:"px-6 py-3 bg-white border border-slate-200 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-50 transition-all flex items-center gap-2",children:[e.jsx(Sa,{size:14})," Import CSV"]}),e.jsx("input",{type:"file",ref:u,className:"hidden",accept:".csv",onChange:g}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 text-slate-400 hover:text-rose-500 rounded-2xl transition-all",children:e.jsx(oe,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-10 no-scrollbar",children:i.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-6 opacity-40",children:[e.jsx(pa,{size:80,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-black uppercase tracking-[0.2em]",children:"Buffer Ready"}),e.jsx("p",{className:"text-sm font-bold uppercase mt-2",children:"Upload CSV or add rows manually to begin batch logging"})]})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100",children:[e.jsx("th",{className:"pb-4 px-4",children:"Effective Date"}),e.jsx("th",{className:"pb-4 px-4",children:"Metric Value"}),e.jsx("th",{className:"pb-4 px-4",children:"Confidence"}),e.jsx("th",{className:"pb-4 px-4 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:i.map((m,y)=>{var p;return e.jsxs("tr",{className:"group hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"date",value:m.date,onChange:f=>{const j=[...i];j[y].date=f.target.value,c(j)},className:"bg-transparent font-bold text-sm outline-none focus:text-blue-600"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"number",value:((p=m.weightMetrics)==null?void 0:p.averageWeightGrams)||0,onChange:f=>{const j=[...i];j[y].weightMetrics={averageWeightGrams:parseFloat(f.target.value)},c(j)},className:"bg-transparent font-black text-sm outline-none focus:text-blue-600 tabular-nums"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("select",{value:m.confidence,onChange:f=>{const j=[...i];j[y].confidence=f.target.value,c(j)},className:"bg-transparent text-[10px] font-black uppercase tracking-widest outline-none",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("button",{onClick:()=>c(i.filter((f,j)=>j!==y)),className:"p-2 text-slate-300 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Ae,{size:16})})})]},y)})})]})}),e.jsxs("div",{className:"p-10 border-t border-slate-100 flex items-center justify-between bg-slate-50/30",children:[e.jsxs("button",{onClick:b,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(ma,{size:16})," Append Data Row"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:r,className:"px-10 py-5 bg-white border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-widest text-slate-400",children:"Discard Batch"}),e.jsx("button",{disabled:x||i.length===0,onClick:v,className:"px-14 py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl hover:bg-black transition-all flex items-center gap-3",children:x?e.jsx(G,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{size:18})," Commit Batch (",i.length,")"]})})]})]})]})})},gr=({movements:t,userRole:a,capabilities:r,t:s,api:l,selectedFlockId:i,flocks:c,selectedCycleId:x,onCycleChange:h,onRefresh:d})=>{var ze;const[n,u]=o.useState("list"),[g,b]=o.useState(""),[v,m]=o.useState(!1),[y,p]=o.useState(!1),[f,j]=o.useState(!1),[k,N]=o.useState([]),[w,E]=o.useState(!1),[z,C]=o.useState(!1),[S,O]=o.useState(null),[M,I]=o.useState(null),[L,q]=o.useState(""),[Z,de]=o.useState(!1),[X,U]=o.useState(null),[J,te]=o.useState(null),[xe,ht]=o.useState({weights:[],feed:[],eggs:[]}),[ft,Ee]=o.useState(!1),R=s.langToggle==="EN",ue=async()=>{if(i&&i!=="all"){E(!0);try{const B=((await l.getCycles(i)).cycles||[]).sort((D,Q)=>Q.cycleId.localeCompare(D.cycleId));if(N(B),!x&&B.length>0){const D=B.find(Q=>Q.status==="active")||B[0];h(D.cycleId)}}catch(A){console.error("Failed to load cycles",A)}finally{E(!1)}}else N([])};o.useEffect(()=>{ue()},[i,l]),o.useEffect(()=>{(async()=>{if(n==="visual"&&i!=="all"&&x){Ee(!0);try{const[B,D,Q]=await Promise.all([l.getWeights(i,x).catch(()=>({weights:[]})),l.getFeed(i,x).catch(()=>({feed:[]})),l.getEggs(i,x).catch(()=>({eggs:[]}))]);ht({weights:B.weights||[],feed:D.feed||[],eggs:Q.eggs||[]})}catch(B){console.error("Visual sync failed",B)}finally{Ee(!1)}}})()},[n,i,x,l]);const gt=async()=>{if(!(!x||!i||i==="all")&&window.confirm(R?"آیا از اتمام این دوره اطمینان دارید؟":"Are you sure you want to end this cycle?")){C(!0);try{await l.updateCycleStatus(i,x,"ended"),await ue(),d()}catch(A){alert(A.message)}finally{C(!1)}}},bt=async()=>{if(!M||!L)return;const{movement:A,type:B}=M;try{const D=A.flockId||i;B==="lock"?await l.lockMovement(D,A.cycleId,A._id,L):await l.unlockMovement(D,A.cycleId,A._id,L),d(),I(null),q("")}catch(D){alert(D.message)}},Pe=A=>new Date(A).toLocaleDateString(R?"fa-IR":"en-US",{timeZone:"Asia/Tehran"}),ae=k.find(A=>A.cycleId===x),vt=(ze=c.find(A=>A._id===i))==null?void 0:ze.name;return e.jsxs("div",{className:"flex flex-col h-full gap-4 lg:gap-6 animate-in fade-in duration-500",dir:R?"rtl":"ltr",children:[i!=="all"&&x&&e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(Ks,{currentCycle:ae,movementsCount:t.length,flockName:vt,selectedCycleId:x,isRtl:R,formatDate:Pe}),e.jsxs("button",{onClick:()=>j(!0),className:"px-6 py-4 bg-slate-900 text-white rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 hover:bg-black transition-all",children:[e.jsx(lt,{size:16})," ",s.bulkIngestion]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[1.5rem] lg:rounded-[2.5rem] overflow-hidden shadow-sm flex flex-col h-full relative",children:[e.jsx(Ws,{viewMode:n,setViewMode:u,searchTerm:g,setSearchTerm:b,selectedCycleId:x,onCycleChange:h,cycles:k,loadingCycles:w,onInitCycle:()=>p(!0),onEndCycle:gt,onDeleteCycle:()=>{},endingCycle:z,canEndCycle:(ae==null?void 0:ae.status)==="active",onShowDocs:()=>m(!0),isRtl:R,t:s,userRole:a}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto no-scrollbar",children:n==="list"?e.jsx(Gs,{movements:t,formatDate:Pe,onEdit:U,onDelete:O,onLock:A=>I({movement:A,type:"lock"}),onUnlock:A=>I({movement:A,type:"unlock"}),onViewHistory:te,userRole:a,capabilities:r}):e.jsx(Vs,{loading:ft,data:xe})})]}),f&&e.jsx(Fs,{flockId:i,cycleId:x,onClose:()=>j(!1),onSuccess:()=>{j(!1),d()},api:l}),y&&e.jsx(Us,{flockId:i,onClose:()=>p(!1),onSuccess:()=>{p(!1),ue(),d()},api:l,t:s,isRtl:R}),X&&e.jsx(da,{onClose:()=>U(null),onSubmit:()=>{U(null),d()},flocks:c,t:s,api:l,onCreateFlock:async()=>{},editingMovement:X}),J&&e.jsx($s,{movement:J,flockId:J.flockId||i,onClose:()=>te(null),api:l}),M&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",dir:R?"rtl":"ltr",children:[e.jsx("h3",{className:"text-xl font-black uppercase",children:M.type==="lock"?s.verifyAndLock:s.requestUnlock}),e.jsx("textarea",{value:L,onChange:A=>q(A.target.value),placeholder:s.verificationReason,className:"w-full bg-slate-50 border rounded-2xl p-5 text-sm min-h-[120px]"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>I(null),className:"flex-1 py-4 text-slate-400 text-[10px] font-black uppercase",children:s.abort||"Abort"}),e.jsx("button",{disabled:!L.trim(),onClick:bt,className:"flex-[2] py-4 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase shadow-xl disabled:opacity-30",children:s.confirmOperation})]})]})}),v&&e.jsx(Ts,{onClose:()=>m(!1)})]})};export{gr as default};
