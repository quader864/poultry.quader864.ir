import{c as Z,r as c,j as e,e as Ye,X as Ce,D as kt,d as pe,A as qe,L as se,f as _e,g as wt,B as Le,U as Nt,C as Ct}from"./index-Boji9h6s.js";import{C as Te}from"./code-C6dBaxYW.js";import{P as ue}from"./package-XmwZcQ4r.js";import{S as Ze}from"./scale-B5L0ggb0.js";import{C as At}from"./chart-column-ChMpnPDV.js";import{S as St}from"./search-BFMEyRPf.js";import{H}from"./history-Dk3D4HXn.js";import{C as It}from"./calendar-BXolwyxu.js";import{A as zt}from"./arrow-up-right-C_iD6Z9s.js";import{P as Et,C as Pt}from"./CycleModal-sF5BwttB.js";import{T as Ae}from"./trash-2-7jV7fanX.js";import{S as Mt}from"./star-De6Z61zQ.js";import{T as Bt}from"./trending-up-CyoQ3ryj.js";import{u as Se,s as Ot,m as Dt,a as _t,i as Lt,b as be,g as ye,c as ke,d as Tt,e as Ke,S as Kt,f as G,h as Wt,j as Rt,k as X,l as Gt,n as V,o as Y,p as F,q,r as Xe,t as Je,v as Qe,w as $t,x as Vt,y as We,z as Ft,A as Re,B as Ut,L as me,C as Ht,D as Yt,E as Ie,F as et,R as qt,G as Zt,H as Xt,Z as ze,I as tt,J as Jt,K as Qt,M as ea,N as ta,O as aa,P as he,Q as sa,T as at,U as ra,V as la,W as ia,X as na,Y as Ge,_ as st,$ as oa,a0 as rt,a1 as ca,a2 as da,a3 as R,a4 as xa,a5 as ua,a6 as pa,a7 as ma,a8 as ha,a9 as $e,aa as fa,ab as ga,ac as ie,ad as ve,ae as ne,af as oe,ag as ce,ah as de,ai as je,aj as ba}from"./AreaChart-DwytzUVa.js";import va from"./MovementForm-BI98pkbj.js";import{C as ja}from"./clock-DTECff2T.js";import{A as ya}from"./arrow-right-jfyKgB8d.js";import{F as ka}from"./file-text-BvGyBVBS.js";import{P as wa}from"./plus-D3Rv5N16.js";import{C as Na}from"./circle-check-FUip_Tmw.js";import{L as Ca}from"./layout-grid-Be9vMcls.js";import"./info-C2nnCsUG.js";import"./thermometer-Buf6xXJE.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],Sa=Z("arrow-down-left",Aa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],za=Z("layout-list",Ia);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Ve=Z("lock-open",Ea);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],lt=Z("table",Pa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ba=Z("upload",Ma);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],Da=Z("weight",Oa);var it=t=>null;it.displayName="Cell";var nt=(t,a,r)=>{var s=Se();return(i,l)=>x=>{t==null||t(i,l,x),s(Ot({activeIndex:String(l),activeDataKey:a,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}},ot=t=>{var a=Se();return(r,s)=>i=>{t==null||t(r,s,i),a(Dt())}},ct=(t,a,r)=>{var s=Se();return(i,l)=>x=>{t==null||t(i,l,x),s(_t({activeIndex:String(l),activeDataKey:a,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}},Fe=(t,a,r)=>{var s=r??t;if(!be(s))return ye(s,a,0)},_a=(t,a,r)=>{var s={},i=t.filter(Lt),l=t.filter(d=>d.stackId==null),x=i.reduce((d,n)=>{var o=d[n.stackId];return o==null&&(o=[]),o.push(n),d[n.stackId]=o,d},s),u=Object.entries(x).map(d=>{var n,[o,p]=d,y=p.map(g=>g.dataKey),k=Fe(a,r,(n=p[0])===null||n===void 0?void 0:n.barSize);return{stackId:o,dataKeys:y,barSize:k}}),m=l.map(d=>{var n=[d.dataKey].filter(p=>p!=null),o=Fe(a,r,d.barSize);return{stackId:void 0,dataKeys:n,barSize:o}});return[...u,...m]};function Ue(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,s)}return r}function xe(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?Ue(Object(r),!0).forEach(function(s){La(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function La(t,a,r){return(a=Ta(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function Ta(t){var a=Ka(t,"string");return typeof a=="symbol"?a:a+""}function Ka(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function Wa(t,a,r,s,i){var l,x=s.length;if(!(x<1)){var u=ye(t,r,0,!0),m,d=[];if(ke((l=s[0])===null||l===void 0?void 0:l.barSize)){var n=!1,o=r/x,p=s.reduce((f,b)=>f+(b.barSize||0),0);p+=(x-1)*u,p>=r&&(p-=(x-1)*u,u=0),p>=r&&o>0&&(n=!0,o*=.9,p=x*o);var y=(r-p)/2>>0,k={offset:y-u,size:0};m=s.reduce((f,b)=>{var j,A={stackId:b.stackId,dataKeys:b.dataKeys,position:{offset:k.offset+k.size+u,size:n?o:(j=b.barSize)!==null&&j!==void 0?j:0}},w=[...f,A];return k=A.position,w},d)}else{var g=ye(a,r,0,!0);r-2*g-(x-1)*u<=0&&(u=0);var v=(r-2*g-(x-1)*u)/x;v>1&&(v>>=0);var h=ke(i)?Math.min(v,i):v;m=s.reduce((f,b,j)=>[...f,{stackId:b.stackId,dataKeys:b.dataKeys,position:{offset:g+(v+u)*j+(v-h)/2,size:h}}],d)}return m}}var Ra=(t,a,r,s,i,l,x)=>{var u=be(x)?a:x,m=Wa(r,s,i!==l?i:l,t,u);return i!==l&&m!=null&&(m=m.map(d=>xe(xe({},d),{},{position:xe(xe({},d.position),{},{offset:d.position.offset-i/2})}))),m},Ga=(t,a)=>{var r=Tt(a);if(!(!t||r==null||a==null)){var{stackId:s}=a;if(s!=null){var i=t[s];if(i){var{stackedData:l}=i;if(l)return l.find(x=>x.key===r)}}}},$a=(t,a)=>{if(!(t==null||a==null)){var r=t.find(s=>s.stackId===a.stackId&&a.dataKey!=null&&s.dataKeys.includes(a.dataKey));if(r!=null)return r.position}};function Va(t,a){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&ke(t.zIndex)?t.zIndex:a}var Fa="Invariant failed";function Ua(t,a){throw new Error(Fa)}function we(){return we=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},we.apply(null,arguments)}function fe(t){return c.createElement(Kt,we({shapeType:"rectangle",activeClassName:"recharts-active-bar"},t))}var Ha=function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s,i)=>{if(Ke(a))return a;var l=Ke(s)||be(s);return l?a(s,i):(l||Ua(),r)}},Ya=(t,a,r)=>r,qa=(t,a)=>a,re=G([Je,qa],(t,a)=>t.filter(r=>r.type==="bar").find(r=>r.id===a)),Za=G([re],t=>t==null?void 0:t.maxBarSize),Xa=(t,a,r,s)=>s,Ja=G([X,Je,V,F,Ya],(t,a,r,s,i)=>a.filter(l=>t==="horizontal"?l.xAxisId===r:l.yAxisId===s).filter(l=>l.isPanorama===i).filter(l=>l.hide===!1).filter(l=>l.type==="bar")),Qa=(t,a,r)=>{var s=X(t),i=V(t,a),l=F(t,a);if(!(i==null||l==null))return s==="horizontal"?We(t,"yAxis",l,r):We(t,"xAxis",i,r)},es=(t,a)=>{var r=X(t),s=V(t,a),i=F(t,a);if(!(s==null||i==null))return r==="horizontal"?Re(t,"xAxis",s):Re(t,"yAxis",i)},ts=G([Ja,Ft,es],_a),as=(t,a,r)=>{var s,i,l=re(t,a);if(l==null)return 0;var x=V(t,a),u=F(t,a);if(x==null||u==null)return 0;var m=X(t),d=Qe(t),{maxBarSize:n}=l,o=be(n)?d:n,p,y;return m==="horizontal"?(p=Y(t,"xAxis",x,r),y=q(t,"xAxis",x,r)):(p=Y(t,"yAxis",u,r),y=q(t,"yAxis",u,r)),(s=(i=Xe(p,y,!0))!==null&&i!==void 0?i:o)!==null&&s!==void 0?s:0},dt=(t,a,r)=>{var s=X(t),i=V(t,a),l=F(t,a);if(!(i==null||l==null)){var x,u;return s==="horizontal"?(x=Y(t,"xAxis",i,r),u=q(t,"xAxis",i,r)):(x=Y(t,"yAxis",l,r),u=q(t,"yAxis",l,r)),Xe(x,u)}},ss=G([ts,Qe,$t,Vt,as,dt,Za],Ra),rs=(t,a,r)=>{var s=V(t,a);if(s!=null)return Y(t,"xAxis",s,r)},ls=(t,a,r)=>{var s=F(t,a);if(s!=null)return Y(t,"yAxis",s,r)},is=(t,a,r)=>{var s=V(t,a);if(s!=null)return q(t,"xAxis",s,r)},ns=(t,a,r)=>{var s=F(t,a);if(s!=null)return q(t,"yAxis",s,r)},os=G([ss,re],$a),cs=G([Qa,re],Ga),ds=G([Wt,Rt,rs,ls,is,ns,os,X,Gt,dt,cs,re,Xa],(t,a,r,s,i,l,x,u,m,d,n,o,p)=>{var{chartData:y,dataStartIndex:k,dataEndIndex:g}=m;if(!(o==null||x==null||a==null||u!=="horizontal"&&u!=="vertical"||r==null||s==null||i==null||l==null||d==null)){var{data:v}=o,h;if(v!=null&&v.length>0?h=v:h=y==null?void 0:y.slice(k,g+1),h!=null)return Ts({layout:u,barSettings:o,pos:x,parentViewBox:a,bandSize:d,xAxis:r,yAxis:s,xAxisTicks:i,yAxisTicks:l,stackedData:n,displayedData:h,offset:t,cells:p,dataStartIndex:k})}}),xs=["index"];function Ne(){return Ne=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Ne.apply(null,arguments)}function us(t,a){if(t==null)return{};var r,s,i=ps(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ps(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var xt=c.createContext(void 0),ms=t=>{var a=c.useContext(xt);if(a!=null)return a.stackId;if(t!=null)return Ut(t)},hs=(t,a)=>"recharts-bar-stack-clip-path-".concat(t,"-").concat(a),fs=t=>{var a=c.useContext(xt);if(a!=null){var{stackId:r}=a;return"url(#".concat(hs(r,t),")")}},ut=t=>{var{index:a}=t,r=us(t,xs),s=fs(a);return c.createElement(me,Ne({className:"recharts-bar-stack-layer",clipPath:s},r))},gs=["onMouseEnter","onMouseLeave","onClick"],bs=["value","background","tooltipPosition"],vs=["id"],js=["onMouseEnter","onClick","onMouseLeave"];function T(){return T=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},T.apply(null,arguments)}function He(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,s)}return r}function O(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?He(Object(r),!0).forEach(function(s){ys(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function ys(t,a,r){return(a=ks(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function ks(t){var a=ws(t,"string");return typeof a=="symbol"?a:a+""}function ws(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function ge(t,a){if(t==null)return{};var r,s,i=Ns(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(s=0;s<l.length;s++)r=l[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Ns(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var Cs=t=>{var{dataKey:a,name:r,fill:s,legendType:i,hide:l}=t;return[{inactive:l,dataKey:a,type:i,color:s,value:tt(r,a),payload:t}]},As=c.memo(t=>{var{dataKey:a,stroke:r,strokeWidth:s,fill:i,name:l,hide:x,unit:u,tooltipType:m,id:d}=t,n={dataDefinedOnItem:void 0,getPosition:Qt,settings:{stroke:r,strokeWidth:s,fill:i,dataKey:a,nameKey:void 0,name:tt(l,a),hide:x,type:m,color:i,unit:u,graphicalItemId:d}};return c.createElement(Jt,{tooltipEntrySettings:n})});function Ss(t){var a=he(st),{data:r,dataKey:s,background:i,allOtherBarProps:l}=t,{onMouseEnter:x,onMouseLeave:u,onClick:m}=l,d=ge(l,gs),n=nt(x,s,l.id),o=ot(u),p=ct(m,s,l.id);if(!i||r==null)return null;var y=oa(i);return c.createElement(ze,{zIndex:Va(i,Ie.barBackground)},r.map((k,g)=>{var{value:v,background:h,tooltipPosition:f}=k,b=ge(k,bs);if(!h)return null;var j=n(k,g),A=o(k,g),w=p(k,g),z=O(O(O(O(O({option:i,isActive:String(g)===a},b),{},{fill:"#eee"},h),y),rt(d,k,g)),{},{onMouseEnter:j,onMouseLeave:A,onClick:w,dataKey:s,index:g,className:"recharts-bar-background-rectangle"});return c.createElement(fe,T({key:"background-bar-".concat(g)},z))}))}function Is(t){var{showLabels:a,children:r,rects:s}=t,i=s==null?void 0:s.map(l=>{var x={x:l.x,y:l.y,width:l.width,lowerWidth:l.width,upperWidth:l.width,height:l.height};return O(O({},x),{},{value:l.value,payload:l.payload,parentViewBox:l.parentViewBox,viewBox:x,fill:l.fill})});return c.createElement(ua,{value:a?i:void 0},r)}function zs(t){var{shape:a,activeBar:r,baseProps:s,entry:i,index:l,dataKey:x}=t,u=he(st),m=he(ma),d=r&&String(l)===u&&(m==null||x===m),n=d?r:a;return d?c.createElement(ze,{zIndex:Ie.activeBar},c.createElement(ut,{index:l},c.createElement(fe,T({},s,{name:String(s.name)},i,{isActive:d,option:n,index:l,dataKey:x})))):c.createElement(fe,T({},s,{name:String(s.name)},i,{isActive:d,option:n,index:l,dataKey:x}))}function Es(t){var{shape:a,baseProps:r,entry:s,index:i,dataKey:l}=t;return c.createElement(fe,T({},r,{name:String(r.name)},s,{isActive:!1,option:a,index:i,dataKey:l}))}function Ps(t){var a,{data:r,props:s}=t,i=(a=pa(s))!==null&&a!==void 0?a:{},{id:l}=i,x=ge(i,vs),{shape:u,dataKey:m,activeBar:d}=s,{onMouseEnter:n,onClick:o,onMouseLeave:p}=s,y=ge(s,js),k=nt(n,m,l),g=ot(p),v=ct(o,m,l);return r?c.createElement(c.Fragment,null,r.map((h,f)=>c.createElement(ut,T({index:f,key:"rectangle-".concat(h==null?void 0:h.x,"-").concat(h==null?void 0:h.y,"-").concat(h==null?void 0:h.value,"-").concat(f),className:"recharts-bar-rectangle"},rt(y,h,f),{onMouseEnter:k(h,f),onMouseLeave:g(h,f),onClick:v(h,f)}),d?c.createElement(zs,{shape:u,activeBar:d,baseProps:x,entry:h,index:f,dataKey:m}):c.createElement(Es,{shape:u,baseProps:x,entry:h,index:f,dataKey:m})))):null}function Ms(t){var{props:a,previousRectanglesRef:r}=t,{data:s,layout:i,isAnimationActive:l,animationBegin:x,animationDuration:u,animationEasing:m,onAnimationEnd:d,onAnimationStart:n}=a,o=r.current,p=ca(a,"recharts-bar-"),[y,k]=c.useState(!1),g=!y,v=c.useCallback(()=>{typeof d=="function"&&d(),k(!1)},[d]),h=c.useCallback(()=>{typeof n=="function"&&n(),k(!0)},[n]);return c.createElement(Is,{showLabels:g,rects:s},c.createElement(da,{animationId:p,begin:x,duration:u,isActive:l,easing:m,onAnimationEnd:v,onAnimationStart:h,key:p},f=>{var b=f===1?s:s==null?void 0:s.map((j,A)=>{var w=o&&o[A];if(w)return O(O({},j),{},{x:R(w.x,j.x,f),y:R(w.y,j.y,f),width:R(w.width,j.width,f),height:R(w.height,j.height,f)});if(i==="horizontal"){var z=R(0,j.height,f),M=R(j.stackedBarStart,j.y,f);return O(O({},j),{},{y:M,height:z})}var I=R(0,j.width,f),C=R(j.stackedBarStart,j.x,f);return O(O({},j),{},{width:I,x:C})});return f>0&&(r.current=b??null),b==null?null:c.createElement(me,null,c.createElement(Ps,{props:a,data:b}))}),c.createElement(xa,{label:a.label}),a.children)}function Bs(t){var a=c.useRef(null);return c.createElement(Ms,{previousRectanglesRef:a,props:t})}var pt=0,Os=(t,a)=>{var r=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:r,errorVal:at(t,a)}};class Ds extends c.PureComponent{render(){var{hide:a,data:r,dataKey:s,className:i,xAxisId:l,yAxisId:x,needClip:u,background:m,id:d}=this.props;if(a||r==null)return null;var n=ra("recharts-bar",i),o=d;return c.createElement(me,{className:n,id:d},u&&c.createElement("defs",null,c.createElement(la,{clipPathId:o,xAxisId:l,yAxisId:x})),c.createElement(me,{className:"recharts-bar-rectangles",clipPath:u?"url(#clipPath-".concat(o,")"):void 0},c.createElement(Ss,{data:r,dataKey:s,background:m,allOtherBarProps:this.props}),c.createElement(Bs,this.props)))}}var _s={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:pt,xAxisId:0,yAxisId:0,zIndex:Ie.bar};function Ls(t){var{xAxisId:a,yAxisId:r,hide:s,legendType:i,minPointSize:l,activeBar:x,animationBegin:u,animationDuration:m,animationEasing:d,isAnimationActive:n}=t,{needClip:o}=ea(a,r),p=ta(),y=et(),k=aa(t.children,it),g=he(f=>ds(f,t.id,y,k));if(p!=="vertical"&&p!=="horizontal")return null;var v,h=g==null?void 0:g[0];return h==null||h.height==null||h.width==null?v=0:v=p==="vertical"?h.height/2:h.width/2,c.createElement(sa,{xAxisId:a,yAxisId:r,data:g,dataPointFormatter:Os,errorBarOffset:v},c.createElement(Ds,T({},t,{layout:p,needClip:o,data:g,xAxisId:a,yAxisId:r,hide:s,legendType:i,minPointSize:l,activeBar:x,animationBegin:u,animationDuration:m,animationEasing:d,isAnimationActive:n})))}function Ts(t){var{layout:a,barSettings:{dataKey:r,minPointSize:s},pos:i,bandSize:l,xAxis:x,yAxis:u,xAxisTicks:m,yAxisTicks:d,stackedData:n,displayedData:o,offset:p,cells:y,parentViewBox:k,dataStartIndex:g}=t,v=a==="horizontal"?u:x,h=n?v.scale.domain():null,f=ia({numericAxis:v}),b=v.scale.map(f);return o.map((j,A)=>{var w,z,M,I,C,D;if(n){var _=n[A+g];if(_==null)return null;w=na(_,h)}else w=at(j,r),Array.isArray(w)||(w=[f,w]);var P=Ha(s,pt)(w[1],A);if(a==="horizontal"){var K,W=u.scale.map(w[0]),L=u.scale.map(w[1]);if(W==null||L==null)return null;z=Ge({axis:x,ticks:m,bandSize:l,offset:i.offset,entry:j,index:A}),M=(K=L??W)!==null&&K!==void 0?K:void 0,I=i.size;var J=W-L;if(C=ha(J)?0:J,D={x:z,y:p.top,width:I,height:p.height},Math.abs(P)>0&&Math.abs(C)<Math.abs(P)){var Q=$e(C||P)*(Math.abs(P)-Math.abs(C));M-=Q,C+=Q}}else{var U=x.scale.map(w[0]),ee=x.scale.map(w[1]);if(U==null||ee==null)return null;if(z=U,M=Ge({axis:u,ticks:d,bandSize:l,offset:i.offset,entry:j,index:A}),I=ee-U,C=i.size,D={x:p.left,y:M,width:p.width,height:C},Math.abs(P)>0&&Math.abs(I)<Math.abs(P)){var te=$e(I||P)*(Math.abs(P)-Math.abs(I));I+=te}}if(z==null||M==null||I==null||C==null)return null;var ae=O(O({},j),{},{stackedBarStart:b,x:z,y:M,width:I,height:C,value:n?w:w[1],payload:j,background:D,tooltipPosition:{x:z+I/2,y:M+C/2},parentViewBox:k},y&&y[A]&&y[A].props);return ae}).filter(Boolean)}function Ks(t){var a=Yt(t,_s),r=ms(a.stackId),s=et();return c.createElement(qt,{id:a.id,type:"bar"},i=>c.createElement(c.Fragment,null,c.createElement(Zt,{legendPayload:Cs(a)}),c.createElement(As,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:i}),c.createElement(Xt,{type:"bar",id:i,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:r,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:s}),c.createElement(ze,{zIndex:a.zIndex},c.createElement(Ls,T({},a,{id:i})))))}var mt=c.memo(Ks,Ht);mt.displayName="Bar";var Ws=["axis","item"],Rs=c.forwardRef((t,a)=>c.createElement(fa,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Ws,tooltipPayloadSearcher:ga,categoricalChartProps:t,ref:a}));const Gs=({onClose:t})=>e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3rem] shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Ye,{size:28})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-slate-800 uppercase tracking-tighter",children:"Unified Movement Registry API"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:"Endpoint: /flocks/:flockId/cycles/:cycleId/movements"})]})]}),e.jsx("button",{onClick:t,className:"p-3 bg-slate-100 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-2xl transition-all shadow-sm",children:e.jsx(Ce,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-10 space-y-12 no-scrollbar",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(kt,{className:"text-blue-500",size:24}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Core Schemas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-blue-400 mb-6 flex items-center gap-2",children:[e.jsx(Te,{size:12})," BIRD INFLOW (in)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-blue-300 leading-relaxed overflow-x-auto",children:`{
  "type": "in",
  "reason": "purchase",
  "birdMetrics": {
    "count": 5000,
    "ageAtMovement": 4,
    "breed": "Lohmann Brown"
  },
  "weightMetrics": {
    "startWeightGrams": 1200
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-amber-400 mb-6 flex items-center gap-2",children:[e.jsx(ue,{size:12})," RESOURCE INTAKE (feed)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-amber-300 leading-relaxed overflow-x-auto",children:`{
  "type": "feed",
  "date": "2024-03-20T10:00:00Z",
  "feedMetrics": {
    "consumedKg": 350,
    "purchasedKg": 1000,
    "feedType": "Starter",
    "supplier": "Cargill Node 4"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-emerald-400 mb-6 flex items-center gap-2",children:[e.jsx(Te,{size:12})," EGG COLLECTION"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-emerald-300 leading-relaxed overflow-x-auto",children:`{
  "type": "egg_collection",
  "reason": "daily_collection",
  "eggMetrics": {
    "count": 4850,
    "totalWeightKg": 291
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-6 flex items-center gap-2",children:[e.jsx(Da,{size:12})," MASS SAMPLE (weight)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-indigo-300 leading-relaxed overflow-x-auto",children:`{
  "type": "weight",
  "weightMetrics": {
    "averageWeightGrams": 1890,
    "startWeightGrams": 1850,
    "endWeightGrams": 1920,
    "measurementMethod": "scale"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-50 rounded-[2.5rem] border border-slate-200",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-slate-500 mb-6 flex items-center gap-2",children:[e.jsx(Ze,{size:12})," MANUAL ADJUSTMENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-slate-700 leading-relaxed border border-slate-100 shadow-inner",children:`{
  "type": "adjustment",
  "reason": "inspection",
  "birdMetrics": {
    "count": -2
  },
  "notes": "Physical audit correction"
}`})]}),e.jsxs("div",{className:"p-8 bg-rose-50 rounded-[2.5rem] border border-rose-100",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-rose-500 mb-6 flex items-center gap-2",children:[e.jsx(pe,{size:12})," MORTALITY EVENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-rose-700 leading-relaxed border border-rose-100 shadow-inner",children:`{
  "type": "mortality",
  "reason": "disease",
  "mortalityMetrics": {
    "count": 3
  },
  "notes": "Respiratory infection"
}`})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-[2.5rem] p-8 flex items-center gap-8 shadow-sm",children:[e.jsx(pe,{size:48,className:"text-amber-600 shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-black text-amber-900 uppercase tracking-tight",children:"Security & Immutability"}),e.jsxs("p",{className:"text-[11px] font-medium text-amber-800 leading-relaxed",children:["All records once committed are assigned a ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"NODE_ID"})," and entered into the audit trail. Deletion requires an explicit ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"permanent=true"})," flag and high-level clearance."]})]})]})]}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end bg-white",children:e.jsx("button",{onClick:t,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all",children:"Close Documentation"})})]})}),$s=({currentCycle:t,movementsCount:a,flockName:r,selectedCycleId:s,formatDate:i})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4 animate-in slide-in-from-top-4 duration-700",children:[e.jsxs("div",{className:"bg-slate-900 rounded-2xl lg:rounded-3xl p-4 lg:p-6 text-white border border-white/5 shadow-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 transition-transform duration-1000",children:e.jsx(qe,{size:60})}),e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1",children:"Cycle Integrity"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black tracking-tighter uppercase",children:(t==null?void 0:t.status)||"N/A"}),e.jsxs("div",{className:"mt-2 lg:mt-3 flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(t==null?void 0:t.status)==="active"?"bg-emerald-500 animate-pulse":"bg-slate-500"}`}),e.jsxs("span",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400",children:["Since ",t?i(t.startDate):"---"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm group",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Total Logs"}),e.jsx("h4",{className:"text-2xl lg:text-3xl font-black text-slate-900 tabular-nums",children:a}),e.jsxs("p",{className:"text-[9px] lg:text-[10px] font-bold text-blue-600 mt-1 lg:mt-2",children:["ID: ",s]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Production Node"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black text-slate-900 uppercase truncate",children:r||"---"}),e.jsx("p",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400 mt-1 lg:mt-2 uppercase tracking-widest",children:"Fleet Active"})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm flex flex-col justify-between",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"System Health"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs lg:text-sm font-black text-slate-800 font-mono uppercase",children:"Nominal"}),e.jsx(pe,{size:18,className:"text-emerald-500"})]})]})]}),Vs=({viewMode:t,setViewMode:a,searchTerm:r,setSearchTerm:s,selectedCycleId:i,onCycleChange:l,cycles:x,loadingCycles:u,onShowDocs:m,isRtl:d,t:n})=>e.jsx("div",{className:"p-4 lg:p-8 border-b border-slate-100 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"flex bg-white border border-slate-200 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>a("list"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="list"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(za,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"List"})]}),e.jsxs("button",{onClick:()=>a("visual"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="visual"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(At,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Visual"})]})]}),e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(St,{className:`absolute ${d?"right-4":"left-4"} top-1/2 -translate-y-1/2 text-slate-400`,size:16}),e.jsx("input",{type:"text",placeholder:d?"جستجوی فید داده...":"Search stream...",className:`w-full ${d?"pr-10":"pl-10"} py-2.5 bg-white border border-slate-200 rounded-xl text-xs font-bold shadow-sm focus:ring-4 focus:ring-blue-500/10 outline-none`,value:r,onChange:o=>s(o.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-white border border-slate-200 rounded-xl px-3 py-1.5 shadow-sm gap-2 h-[42px] flex-1 min-w-[200px]",children:[e.jsx(H,{size:14,className:"text-slate-400 shrink-0"}),e.jsxs("select",{value:i,onChange:o=>l(o.target.value),className:"bg-transparent border-none text-[9px] font-black uppercase tracking-widest text-slate-700 outline-none cursor-pointer w-full",children:[e.jsx("option",{value:"",children:u?n.loading:n.selectCycle}),x.map(o=>e.jsxs("option",{value:o.cycleId,children:[o.cycleId," ",o.status==="active"?"• ACT":""]},o.cycleId))]}),u&&e.jsx(se,{size:12,className:"animate-spin text-blue-500 shrink-0"})]}),e.jsxs("button",{onClick:m,className:"h-[42px] px-6 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest shadow-sm ml-auto",children:[e.jsx(Ye,{size:14})," ",n.reference]})]})]})}),Fs=({level:t})=>{const a=t==="high"?3:t==="medium"?2:1;return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 text-amber-400",children:[...Array(3)].map((r,s)=>e.jsx(Mt,{size:10,fill:s<a?"currentColor":"none",className:s<a?"":"text-slate-200"},s))}),e.jsx("span",{className:"text-[8px] font-black uppercase text-slate-400 tracking-widest",children:t})]})},Us=({movements:t,formatDate:a,onEdit:r,onDelete:s,onLock:i,onUnlock:l,onViewHistory:x})=>{const u=n=>{var p,y,k,g,v,h,f,b,j,A,w,z;switch(n.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"adjustment":case"sale":return((p=n.birdMetrics)==null?void 0:p.count)??0;case"mortality":return((y=n.mortalityMetrics)==null?void 0:y.count)??((k=n.birdMetrics)==null?void 0:k.count)??0;case"egg_collection":case"egg_breakage":return((g=n.eggMetrics)==null?void 0:g.count)??0;case"weight_measurement":case"weight":return((v=n.weightMetrics)==null?void 0:v.currentWeightGrams)??((h=n.weightMetrics)==null?void 0:h.averageWeightGrams)??((f=n.weightMetrics)==null?void 0:f.grams)??((b=n.weightMetrics)==null?void 0:b.startWeightGrams)??((j=n.weightMetrics)==null?void 0:j.endWeightGrams)??0;case"feed_in":return((A=n.feedMetrics)==null?void 0:A.boughtKg)??((w=n.feedMetrics)==null?void 0:w.purchasedKg)??0;case"feed_consumed":case"feed":return((z=n.feedMetrics)==null?void 0:z.consumedKg)??0;default:return 0}},m=n=>{switch(n.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"mortality":case"sale":case"adjustment":return"Birds";case"egg_collection":case"egg_breakage":return"Eggs";case"weight_measurement":case"weight":return"Grams";case"feed_in":case"feed_consumed":case"feed":return"KG";default:return""}},d=n=>{const o=n.type.toLowerCase();return o==="in"?"Bird Inflow":o==="out"?"Bird Outflow":o==="weight"?"Mass Sample":o==="feed"?"Feed Withdrawal":o==="feed_in"?"Feed Supply":o==="feed_consumed"?"Feed Consumption":n.type.replace(/_/g," ")};return e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full text-left text-sm border-collapse min-w-[1100px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/80 text-slate-400 font-black border-b border-slate-200 uppercase tracking-[0.2em] text-[9px] lg:text-[10px]",children:[e.jsx("th",{className:"px-6 py-4 w-20 text-center",children:"Vector"}),e.jsx("th",{className:"px-6 py-4",children:"Event Time"}),e.jsx("th",{className:"px-6 py-4",children:"Type / Reason"}),e.jsx("th",{className:"px-6 py-4",children:"Quantity"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Consensus"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50 bg-white",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-24 text-center opacity-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(It,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Registry Empty"})]})})}):t.map(n=>{var o;return e.jsxs("tr",{className:`hover:bg-blue-50/10 transition-all group ${n.locked?"bg-slate-50/30":""}`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`w-10 h-10 mx-auto rounded-xl flex items-center justify-center transition-transform group-hover:scale-110 ${["bird_inflow","in","egg_collection","feed_in"].includes(n.type.toLowerCase())?"bg-emerald-50 text-emerald-600":["mortality","egg_breakage","bird_outflow","out","feed_consumed","feed"].includes(n.type.toLowerCase())?"bg-amber-50 text-amber-600":["weight","weight_measurement"].includes(n.type.toLowerCase())?"bg-blue-50 text-blue-600":"bg-slate-50 text-slate-500"}`,children:["bird_inflow","in","egg_collection","feed_in"].includes(n.type.toLowerCase())?e.jsx(Sa,{size:18}):e.jsx(zt,{size:18})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-xs font-black text-slate-900",children:a(n.date)}),e.jsxs("div",{className:"text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-0.5 font-mono",children:["NODE ID: ",n._id.slice(-6).toUpperCase()]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[7px] font-black uppercase tracking-widest self-start",children:d(n)}),e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-tight ml-1",children:((o=n.reason)==null?void 0:o.replace(/_/g," "))||"registry_entry"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-end gap-1",children:[e.jsx("span",{className:"text-base font-black text-slate-900 tabular-nums",children:u(n).toLocaleString()}),e.jsx("span",{className:"text-[8px] font-bold text-slate-400 uppercase mb-1",children:m(n)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Fs,{level:n.confidence})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${n.locked?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:n.locked?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:10})," Locked"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{size:10})," Editable"]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>x(n),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all",title:"View Audit Trail",children:e.jsx(H,{size:16})}),!n.locked&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(n),className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all",title:"Edit Metrics",children:e.jsx(Et,{size:16})}),e.jsx("button",{onClick:()=>s(n),className:"p-2 text-rose-600 hover:bg-rose-50 rounded-lg transition-all",title:"Soft Delete",children:e.jsx(Ae,{size:16})})]}),e.jsx("button",{onClick:()=>n.locked?l(n):i(n),className:`p-2 rounded-lg transition-all ${n.locked?"text-amber-600 hover:bg-amber-50":"text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,title:n.locked?"Request Unlock":"Verify & Lock",children:n.locked?e.jsx(_e,{size:16}):e.jsx(Ve,{size:16})})]})})]},n._id)})})]})})},Hs=({loading:t,data:a})=>{if(t)return e.jsxs("div",{className:"h-[400px] flex flex-col items-center justify-center gap-4 opacity-40",children:[e.jsx(se,{size:32,className:"animate-spin text-blue-600"}),e.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.4em]",children:"Compiling Analytics..."})]});const r=a.weights&&a.weights.length>0,s=a.eggs&&a.eggs.length>0,i=a.feed&&a.feed.length>0,l=a.birdBalance&&a.birdBalance.length>0,x=m=>{switch(m){case"in":return"#10b981";case"mortality":return"#ef4444";case"sale":case"out":return"#f59e0b";default:return"#6366f1"}},u=({active:m,payload:d,label:n})=>{if(m&&d&&d.length){const o=d[0].payload;return e.jsxs("div",{className:"bg-slate-900 border border-white/10 p-4 rounded-2xl shadow-2xl en-text",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2",children:new Date(o.date).toLocaleDateString()}),d.map((p,y)=>e.jsxs("div",{className:"flex items-center gap-3 mb-1 last:mb-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:p.color||p.fill||p.stroke}}),e.jsxs("p",{className:"text-[11px] font-black text-white uppercase tracking-tight en-text",children:[p.name||p.dataKey,": ",e.jsx("span",{className:"text-blue-400",children:p.value.toLocaleString()})]})]},y)),o.type&&e.jsxs("p",{className:`mt-2 text-[9px] font-black uppercase tracking-widest px-2 py-0.5 rounded text-center en-text ${o.type==="mortality"?"bg-rose-500/20 text-rose-400":o.type==="in"?"bg-emerald-500/20 text-emerald-400":"bg-blue-500/20 text-blue-400"}`,children:["EVENT: ",o.type]})]})}return null};return e.jsx("div",{className:"p-6 lg:p-14 space-y-8 lg:space-y-14 animate-in fade-in duration-700",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[450px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-2xl group-hover:rotate-6 transition-transform shadow-sm",children:e.jsx(Ze,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Mass Velocity"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Weight Progression (Grams)"})]})]}),e.jsx(Bt,{size:24,className:"text-emerald-500"})]}),e.jsx("div",{className:"flex-1 min-h-[300px] w-full relative",children:r?e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(ve,{data:a.weights,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"massCurve",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.15}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(oe,{dataKey:"date",hide:!0}),e.jsx(ce,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["auto","auto"]}),e.jsx(de,{content:e.jsx(u,{})}),e.jsx(je,{type:"monotone",dataKey:"grams",name:"Weight",stroke:"#3b82f6",strokeWidth:4,fillOpacity:1,fill:"url(#massCurve)",animationDuration:1e3})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(H,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Historical Mass Samples"})]})})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[450px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl group-hover:scale-110 transition-transform shadow-sm",children:e.jsx(wt,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Egg Collection Volume"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Total Daily Yield (Count)"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 rounded-xl border border-emerald-100",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.6)]"}),e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600 tracking-widest",children:"Total Yield"})]})})]}),e.jsx("div",{className:"flex-1 min-h-[300px] w-full relative",children:s?e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(Rs,{data:a.eggs,margin:{top:10,right:10,left:-20,bottom:0},barGap:0,children:[e.jsx(ne,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(oe,{dataKey:"date",hide:!0}),e.jsx(ce,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["auto","auto"]}),e.jsx(de,{content:e.jsx(u,{})}),e.jsx(mt,{dataKey:"count",name:"Total Eggs",fill:"#10b981",radius:[12,12,0,0],barSize:72,animationDuration:1e3}),e.jsx(ba,{type:"monotone",dataKey:"broken",name:"Broken",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(H,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Yield Ingestion"})]})})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[480px] flex flex-col xl:col-span-2 overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-6 shrink-0 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-slate-900 text-white rounded-2xl group-hover:rotate-3 transition-transform shadow-lg",children:e.jsx(Le,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Chicken Balances"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Live Census Tracking & Lifecycle Events"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"In"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-rose-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"Loss"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full shadow-[0_0_8px_rgba(245,158,11,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"Out"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-[320px] w-full relative z-10",children:l?e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(ve,{data:a.birdBalance,margin:{top:20,right:20,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"popGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#0f172a",stopOpacity:.08}),e.jsx("stop",{offset:"95%",stopColor:"#0f172a",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",vertical:!0,stroke:"#f1f5f9"}),e.jsx(oe,{dataKey:"date",hide:!0}),e.jsx(ce,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["dataMin - 100","dataMax + 100"]}),e.jsx(de,{content:e.jsx(u,{})}),e.jsx(je,{type:"monotone",dataKey:"liveBirds",name:"Fleet Population",stroke:"#0f172a",strokeWidth:4,fill:"url(#popGrad)",fillOpacity:1,animationDuration:1500,dot:m=>{const{cx:d,cy:n,payload:o}=m;return o.type?e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:n,r:8,fill:x(o.type),opacity:.2}),e.jsx("circle",{cx:d,cy:n,r:4.5,fill:x(o.type),stroke:"white",strokeWidth:2,className:"filter drop-shadow-md"})]},`event-${o.date}`):null},activeDot:{r:6,strokeWidth:0}})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(Le,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Census Data"})]})}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-50 flex items-center justify-between text-[9px] font-black text-slate-400 uppercase tracking-widest shrink-0 relative z-10 en-text",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(pe,{size:12,className:"text-emerald-500"})," Ledger Verified"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(H,{size:12})," Sync: Active"]})]}),e.jsx("span",{children:"Protocol: CENSUS-V4.2"})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] lg:rounded-[3.5rem] p-8 lg:p-12 xl:col-span-2 shadow-2xl relative overflow-hidden min-h-[450px] flex flex-col",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 text-white",children:e.jsx(ue,{size:120})}),e.jsxs("div",{className:"flex items-center gap-5 mb-10 relative z-10 shrink-0",children:[e.jsx("div",{className:"p-4 bg-white/10 text-white rounded-2xl shadow-lg border border-white/5",children:e.jsx(ue,{size:32})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-2xl font-black text-white uppercase tracking-tighter",children:"Resource Drain Matrix"}),e.jsx("p",{className:"text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] mt-1",children:"Consolidated Feed Withdrawal (KG)"})]})]}),e.jsx("div",{className:"flex-1 min-h-[300px] relative z-10 w-full",children:i?e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(ve,{data:a.feed,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"feedGrad",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#fbbf24",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#fbbf24",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",vertical:!1,stroke:"#ffffff10"}),e.jsx(oe,{dataKey:"date",hide:!0}),e.jsx(ce,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#64748b"}}),e.jsx(de,{contentStyle:{backgroundColor:"#0f172a",borderRadius:"16px",border:"1px solid #1e293b",color:"white"},itemStyle:{color:"#fbbf24",fontWeight:900}}),e.jsx(je,{type:"stepAfter",dataKey:"consumedKg",name:"Feed Intake",stroke:"#fbbf24",strokeWidth:4,fill:"url(#feedGrad)",animationDuration:1e3})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-700 gap-4 opacity-40",children:[e.jsx(ue,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Resource Ingestion Stream"})]})})]})]})})},Ys=({movement:t,flockId:a,onClose:r,api:s})=>{const[i,l]=c.useState([]),[x,u]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const n=t.flockId||a;if(!n||n==="all"){l([]),u(!1);return}const o=await s.getMovementHistory(n,t.cycleId,t._id);let p=[];o&&Array.isArray(o.history)?p=o.history:o&&Array.isArray(o.data)?p=o.data:Array.isArray(o)&&(p=o),l(p)}catch(n){console.error("Audit history inaccessible",n),l([])}finally{u(!1)}})()},[t._id,a,t.cycleId,s,t.flockId]);const m=Array.isArray(i)?i:[];return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(H,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Audit Trail"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mt-1",children:["Ref: ",t._id.slice(-8).toUpperCase()]})]})]}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-xl transition-all shadow-sm",children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 no-scrollbar",children:x?e.jsxs("div",{className:"py-20 flex flex-col items-center gap-4 opacity-40",children:[e.jsx(se,{className:"animate-spin text-blue-600",size:32}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Querying Node History..."})]}):m.length===0?e.jsxs("div",{className:"py-20 text-center flex flex-col items-center gap-4 opacity-30",children:[e.jsx(qe,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"No revision history found"})]}):e.jsxs("div",{className:"space-y-8 relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-px bg-slate-100"}),m.map((d,n)=>e.jsxs("div",{className:"relative pl-14 group",children:[e.jsx("div",{className:"absolute left-[21px] top-0 w-2.5 h-2.5 rounded-full bg-slate-200 border-2 border-white group-hover:bg-blue-500 transition-colors"}),e.jsxs("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 group-hover:bg-white group-hover:border-blue-200 group-hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[8px] font-black uppercase tracking-widest",children:d.action}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-slate-50",children:[e.jsx(ja,{size:12,className:"text-slate-400"})," ",new Date(d.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-blue-600 uppercase",children:[e.jsx(Nt,{size:12})," ",d.userName||"Operator"]})]}),d.changes&&Array.isArray(d.changes)&&d.changes.length>0&&e.jsx("div",{className:"space-y-3 pt-3 border-t border-slate-100",children:d.changes.map((o,p)=>e.jsxs("div",{className:"flex items-center gap-3 text-[11px] font-medium",children:[e.jsx("span",{className:"text-slate-400 font-black uppercase tracking-tighter w-24 truncate",children:o.field}),e.jsx("span",{className:"text-rose-500 line-through opacity-50",children:String(o.oldValue)}),e.jsx(ya,{size:10,className:"text-slate-300"}),e.jsx("span",{className:"text-emerald-600 font-black",children:String(o.newValue)})]},p))})]})]},n))]})}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em]",children:"Close View"})})]})})},qs=({flockId:t,cycleId:a,onClose:r,onSuccess:s,api:i})=>{const[l,x]=c.useState([]),[u,m]=c.useState(!1),[d,n]=c.useState(""),o=c.useRef(null),p=g=>{var f;const v=(f=g.target.files)==null?void 0:f[0];if(!v)return;const h=new FileReader;h.onload=b=>{var M;const A=((M=b.target)==null?void 0:M.result).split(`
`),w=A[0].split(",").map(I=>I.trim()),z=A.slice(1).filter(I=>I.trim()).map(I=>{const C=I.split(",").map(_=>_.trim()),D={type:"weight_measurement",confidence:"high"};return w.forEach((_,P)=>{_==="weight"&&(D.weightMetrics={averageWeightGrams:parseFloat(C[P])}),_==="date"&&(D.date=C[P]),_==="count"&&(D.birdMetrics={count:parseInt(C[P])})}),D});x([...l,...z])},h.readAsText(v)},y=()=>{x([...l,{date:new Date().toISOString().split("T")[0],type:"weight_measurement",weightMetrics:{averageWeightGrams:0}}])},k=async()=>{if(l.length!==0){m(!0);try{await i.submitBulkMovement(t,a,l),s()}catch(g){n(g.message||"Bulk ingestion protocol failed")}finally{m(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[250] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3.5rem] shadow-2xl w-full max-w-6xl max-h-[85vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-10 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-xl",children:e.jsx(lt,{size:32})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tighter",children:"Bulk Ingestion Engine"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] mt-2",children:["Node Proxy: ",t.slice(-8).toUpperCase()," • Cycle: ",a]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{var g;return(g=o.current)==null?void 0:g.click()},className:"px-6 py-3 bg-white border border-slate-200 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-50 transition-all flex items-center gap-2",children:[e.jsx(Ba,{size:14})," Import CSV"]}),e.jsx("input",{type:"file",ref:o,className:"hidden",accept:".csv",onChange:p}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 text-slate-400 hover:text-rose-500 rounded-2xl transition-all",children:e.jsx(Ce,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-10 no-scrollbar",children:l.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-6 opacity-40",children:[e.jsx(ka,{size:80,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-black uppercase tracking-[0.2em]",children:"Buffer Ready"}),e.jsx("p",{className:"text-sm font-bold uppercase mt-2",children:"Upload CSV or add rows manually to begin batch logging"})]})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100",children:[e.jsx("th",{className:"pb-4 px-4",children:"Effective Date"}),e.jsx("th",{className:"pb-4 px-4",children:"Metric Value"}),e.jsx("th",{className:"pb-4 px-4",children:"Confidence"}),e.jsx("th",{className:"pb-4 px-4 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:l.map((g,v)=>{var h;return e.jsxs("tr",{className:"group hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"date",value:g.date,onChange:f=>{const b=[...l];b[v].date=f.target.value,x(b)},className:"bg-transparent font-bold text-sm outline-none focus:text-blue-600"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"number",value:((h=g.weightMetrics)==null?void 0:h.averageWeightGrams)||0,onChange:f=>{const b=[...l];b[v].weightMetrics={averageWeightGrams:parseFloat(f.target.value)},x(b)},className:"bg-transparent font-black text-sm outline-none focus:text-blue-600 tabular-nums"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("select",{value:g.confidence,onChange:f=>{const b=[...l];b[v].confidence=f.target.value,x(b)},className:"bg-transparent text-[10px] font-black uppercase tracking-widest outline-none",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("button",{onClick:()=>x(l.filter((f,b)=>b!==v)),className:"p-2 text-slate-300 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Ae,{size:16})})})]},v)})})]})}),e.jsxs("div",{className:"p-10 border-t border-slate-100 flex items-center justify-between bg-slate-50/30",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(wa,{size:16})," Append Data Row"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:r,className:"px-10 py-5 bg-white border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-widest text-slate-400",children:"Discard Batch"}),e.jsx("button",{disabled:u||l.length===0,onClick:k,className:"px-14 py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl hover:bg-black transition-all flex items-center gap-3",children:u?e.jsx(se,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Na,{size:18})," Commit Batch (",l.length,")"]})})]})]})]})})},vr=({movements:t,userRole:a,capabilities:r,t:s,api:i,selectedFlockId:l,flocks:x,selectedCycleId:u,onCycleChange:m,onRefresh:d})=>{var De;const[n,o]=c.useState("list"),[p,y]=c.useState(""),[k,g]=c.useState(!1),[v,h]=c.useState(!1),[f,b]=c.useState(!1),[j,A]=c.useState([]),[w,z]=c.useState(!1),[M,I]=c.useState(t),[C,D]=c.useState(null),[_,P]=c.useState(""),[K,W]=c.useState(null),[L,J]=c.useState(""),[Q,U]=c.useState(!1),[ee,te]=c.useState(null),[ae,Ee]=c.useState(null),[ht,ft]=c.useState({weights:[],feed:[],eggs:[],birdBalance:[]}),[gt,Pe]=c.useState(!1),B=s.langToggle==="EN";c.useEffect(()=>{const N=t.filter(S=>{var le;const E=p.toLowerCase(),$=!E||S.type.toLowerCase().includes(E)||((le=S.reason)==null?void 0:le.toLowerCase().includes(E))||S._id.toLowerCase().includes(E);return S.isDeleted!==!0&&$});I(N)},[t,p]);const Me=async()=>{if(l&&l!=="all"){z(!0);try{const S=((await i.getCycles(l)).cycles||[]).sort((E,$)=>$.cycleId.localeCompare(E.cycleId));if(A(S),!u&&S.length>0){const E=S.find($=>$.status==="active")||S[0];m(E.cycleId)}}catch(N){console.error("Failed to load cycles",N)}finally{z(!1)}}else A([])};c.useEffect(()=>{Me()},[l,i]),c.useEffect(()=>{(async()=>{if(n==="visual"&&l!=="all"&&u){Pe(!0);try{const[S,E,$,le]=await Promise.all([i.getWeights(l,u).catch(()=>({weights:[]})),i.getFeed(l,u).catch(()=>({data:[]})),i.getEggs(l,u).catch(()=>({eggs:[]})),i.getBirdBalance(l,u).catch(()=>({data:[]}))]);ft({weights:S.weights||[],feed:E.data||[],eggs:$.eggs||[],birdBalance:le.data||[]})}catch(S){console.error("Visual sync failed",S)}finally{Pe(!1)}}})()},[n,l,u,i]);const bt=async()=>{if(!K||!L)return;const{movement:N,type:S}=K;try{const E=N.flockId||l;S==="lock"?await i.lockMovement(E,N.cycleId,N._id,L):await i.unlockMovement(E,N.cycleId,N._id,L),d(),W(null),J("")}catch(E){alert(E.message)}},vt=async()=>{if(!C)return;U(!0);const N=C._id;I(S=>S.filter(E=>E._id!==N));try{const S=C.flockId||l;await i.deleteMovement(S,C.cycleId,C._id,_),D(null),P(""),d()}catch(S){alert(S.message||"Deletion failed"),d()}finally{U(!1)}},Be=N=>new Date(N).toLocaleDateString(B?"fa-IR":"en-US",{timeZone:"Asia/Tehran"}),jt=j.find(N=>N.cycleId===u),yt=(De=x.find(N=>N._id===l))==null?void 0:De.name,Oe=l!=="all"&&j.length===0&&!w;return e.jsxs("div",{className:"flex flex-col gap-4 lg:gap-6 animate-in fade-in duration-500",dir:B?"rtl":"ltr",children:[l!=="all"&&u&&!Oe&&e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx($s,{currentCycle:jt,movementsCount:M.length,flockName:yt,selectedCycleId:u,isRtl:B,formatDate:Be}),e.jsxs("button",{onClick:()=>b(!0),className:"px-6 py-4 bg-slate-900 text-white rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 hover:bg-black transition-all",children:[e.jsx(lt,{size:16})," ",s.bulkIngestion]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[1.5rem] lg:rounded-[2.5rem] overflow-hidden shadow-sm flex flex-col relative",children:[e.jsx(Vs,{viewMode:n,setViewMode:o,searchTerm:p,setSearchTerm:y,selectedCycleId:u,onCycleChange:m,cycles:j,loadingCycles:w,onShowDocs:()=>g(!0),isRtl:B,t:s,userRole:a}),e.jsx("div",{className:"min-h-0",children:Oe?e.jsxs("div",{className:"py-32 flex flex-col items-center justify-center text-center px-10 animate-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-50 text-slate-300 rounded-[2.5rem] flex items-center justify-center mb-8",children:e.jsx(Ca,{size:48,strokeWidth:1})}),e.jsx("h3",{className:"text-2xl font-black text-slate-800 uppercase tracking-tighter mb-4",children:B?"چرخه عملیاتی یافت نشد":"No Operational Cycles Detected"}),e.jsx("p",{className:"text-sm font-medium text-slate-400 uppercase tracking-widest max-w-md mb-10 leading-relaxed",children:B?"گله انتخاب شده فاقد چرخه تولید فعال است. برای شروع ثبت داده، یک چرخه جدید ایجاد کنید یا گله دیگری را انتخاب نمایید.":"The selected flock has no production cycles registered in the ledger. Please initiate a cycle or select another node to begin telemetry."}),e.jsxs("button",{onClick:()=>h(!0),className:"px-10 py-5 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-2xl shadow-blue-500/20 hover:bg-blue-700 transition-all flex items-center gap-3 active:scale-95",children:[e.jsx(Ct,{size:20})," ",B?"ایجاد اولین چرخه":"Initiate First Cycle"]})]}):n==="list"?e.jsx(Us,{movements:M,formatDate:Be,onEdit:te,onDelete:D,onLock:N=>W({movement:N,type:"lock"}),onUnlock:N=>W({movement:N,type:"unlock"}),onViewHistory:Ee,userRole:a,capabilities:r}):e.jsx(Hs,{loading:gt,data:ht})})]}),f&&e.jsx(qs,{flockId:l,cycleId:u,onClose:()=>b(!1),onSuccess:()=>{b(!1),d()},api:i}),v&&e.jsx(Pt,{flockId:l,onClose:()=>h(!1),onSuccess:()=>{h(!1),Me(),d()},api:i,t:s,isRtl:B}),ee&&e.jsx(va,{onClose:()=>te(null),onSubmit:()=>{te(null),d()},flocks:x,t:s,api:i,onCreateFlock:async()=>{},editingMovement:ee}),ae&&e.jsx(Ys,{movement:ae,flockId:ae.flockId||l,onClose:()=>Ee(null),api:i}),C&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 max-w-md w-full shadow-2xl space-y-6 animate-in zoom-in-95 duration-300",dir:B?"rtl":"ltr",children:[e.jsxs("div",{className:"flex items-center gap-4 text-rose-600",children:[e.jsx(Ae,{size:32}),e.jsx("h3",{className:"text-xl font-black uppercase",children:B?"حذف رکورد":"Delete Record"})]}),e.jsx("p",{className:"text-slate-500 font-medium leading-relaxed",children:B?"آیا از حذف دائمی این رکورد از دفتر کل اطمینان دارید؟ این عملیات قابل بازگشت نیست.":"Are you sure you want to permanently delete this record from the ledger? This action cannot be undone."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:B?"علت حذف (اختیاری)":"Deletion Reason (Optional)"}),e.jsx("textarea",{value:_,onChange:N=>P(N.target.value),placeholder:B?"علت حذف را وارد کنید...":"Enter deletion reason for audit...",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 text-xs font-medium min-h-[80px] outline-none focus:ring-4 focus:ring-rose-500/5 transition-all"})]}),e.jsxs("div",{className:"flex gap-4 pt-2",children:[e.jsx("button",{onClick:()=>{D(null),P("")},className:"flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-200 transition-all",children:B?"انصراف":"Cancel"}),e.jsx("button",{disabled:Q,onClick:vt,className:"flex-1 py-4 bg-rose-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-rose-500/20 hover:bg-rose-700 transition-all flex items-center justify-center gap-2",children:Q?e.jsx(se,{size:14,className:"animate-spin"}):s.confirmOperation})]})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",dir:B?"rtl":"ltr",children:[e.jsx("h3",{className:"text-xl font-black uppercase",children:K.type==="lock"?s.verifyAndLock:s.requestUnlock}),e.jsx("textarea",{value:L,onChange:N=>J(N.target.value),placeholder:s.verificationReason,className:"w-full bg-slate-50 border rounded-2xl p-5 text-sm min-h-[120px]"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>W(null),className:"flex-1 py-4 text-slate-400 text-[10px] font-black uppercase",children:s.abort||"Abort"}),e.jsx("button",{disabled:!L.trim(),onClick:bt,className:"flex-[2] py-4 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase shadow-xl disabled:opacity-30",children:s.confirmOperation})]})]})}),k&&e.jsx(Gs,{onClose:()=>g(!1)})]})};export{vr as default};
