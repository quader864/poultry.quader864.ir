import{c as l,r,A as ge,j as e,e as O,D as M,f as fe,X as U,L as je,d as ye,C as Ne,T as ve}from"./index-BC-RvOu-.js";import{a as j,P as Z}from"./types-Cp6aNMPe.js";import{S as we}from"./search-BQzLMHWd.js";import{S as ke}from"./shield-check-CGp_Szof.js";import{T as ze,D as Se}from"./trash-2-BCV2i7wO.js";import{A as Me,C as Ce}from"./circle-check-DupT73XX.js";import{A as De}from"./arrow-left-DLsVqafI.js";import{L as Ae}from"./layers-COttu-0i.js";import{G as _e}from"./gauge-B7QHN2GM.js";import{Z as K}from"./zap-_BzhCidE.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],X=l("bell-ring",Te);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],$e=l("book-open",Le);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Be=l("clipboard-list",Re);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]],Ee=l("delete",Pe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["circle",{cx:"12",cy:"6",r:"1",key:"1bh7o1"}],["line",{x1:"5",x2:"19",y1:"12",y2:"12",key:"13b5wn"}],["circle",{cx:"12",cy:"18",r:"1",key:"lqb9t5"}]],Ie=l("divide",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],qe=l("eraser",He);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],J=l("flask-conical",We);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Ve=l("history",Ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ue=l("minus",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M8 21s-4-3-4-9 4-9 4-9",key:"uto9ud"}],["path",{d:"M16 3s4 3 4 9-4 9-4 9",key:"4w2vsq"}]],Q=l("parentheses",Ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],Xe=l("percent",Ke);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Qe=l("settings-2",Je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],et=l("share-2",Ye);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],st=l("sparkles",tt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],lt=l("target",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Y=l("toggle-right",rt),bt=({t:y,selectedFlockId:d="all"})=>{var $,R,B,P,E,F,I,H,q,W,G;const[N,C]=r.useState("rules"),[k,x]=r.useState("select"),[o,g]=r.useState(1),[v,m]=r.useState(!1),[p,ee]=r.useState([]),[f,D]=r.useState([]),[te,se]=r.useState([]),[ae,le]=r.useState({}),[re,ce]=r.useState([]),[ie,ne]=r.useState([]),[w,oe]=r.useState(null),[A,de]=r.useState({}),n=r.useMemo(()=>new ge,[]),xe=y.langToggle==="EN",z={name:"",type:"consumption",flockId:null,status:"active",metric:{key:"",unit:"",dataSource:"inventory"},threshold:{expectedMin:0,expectedMax:0,alertMin:0,alertMax:0,baselineType:"perBird"},calculation:{formula:"",dependencies:[]},anomalyDetection:{enabled:!0,trigger:"exceeds_or_below",variancePercent:10,consecutiveDays:1,severity:j.MEDIUM}},[s,c]=r.useState(z),S=async()=>{m(!0);try{const[t,a,i,u,h]=await Promise.all([n.getRules({status:"active",flockId:d}),n.getMetadataInputs(),n.getMetadataCalculations(),n.getMetadataRuleTypes(),n.getMetadataFlocks()]);ee((t==null?void 0:t.data)||[]),le((a==null?void 0:a.inputs)||{});const V=[];if(i!=null&&i.calculations&&Object.values(i.calculations).forEach(b=>{b.templates&&V.push(...b.templates)}),ce(V),ne((u==null?void 0:u.ruleTypes)||[]),se((h==null?void 0:h.data)||(h==null?void 0:h.flocks)||[]),d&&d!=="all"){const b=await n.getRuleAlerts(d,{status:"new"});D((b==null?void 0:b.alerts)||[])}else D([])}catch(t){console.error("Policy engine sync failed:",t)}finally{m(!1)}};r.useEffect(()=>{S()},[n,d]);const me=t=>{c({...z,name:t.name,calculation:{formula:t.formula,dependencies:t.inputs},metric:{key:t.id,unit:t.output,dataSource:"inventory"}}),x("custom"),g(3)},pe=async()=>{m(!0);try{await n.createRule(s),C("rules"),_(),S()}catch(t){alert(t.message||"Deployment failed")}finally{m(!1)}},_=()=>{x("select"),g(1),c(z)},T=t=>{var u;const a=((u=s.calculation)==null?void 0:u.formula)||"",i=a.length>0&&!a.endsWith(" ")?" ":"";c({...s,calculation:{...s.calculation,formula:a+i+t}})},ue=()=>{c({...s,calculation:{...s.calculation,formula:""}})},he=()=>{var i;const a=(((i=s.calculation)==null?void 0:i.formula)||"").trim().split(" ");a.pop(),c({...s,calculation:{...s.calculation,formula:a.join(" ")}})},be=async()=>{var t;if((t=s.calculation)!=null&&t.formula){m(!0);try{const a=await n.createRule({...s,status:"inactive"}),i=await n.testRule(a.ruleId,A);oe(i),await n.deleteRule(a.ruleId)}catch(a){alert("Sim failed: "+a.message)}finally{m(!1)}}},L=({sev:t})=>{const a={[j.LOW]:"bg-blue-500/10 text-blue-500",[j.MEDIUM]:"bg-amber-500/10 text-amber-500",[j.HIGH]:"bg-orange-500/10 text-orange-500",[j.CRITICAL]:"bg-rose-500/10 text-rose-500"};return e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-[8px] lg:text-[9px] font-black uppercase tracking-widest border border-current ${a[t]||"bg-slate-500/10 text-slate-500"}`,children:t})};return e.jsxs("div",{className:"flex flex-col h-full gap-4 lg:gap-6 animate-in fade-in duration-700 pb-20 lg:pb-10",dir:xe?"rtl":"ltr",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[2rem] p-5 lg:p-8 text-white flex flex-col xl:flex-row items-center justify-between gap-6 relative overflow-hidden shadow-2xl border border-white/5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-600/10 rounded-full translate-x-32 -translate-y-32 blur-3xl"}),e.jsxs("div",{className:"flex items-center gap-4 lg:gap-6 relative z-10 w-full xl:w-auto",children:[e.jsxs("div",{className:"w-12 h-12 lg:w-16 lg:h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-xl shrink-0",children:[e.jsx(O,{size:28,className:"lg:hidden"}),e.jsx(O,{size:32,strokeWidth:1.5,className:"hidden lg:block"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg lg:text-2xl font-black tracking-tight uppercase truncate",children:"Analytics Lab"}),e.jsxs("p",{className:"text-[8px] lg:text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-0.5 flex items-center gap-2",children:[e.jsx(st,{size:10,className:"text-blue-400"})," Policy Engineering Suite"]})]})]}),e.jsx("div",{className:"flex bg-slate-800/50 backdrop-blur-md p-1 rounded-2xl border border-white/5 relative z-10 w-full xl:w-auto overflow-x-auto no-scrollbar",children:[{id:"rules",label:y.activePolicies||"Registry",icon:e.jsx(M,{size:14})},{id:"builder",label:y.policyBuilder||"Builder",icon:e.jsx(fe,{size:14})},{id:"alerts",label:y.detectionStream||"Alerts",icon:e.jsx(X,{size:14}),badge:f.length}].map(t=>e.jsxs("button",{onClick:()=>{C(t.id),_()},className:`flex items-center justify-center gap-2 px-4 lg:px-6 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all relative flex-1 whitespace-nowrap ${N===t.id?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:text-slate-200"}`,children:[t.icon," ",e.jsx("span",{className:"hidden sm:inline",children:t.label}),t.badge?e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-rose-500 text-white rounded-full flex items-center justify-center text-[7px] border border-slate-900",children:t.badge}):null]},t.id))})]}),e.jsxs("div",{className:"flex-1 min-h-0",children:[N==="rules"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 overflow-y-auto no-scrollbar pb-10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-2 px-1 gap-3",children:[e.jsxs("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.25em]",children:["Managed Detections (",Array.isArray(p)?p.length:0,")"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white border border-slate-200 rounded-xl px-3 py-1.5 w-full sm:w-auto",children:[e.jsx(we,{size:14,className:"text-slate-400"}),e.jsx("input",{placeholder:"Search policies...",className:"bg-transparent border-none text-[10px] font-bold uppercase outline-none text-slate-400 placeholder:text-slate-300 flex-1 sm:w-32"})]})]}),Array.isArray(p)&&p.map(t=>e.jsxs("div",{className:"bg-white border border-slate-200 p-5 lg:p-6 rounded-[2rem] shadow-sm hover:shadow-lg transition-all group overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${t.status==="active"?"bg-blue-50 text-blue-600":"bg-slate-50 text-slate-400"}`,children:e.jsx(ke,{size:24})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-black text-slate-900 text-sm lg:text-base uppercase tracking-tight truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx(L,{sev:t.anomalyDetection.severity}),e.jsx("span",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:t.type})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{className:"p-2 text-slate-300 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-all",children:e.jsx(Qe,{size:18})}),e.jsx("button",{className:"p-2 text-slate-300 hover:text-rose-600 hover:bg-rose-50 rounded-xl transition-all",onClick:()=>n.deleteRule(t._id).then(S),children:e.jsx(ze,{size:18})})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4 border border-slate-100 font-mono text-[10px] lg:text-[11px] font-bold text-slate-600 overflow-x-auto flex flex-wrap gap-2",children:[e.jsx("code",{className:"text-slate-400 uppercase mr-2",children:"Rule Logic:"}),t.calculation.formula.split(" ").map((a,i)=>e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-black ${["+","-","*","/","(",")"].includes(a)?"bg-slate-200 text-slate-600":"bg-blue-100 text-blue-600"}`,children:a},i))]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-4 px-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] font-bold text-slate-400 uppercase",children:[e.jsx(Ve,{size:10})," ",t.anomalyDetection.consecutiveDays,"D Wait"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] font-bold text-slate-400 uppercase",children:[e.jsx(lt,{size:10})," ",t.flockId?"Flock Specific":"Global"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5 text-[9px] font-black text-emerald-600 uppercase tracking-widest",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full"})," ",t.status]})]})]},t._id)),(!Array.isArray(p)||p.length===0)&&!v&&e.jsxs("div",{className:"py-20 text-center bg-slate-50 rounded-[2.5rem] border-2 border-dashed border-slate-200",children:[e.jsx(M,{size:40,className:"mx-auto text-slate-300 mb-4"}),e.jsx("p",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"No active rules deployed"})]})]}),e.jsx("div",{className:"space-y-6 hidden lg:block",children:e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2rem] p-6 shadow-sm sticky top-4",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest mb-6 flex items-center gap-2",children:[e.jsx(Me,{size:16,className:"text-blue-600"})," Fleet Governance"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50/50 rounded-2xl border border-blue-100",children:[e.jsx("p",{className:"text-[9px] font-black text-blue-600 uppercase mb-1",children:"Global Health Score"}),e.jsx("p",{className:"text-xl font-black text-blue-900 tracking-tighter",children:"94.2%"})]}),e.jsxs("button",{className:"w-full py-3.5 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-black transition-all flex items-center justify-center gap-2",children:[e.jsx(Se,{size:14})," Audit Trail Export"]})]})]})})]}),N==="builder"&&e.jsxs("div",{className:"h-full flex flex-col items-center",children:[k==="select"&&e.jsxs("div",{className:"max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-6 animate-in slide-in-from-bottom-4 duration-500 p-4",children:[e.jsxs("div",{onClick:()=>x("template"),className:"bg-white border border-slate-200 p-8 lg:p-10 rounded-[2.5rem] shadow-sm hover:shadow-2xl hover:border-blue-500 transition-all cursor-pointer group flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform",children:e.jsx($e,{size:32})}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight mb-2",children:"Use Template"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 leading-relaxed mb-8",children:"Deploy pre-configured logic for feed, water, and mortality monitoring."}),e.jsx("button",{className:"mt-auto px-8 py-3 bg-blue-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg",children:"Browse Library"})]}),e.jsxs("div",{onClick:()=>{x("custom"),g(1)},className:"bg-white border border-slate-200 p-8 lg:p-10 rounded-[2.5rem] shadow-sm hover:shadow-2xl hover:border-indigo-500 transition-all cursor-pointer group flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-50 text-indigo-600 rounded-3xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform",children:e.jsx(J,{size:32})}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight mb-2",children:"Build Custom"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 leading-relaxed mb-8",children:"Define unique formulas, custom metrics, and multi-variable logic."}),e.jsx("button",{className:"mt-auto px-8 py-3 bg-indigo-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg",children:"Start Wizard"})]})]}),k==="template"&&e.jsxs("div",{className:"max-w-5xl w-full space-y-6 animate-in fade-in duration-300 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x("select"),className:"flex items-center gap-2 text-slate-400 hover:text-slate-900 transition-colors",children:[e.jsx(De,{size:20})," ",e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Back"})]}),e.jsx("h2",{className:"text-sm lg:text-lg font-black text-slate-800 uppercase tracking-tight",children:"Logical Blueprint Library"}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:re.map((t,a)=>e.jsxs("div",{className:"bg-white border border-slate-200 p-6 rounded-[2rem] shadow-sm hover:shadow-xl transition-all flex flex-col border-t-4 border-t-blue-500",children:[e.jsx("h4",{className:"font-black text-slate-800 text-sm uppercase mb-1",children:t.name}),e.jsx("p",{className:"text-[10px] font-medium text-slate-400 mb-4 line-clamp-2",children:t.description}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-xl mb-4 font-mono text-[9px] text-slate-500 overflow-hidden truncate",children:t.formula}),e.jsx("button",{onClick:()=>me(t),className:"mt-auto w-full py-2.5 bg-blue-50 text-blue-600 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 hover:text-white transition-all",children:"Deploy Template"})]},a))})]}),k==="custom"&&e.jsxs("div",{className:"w-full max-w-2xl px-4 pb-20",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>x("select"),className:"p-2 text-slate-400 hover:bg-slate-100 rounded-full",children:e.jsx(U,{size:20})}),e.jsx("div",{className:"flex items-center gap-3",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:`w-8 h-1.5 rounded-full transition-all duration-500 ${o>=t?"bg-blue-600":"bg-slate-200"}`},t))}),e.jsxs("span",{className:"text-[10px] font-black text-slate-400 uppercase w-10 text-right",children:[o,"/5"]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-6 lg:p-10 shadow-2xl animate-in slide-in-from-right-10 duration-500",children:[o===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Be,{size:32})}),e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Rule Foundations"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 uppercase tracking-widest mt-1",children:"Identify your detection logic"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Rule Identity"}),e.jsx("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-bold",placeholder:"e.g. Broiler Consumption Guard",value:s.name,onChange:t=>c({...s,name:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Domain"}),e.jsx("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-bold",value:s.type,onChange:t=>c({...s,type:t.target.value}),children:ie.map(t=>e.jsx("option",{value:t.type,children:t.label},t.type))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:"Application Scope"}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-bold",value:s.flockId||"",onChange:t=>c({...s,flockId:t.target.value||null}),children:[e.jsx("option",{value:"",children:"Farm-wide (All Flocks)"}),te.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})]})]}),o===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 bg-indigo-50 text-indigo-600 rounded-3xl flex items-center justify-center mx-auto mb-3 shadow-sm",children:e.jsx(J,{size:28})}),e.jsx("h2",{className:"text-lg font-black text-slate-800 uppercase tracking-tight",children:"Logic Blueprint"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:"Assemble your formula components"})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2rem] p-6 lg:p-8 min-h-[160px] flex flex-wrap content-start gap-2 shadow-inner border border-white/5 overflow-y-auto",children:[($=s.calculation)==null?void 0:$.formula.split(" ").filter(t=>t!=="").map((t,a)=>e.jsx("div",{className:`flex items-center gap-2 px-3 py-2 rounded-xl text-[10px] font-black uppercase transition-all animate-in zoom-in duration-300 ${["+","-","*","/","(",")"].includes(t)?"bg-indigo-600/20 text-indigo-400 border border-indigo-500/30":"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20"}`,children:t},a)),(!((R=s.calculation)!=null&&R.formula)||((B=s.calculation)==null?void 0:B.formula.trim())==="")&&e.jsxs("div",{className:"w-full h-full flex items-center justify-center opacity-20 flex-col gap-2",children:[e.jsx(Ae,{size:32,className:"text-white"}),e.jsx("p",{className:"text-[10px] font-black text-white uppercase tracking-[0.3em]",children:"Empty Blueprint"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-4 bg-slate-50 rounded-2xl border border-slate-200",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest w-full mb-1",children:"Standard Logic"}),[{label:"+",icon:e.jsx(Z,{size:14}),color:"bg-white"},{label:"-",icon:e.jsx(Ue,{size:14}),color:"bg-white"},{label:"*",icon:e.jsx(U,{size:14}),color:"bg-white"},{label:"/",icon:e.jsx(Ie,{size:14}),color:"bg-white"},{label:"(",icon:e.jsx(Q,{size:14}),color:"bg-white"},{label:")",icon:e.jsx(Q,{size:14}),color:"bg-white"},{label:"100",icon:e.jsx(Xe,{size:14}),color:"bg-amber-50 text-amber-600"},{label:"1000",icon:e.jsx(M,{size:14}),color:"bg-blue-50 text-blue-600"}].map(t=>e.jsx("button",{onClick:()=>T(t.label),className:`p-3 rounded-xl shadow-sm border border-slate-200 hover:scale-105 transition-all flex items-center justify-center ${t.color}`,children:t.icon},t.label)),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx("button",{onClick:he,className:"p-3 bg-white text-rose-500 rounded-xl border border-slate-200 hover:bg-rose-50",children:e.jsx(Ee,{size:14})}),e.jsx("button",{onClick:ue,className:"p-3 bg-white text-slate-400 rounded-xl border border-slate-200 hover:bg-slate-100",children:e.jsx(qe,{size:14})})]})]}),e.jsxs("div",{className:"p-5 bg-white border border-slate-200 rounded-[2rem] shadow-sm",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-4",children:"Metric Components"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Object.values(ae).flat().map(t=>e.jsxs("button",{onClick:()=>T(t.key),className:"group px-3 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-[9px] font-black text-slate-600 uppercase tracking-tight hover:bg-indigo-600 hover:text-white hover:border-indigo-600 transition-all text-left flex items-center justify-between",children:[t.key,e.jsx(Z,{size:12,className:"opacity-0 group-hover:opacity-100 transition-opacity"})]},t.key))})]})]})]}),o===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-50 text-amber-600 rounded-3xl flex items-center justify-center mx-auto mb-4",children:e.jsx(_e,{size:32})}),e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Guardrail Boundaries"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 uppercase tracking-widest mt-1",children:"When should we alert?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Expected Min"}),e.jsx("input",{type:"number",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-black",value:(P=s.threshold)==null?void 0:P.alertMin,onChange:t=>c({...s,threshold:{...s.threshold,alertMin:Number(t.target.value)}})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Expected Max"}),e.jsx("input",{type:"number",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-black",value:(E=s.threshold)==null?void 0:E.alertMax,onChange:t=>c({...s,threshold:{...s.threshold,alertMax:Number(t.target.value)}})})]}),e.jsxs("div",{className:"col-span-2 space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Normalization"}),e.jsx("div",{className:"flex bg-slate-100 p-1 rounded-2xl gap-1",children:["perBird","percentage","total"].map(t=>{var a;return e.jsx("button",{onClick:()=>c({...s,threshold:{...s.threshold,baselineType:t}}),className:`flex-1 py-3 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all ${((a=s.threshold)==null?void 0:a.baselineType)===t?"bg-white shadow-md text-slate-900":"text-slate-400"}`,children:t},t)})})]})]})]}),o===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-50 text-rose-600 rounded-3xl flex items-center justify-center mx-auto mb-4",children:e.jsx(X,{size:32})}),e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Signal Dispatch"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 uppercase tracking-widest mt-1",children:"Severity & Persistence"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Alert Sensitivity (%)"}),e.jsx("input",{type:"range",min:"1",max:"50",className:"w-full accent-blue-600",value:(F=s.anomalyDetection)==null?void 0:F.variancePercent,onChange:t=>c({...s,anomalyDetection:{...s.anomalyDetection,variancePercent:Number(t.target.value)}})}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-400 px-1",children:[e.jsx("span",{children:"Ultra-Sensitive (1%)"}),e.jsx("span",{children:"Standard (10%)"}),e.jsx("span",{children:"Relaxed (50%)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Severity"}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-black",value:(I=s.anomalyDetection)==null?void 0:I.severity,onChange:t=>c({...s,anomalyDetection:{...s.anomalyDetection,severity:t.target.value}}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Persistence (Days)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-black",value:(H=s.anomalyDetection)==null?void 0:H.consecutiveDays,onChange:t=>c({...s,anomalyDetection:{...s.anomalyDetection,consecutiveDays:Number(t.target.value)}})})]})]})]})]}),o===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-50 text-emerald-600 rounded-3xl flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{size:32})}),e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Pilot Simulation"}),e.jsx("p",{className:"text-xs font-medium text-slate-400 uppercase tracking-widest mt-1",children:"Validate before flight"})]}),e.jsxs("div",{className:"p-6 bg-slate-50 rounded-3xl border border-slate-200 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] font-black text-slate-400 uppercase",children:[e.jsx("span",{children:"Simulation Input"}),e.jsx("button",{onClick:be,className:"text-blue-600 hover:underline",children:"Refresh Run"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:(W=(q=s.calculation)==null?void 0:q.dependencies)==null?void 0:W.slice(0,4).map(t=>e.jsx("input",{type:"number",placeholder:t,className:"bg-white border border-slate-200 rounded-xl px-4 py-2 text-xs font-bold",onChange:a=>de({...A,[t]:Number(a.target.value)})},t))}),w&&e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-blue-100 animate-in zoom-in-95",children:[e.jsx("p",{className:"text-[9px] font-black text-blue-500 uppercase tracking-widest mb-1",children:"Sim Output"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xl font-black text-slate-900",children:(G=w.value)==null?void 0:G.toFixed(2)}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[8px] font-black uppercase ${w.anomaly?"bg-rose-500 text-white":"bg-emerald-500 text-white"}`,children:w.anomaly?"Trigger":"Healthy"})]})]})]})]}),e.jsxs("div",{className:"mt-10 flex gap-4",children:[o>1&&e.jsx("button",{onClick:()=>g(t=>t-1),className:"flex-1 py-4 border border-slate-200 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Back"}),o<5?e.jsx("button",{onClick:()=>g(t=>t+1),className:"flex-[2] py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-black",children:"Continue"}):e.jsx("button",{onClick:pe,disabled:v,className:"flex-[2] py-4 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-blue-700 flex items-center justify-center gap-2",children:v?e.jsx(je,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:16,strokeWidth:3})," Deploy Logic"]})})]})]})]})]}),N==="alerts"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 overflow-y-auto no-scrollbar pb-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.25em]",children:"Live Event Feed"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[9px] font-black text-emerald-600 uppercase",children:"Synchronized"})]})]}),d==="all"?e.jsxs("div",{className:"py-24 text-center flex flex-col items-center gap-4 bg-white/50 border border-dashed border-slate-200 rounded-[2.5rem]",children:[e.jsx(Ne,{size:48,className:"text-slate-300"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"Select a specific flock"}),e.jsx("p",{className:"text-[10px] font-medium text-slate-400 max-w-xs px-6",children:"Fleet-wide alert aggregation is currently restricted. Please choose a specific flock from the global menu to view active detection events."})]})]}):Array.isArray(f)&&f.map(t=>e.jsxs("div",{className:"bg-white border border-slate-200 p-5 lg:p-6 rounded-[2rem] shadow-sm hover:shadow-xl transition-all flex flex-col sm:flex-row items-start gap-5 group",children:[e.jsx("div",{className:`w-12 h-12 lg:w-14 lg:h-14 rounded-2xl flex items-center justify-center shrink-0 shadow-sm ${t.severity==="critical"?"bg-rose-50 text-rose-600":"bg-amber-50 text-amber-500"}`,children:e.jsx(ve,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-black text-slate-900 text-sm lg:text-base uppercase tracking-tight truncate",children:t.ruleName}),e.jsx(L,{sev:t.severity})]}),e.jsxs("p",{className:"text-[11px] lg:text-xs text-slate-500 font-medium leading-relaxed mb-4",children:["Detection triggered with value ",e.jsx("span",{className:"font-black text-slate-800",children:t.calculatedValue.toFixed(2)}),". Variance of ",e.jsxs("span",{className:"text-rose-500 font-black",children:[t.variance.toFixed(1),"%"]})," from expected range."]}),e.jsxs("div",{className:"flex items-center gap-4 text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:[e.jsx("span",{children:new Date(t.createdAt).toLocaleString()}),e.jsx("div",{className:"w-1 h-1 bg-slate-200 rounded-full"}),e.jsxs("span",{className:"text-blue-600",children:["FLOCK: ",t.flockId.slice(-6)]})]})]}),e.jsx("button",{className:"shrink-0 w-full sm:w-auto px-6 py-2.5 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg hover:bg-black transition-all",children:"Acknowledge"})]},t._id)),d!=="all"&&(!Array.isArray(f)||f.length===0)&&e.jsxs("div",{className:"py-32 text-center flex flex-col items-center gap-4 opacity-40",children:[e.jsx(Ce,{size:56,className:"text-slate-300"}),e.jsx("p",{className:"text-xs font-black text-slate-400 uppercase tracking-[0.3em]",children:"Horizon Clear"})]})]}),e.jsx("div",{className:"space-y-6 hidden lg:block",children:e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2rem] p-8 shadow-sm",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest mb-6 flex items-center gap-2",children:[e.jsx(et,{size:16,className:"text-blue-600"})," Dispatch"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase",children:"SMS Alerting"}),e.jsx(Y,{size:20,className:"text-blue-600"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase",children:"Email Digest"}),e.jsx(Y,{size:20,className:"text-blue-600"})]})]})]})})]})]}),v&&e.jsx("div",{className:"fixed bottom-6 right-6 lg:bottom-10 lg:right-10 z-[100] animate-in slide-in-from-bottom-10 duration-500",children:e.jsxs("div",{className:"bg-slate-900 text-white px-6 py-4 lg:px-8 lg:py-5 rounded-2xl lg:rounded-[2rem] shadow-2xl flex items-center gap-4 border border-white/10",children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"}),e.jsx(K,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-blue-500",size:12})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] truncate",children:"Synchronizing"}),e.jsx("p",{className:"text-[8px] font-bold text-slate-500 uppercase tracking-widest mt-0.5 truncate",children:"Sentinel Node Registry"})]})]})})]})};export{bt as default};
