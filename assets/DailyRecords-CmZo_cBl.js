import{c as te,r as o,j as e,e as tt,X as Pe,D as Et,d as ve,A as at,L as ce,f as $e,g as Pt,B as Ve,U as Mt,C as Bt}from"./index-D-P-TEXt.js";import{C as Fe}from"./code-CCK1ku-w.js";import{P as be}from"./package-D0oOTeG4.js";import{S as st}from"./scale-BrQOJRvQ.js";import{C as _t}from"./chart-column-CrgVJdd7.js";import{S as Dt}from"./search-sdvn9cyO.js";import{H as J}from"./history-tqB5jrvs.js";import{C as Ot}from"./calendar-KqmLPuV2.js";import{A as Lt}from"./arrow-up-right-CVv5WC97.js";import{P as Tt,C as Wt}from"./CycleModal-CZ96WHTJ.js";import{T as Me}from"./trash-2-CtUbLbTD.js";import{S as Kt}from"./star-DD3rjQ1Y.js";import{T as Rt}from"./trending-up-BYFYVXzO.js";import{u as Be,s as Gt,m as $t,a as Vt,i as Ft,b as Ne,g as Se,c as Ie,d as Ut,e as Ue,f as H,h as Ht,j as qt,k as ae,l as Yt,n as q,o as Q,p as Y,q as ee,r as rt,t as it,v as lt,w as Zt,x as Xt,y as He,z as Jt,A as qe,B as Qt,L as je,C as ea,D as ta,E as _e,F as nt,R as aa,S as sa,G as ra,Z as De,H as ot,I as ia,J as la,K as na,M as oa,N as ca,O as ye,P as ct,Q as da,T as xa,U as ua,V as pa,W as Ye,X as dt,Y as ma,_ as xt,$ as ha,a0 as fa,a1 as U,a2 as ga,a3 as ba,a4 as va,a5 as ja,a6 as ya,a7 as Ze,a8 as ka,a9 as wa,aa as ue,ab as Ce,ac as pe,ad as me,ae as he,af as fe,ag as Ae}from"./AreaChart-Cyjm_Htx.js";import{S as Na,a as Ca,L as Aa}from"./Line-aZND6FPc.js";import Sa from"./MovementForm-Bqpkf2as.js";import{C as Ia}from"./clock-Cu403Q11.js";import{A as za}from"./arrow-right-CK3AoaAa.js";import{F as Ea}from"./file-text-Ca6JLDxi.js";import{P as Pa}from"./plus-rr7oC3Kd.js";import{C as Ma}from"./circle-check-DxqNuXWi.js";import{L as Ba}from"./layout-grid-D-Rskm1A.js";import"./info-DqryYC1G.js";import"./thermometer-BKeoCBPY.js";import"./wind--BVULmoI.js";import"./fingerprint-pattern-JmWHF8rv.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],Da=te("arrow-down-left",_a);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],La=te("layout-list",Oa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Xe=te("lock-open",Ta);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],ut=te("table",Wa);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ra=te("upload",Ka);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],$a=te("weight",Ga);var pt=t=>null;pt.displayName="Cell";var mt=(t,a,r)=>{var s=Be();return(l,i)=>c=>{t==null||t(l,i,c),s(Gt({activeIndex:String(i),activeDataKey:a,activeCoordinate:l.tooltipPosition,activeGraphicalItemId:r}))}},ht=t=>{var a=Be();return(r,s)=>l=>{t==null||t(r,s,l),a($t())}},ft=(t,a,r)=>{var s=Be();return(l,i)=>c=>{t==null||t(l,i,c),s(Vt({activeIndex:String(i),activeDataKey:a,activeCoordinate:l.tooltipPosition,activeGraphicalItemId:r}))}},Je=(t,a,r)=>{var s=r??t;if(!Ne(s))return Se(s,a,0)},Va=(t,a,r)=>{var s={},l=t.filter(Ft),i=t.filter(d=>d.stackId==null),c=l.reduce((d,u)=>{var x=d[u.stackId];return x==null&&(x=[]),x.push(u),d[u.stackId]=x,d},s),n=Object.entries(c).map(d=>{var u,[x,m]=d,y=m.map(g=>g.dataKey),w=Je(a,r,(u=m[0])===null||u===void 0?void 0:u.barSize);return{stackId:x,dataKeys:y,barSize:w}}),p=i.map(d=>{var u=[d.dataKey].filter(m=>m!=null),x=Je(a,r,d.barSize);return{stackId:void 0,dataKeys:u,barSize:x}});return[...n,...p]};function Qe(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,s)}return r}function ge(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?Qe(Object(r),!0).forEach(function(s){Fa(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Fa(t,a,r){return(a=Ua(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function Ua(t){var a=Ha(t,"string");return typeof a=="symbol"?a:a+""}function Ha(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function qa(t,a,r,s,l){var i,c=s.length;if(!(c<1)){var n=Se(t,r,0,!0),p,d=[];if(Ie((i=s[0])===null||i===void 0?void 0:i.barSize)){var u=!1,x=r/c,m=s.reduce((f,b)=>f+(b.barSize||0),0);m+=(c-1)*n,m>=r&&(m-=(c-1)*n,n=0),m>=r&&x>0&&(u=!0,x*=.9,m=c*x);var y=(r-m)/2>>0,w={offset:y-n,size:0};p=s.reduce((f,b)=>{var k,z={stackId:b.stackId,dataKeys:b.dataKeys,position:{offset:w.offset+w.size+n,size:u?x:(k=b.barSize)!==null&&k!==void 0?k:0}},N=[...f,z];return w=z.position,N},d)}else{var g=Se(a,r,0,!0);r-2*g-(c-1)*n<=0&&(n=0);var v=(r-2*g-(c-1)*n)/c;v>1&&(v>>=0);var h=Ie(l)?Math.min(v,l):v;p=s.reduce((f,b,k)=>[...f,{stackId:b.stackId,dataKeys:b.dataKeys,position:{offset:g+(v+n)*k+(v-h)/2,size:h}}],d)}return p}}var Ya=(t,a,r,s,l,i,c)=>{var n=Ne(c)?a:c,p=qa(r,s,l!==i?l:i,t,n);return l!==i&&p!=null&&(p=p.map(d=>ge(ge({},d),{},{position:ge(ge({},d.position),{},{offset:d.position.offset-l/2})}))),p},Za=(t,a)=>{var r=Ut(a);if(!(!t||r==null||a==null)){var{stackId:s}=a;if(s!=null){var l=t[s];if(l){var{stackedData:i}=l;if(i)return i.find(c=>c.key===r)}}}},Xa=(t,a)=>{if(!(t==null||a==null)){var r=t.find(s=>s.stackId===a.stackId&&a.dataKey!=null&&s.dataKeys.includes(a.dataKey));if(r!=null)return r.position}};function Ja(t,a){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&Ie(t.zIndex)?t.zIndex:a}var Qa="Invariant failed";function es(t,a){throw new Error(Qa)}function ze(){return ze=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},ze.apply(null,arguments)}function ke(t){return o.createElement(Na,ze({shapeType:"rectangle",activeClassName:"recharts-active-bar"},t))}var ts=function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s,l)=>{if(Ue(a))return a;var i=Ue(s)||Ne(s);return i?a(s,l):(i||es(),r)}},as=(t,a,r)=>r,ss=(t,a)=>a,de=H([it,ss],(t,a)=>t.filter(r=>r.type==="bar").find(r=>r.id===a)),rs=H([de],t=>t==null?void 0:t.maxBarSize),is=(t,a,r,s)=>s,ls=H([ae,it,q,Y,as],(t,a,r,s,l)=>a.filter(i=>t==="horizontal"?i.xAxisId===r:i.yAxisId===s).filter(i=>i.isPanorama===l).filter(i=>i.hide===!1).filter(i=>i.type==="bar")),ns=(t,a,r)=>{var s=ae(t),l=q(t,a),i=Y(t,a);if(!(l==null||i==null))return s==="horizontal"?He(t,"yAxis",i,r):He(t,"xAxis",l,r)},os=(t,a)=>{var r=ae(t),s=q(t,a),l=Y(t,a);if(!(s==null||l==null))return r==="horizontal"?qe(t,"xAxis",s):qe(t,"yAxis",l)},cs=H([ls,Jt,os],Va),ds=(t,a,r)=>{var s,l,i=de(t,a);if(i==null)return 0;var c=q(t,a),n=Y(t,a);if(c==null||n==null)return 0;var p=ae(t),d=lt(t),{maxBarSize:u}=i,x=Ne(u)?d:u,m,y;return p==="horizontal"?(m=Q(t,"xAxis",c,r),y=ee(t,"xAxis",c,r)):(m=Q(t,"yAxis",n,r),y=ee(t,"yAxis",n,r)),(s=(l=rt(m,y,!0))!==null&&l!==void 0?l:x)!==null&&s!==void 0?s:0},gt=(t,a,r)=>{var s=ae(t),l=q(t,a),i=Y(t,a);if(!(l==null||i==null)){var c,n;return s==="horizontal"?(c=Q(t,"xAxis",l,r),n=ee(t,"xAxis",l,r)):(c=Q(t,"yAxis",i,r),n=ee(t,"yAxis",i,r)),rt(c,n)}},xs=H([cs,lt,Zt,Xt,ds,gt,rs],Ya),us=(t,a,r)=>{var s=q(t,a);if(s!=null)return Q(t,"xAxis",s,r)},ps=(t,a,r)=>{var s=Y(t,a);if(s!=null)return Q(t,"yAxis",s,r)},ms=(t,a,r)=>{var s=q(t,a);if(s!=null)return ee(t,"xAxis",s,r)},hs=(t,a,r)=>{var s=Y(t,a);if(s!=null)return ee(t,"yAxis",s,r)},fs=H([xs,de],Xa),gs=H([ns,de],Za),bs=H([Ht,qt,us,ps,ms,hs,fs,ae,Yt,gt,gs,de,is],(t,a,r,s,l,i,c,n,p,d,u,x,m)=>{var{chartData:y,dataStartIndex:w,dataEndIndex:g}=p;if(!(x==null||c==null||a==null||n!=="horizontal"&&n!=="vertical"||r==null||s==null||l==null||i==null||d==null)){var{data:v}=x,h;if(v!=null&&v.length>0?h=v:h=y==null?void 0:y.slice(w,g+1),h!=null)return Us({layout:n,barSettings:x,pos:c,parentViewBox:a,bandSize:d,xAxis:r,yAxis:s,xAxisTicks:l,yAxisTicks:i,stackedData:u,displayedData:h,offset:t,cells:m,dataStartIndex:w})}}),vs=["index"];function Ee(){return Ee=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Ee.apply(null,arguments)}function js(t,a){if(t==null)return{};var r,s,l=ys(t,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(l[r]=t[r])}return l}function ys(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var bt=o.createContext(void 0),ks=t=>{var a=o.useContext(bt);if(a!=null)return a.stackId;if(t!=null)return Qt(t)},ws=(t,a)=>"recharts-bar-stack-clip-path-".concat(t,"-").concat(a),Ns=t=>{var a=o.useContext(bt);if(a!=null){var{stackId:r}=a;return"url(#".concat(ws(r,t),")")}},vt=t=>{var{index:a}=t,r=js(t,vs),s=Ns(a);return o.createElement(je,Ee({className:"recharts-bar-stack-layer",clipPath:s},r))},Cs=["onMouseEnter","onMouseLeave","onClick"],As=["value","background","tooltipPosition"],Ss=["id"],Is=["onMouseEnter","onClick","onMouseLeave"];function R(){return R=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},R.apply(null,arguments)}function et(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,s)}return r}function _(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?et(Object(r),!0).forEach(function(s){zs(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):et(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function zs(t,a,r){return(a=Es(a))in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function Es(t){var a=Ps(t,"string");return typeof a=="symbol"?a:a+""}function Ps(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function we(t,a){if(t==null)return{};var r,s,l=Ms(t,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)r=i[s],a.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(l[r]=t[r])}return l}function Ms(t,a){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(a.indexOf(s)!==-1)continue;r[s]=t[s]}return r}var Bs=t=>{var{dataKey:a,name:r,fill:s,legendType:l,hide:i}=t;return[{inactive:i,dataKey:a,type:l,color:s,value:ot(r,a),payload:t}]},_s=o.memo(t=>{var{dataKey:a,stroke:r,strokeWidth:s,fill:l,name:i,hide:c,unit:n,tooltipType:p,id:d}=t,u={dataDefinedOnItem:void 0,getPosition:la,settings:{stroke:r,strokeWidth:s,fill:l,dataKey:a,nameKey:void 0,name:ot(i,a),hide:c,type:p,color:l,unit:n,graphicalItemId:d}};return o.createElement(ia,{tooltipEntrySettings:u})});function Ds(t){var a=ye(dt),{data:r,dataKey:s,background:l,allOtherBarProps:i}=t,{onMouseEnter:c,onMouseLeave:n,onClick:p}=i,d=we(i,Cs),u=mt(c,s,i.id),x=ht(n),m=ft(p,s,i.id);if(!l||r==null)return null;var y=ma(l);return o.createElement(De,{zIndex:Ja(l,_e.barBackground)},r.map((w,g)=>{var{value:v,background:h,tooltipPosition:f}=w,b=we(w,As);if(!h)return null;var k=u(w,g),z=x(w,g),N=m(w,g),M=_(_(_(_(_({option:l,isActive:String(g)===a},b),{},{fill:"#eee"},h),y),xt(d,w,g)),{},{onMouseEnter:k,onMouseLeave:z,onClick:N,dataKey:s,index:g,className:"recharts-bar-background-rectangle"});return o.createElement(ke,R({key:"background-bar-".concat(g)},M))}))}function Os(t){var{showLabels:a,children:r,rects:s}=t,l=s==null?void 0:s.map(i=>{var c={x:i.x,y:i.y,width:i.width,lowerWidth:i.width,upperWidth:i.width,height:i.height};return _(_({},c),{},{value:i.value,payload:i.payload,parentViewBox:i.parentViewBox,viewBox:c,fill:i.fill})});return o.createElement(ba,{value:a?l:void 0},r)}function Ls(t){var{shape:a,activeBar:r,baseProps:s,entry:l,index:i,dataKey:c}=t,n=ye(dt),p=ye(ja),d=r&&String(i)===n&&(p==null||c===p),u=d?r:a;return d?o.createElement(De,{zIndex:_e.activeBar},o.createElement(vt,{index:i},o.createElement(ke,R({},s,{name:String(s.name)},l,{isActive:d,option:u,index:i,dataKey:c})))):o.createElement(ke,R({},s,{name:String(s.name)},l,{isActive:d,option:u,index:i,dataKey:c}))}function Ts(t){var{shape:a,baseProps:r,entry:s,index:l,dataKey:i}=t;return o.createElement(ke,R({},r,{name:String(r.name)},s,{isActive:!1,option:a,index:l,dataKey:i}))}function Ws(t){var a,{data:r,props:s}=t,l=(a=va(s))!==null&&a!==void 0?a:{},{id:i}=l,c=we(l,Ss),{shape:n,dataKey:p,activeBar:d}=s,{onMouseEnter:u,onClick:x,onMouseLeave:m}=s,y=we(s,Is),w=mt(u,p,i),g=ht(m),v=ft(x,p,i);return r?o.createElement(o.Fragment,null,r.map((h,f)=>o.createElement(vt,R({index:f,key:"rectangle-".concat(h==null?void 0:h.x,"-").concat(h==null?void 0:h.y,"-").concat(h==null?void 0:h.value,"-").concat(f),className:"recharts-bar-rectangle"},xt(y,h,f),{onMouseEnter:w(h,f),onMouseLeave:g(h,f),onClick:v(h,f)}),d?o.createElement(Ls,{shape:n,activeBar:d,baseProps:c,entry:h,index:f,dataKey:p}):o.createElement(Ts,{shape:n,baseProps:c,entry:h,index:f,dataKey:p})))):null}function Ks(t){var{props:a,previousRectanglesRef:r}=t,{data:s,layout:l,isAnimationActive:i,animationBegin:c,animationDuration:n,animationEasing:p,onAnimationEnd:d,onAnimationStart:u}=a,x=r.current,m=ha(a,"recharts-bar-"),[y,w]=o.useState(!1),g=!y,v=o.useCallback(()=>{typeof d=="function"&&d(),w(!1)},[d]),h=o.useCallback(()=>{typeof u=="function"&&u(),w(!0)},[u]);return o.createElement(Os,{showLabels:g,rects:s},o.createElement(fa,{animationId:m,begin:c,duration:n,isActive:i,easing:p,onAnimationEnd:v,onAnimationStart:h,key:m},f=>{var b=f===1?s:s==null?void 0:s.map((k,z)=>{var N=x&&x[z];if(N)return _(_({},k),{},{x:U(N.x,k.x,f),y:U(N.y,k.y,f),width:U(N.width,k.width,f),height:U(N.height,k.height,f)});if(l==="horizontal"){var M=U(0,k.height,f),E=U(k.stackedBarStart,k.y,f);return _(_({},k),{},{y:E,height:M})}var A=U(0,k.width,f),C=U(k.stackedBarStart,k.x,f);return _(_({},k),{},{width:A,x:C})});return f>0&&(r.current=b??null),b==null?null:o.createElement(je,null,o.createElement(Ws,{props:a,data:b}))}),o.createElement(ga,{label:a.label}),a.children)}function Rs(t){var a=o.useRef(null);return o.createElement(Ks,{previousRectanglesRef:a,props:t})}var jt=0,Gs=(t,a)=>{var r=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:r,errorVal:ct(t,a)}};class $s extends o.PureComponent{render(){var{hide:a,data:r,dataKey:s,className:l,xAxisId:i,yAxisId:c,needClip:n,background:p,id:d}=this.props;if(a||r==null)return null;var u=da("recharts-bar",l),x=d;return o.createElement(je,{className:u,id:d},n&&o.createElement("defs",null,o.createElement(xa,{clipPathId:x,xAxisId:i,yAxisId:c})),o.createElement(je,{className:"recharts-bar-rectangles",clipPath:n?"url(#clipPath-".concat(x,")"):void 0},o.createElement(Ds,{data:r,dataKey:s,background:p,allOtherBarProps:this.props}),o.createElement(Rs,this.props)))}}var Vs={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:jt,xAxisId:0,yAxisId:0,zIndex:_e.bar};function Fs(t){var{xAxisId:a,yAxisId:r,hide:s,legendType:l,minPointSize:i,activeBar:c,animationBegin:n,animationDuration:p,animationEasing:d,isAnimationActive:u}=t,{needClip:x}=na(a,r),m=oa(),y=nt(),w=ca(t.children,pt),g=ye(f=>bs(f,t.id,y,w));if(m!=="vertical"&&m!=="horizontal")return null;var v,h=g==null?void 0:g[0];return h==null||h.height==null||h.width==null?v=0:v=m==="vertical"?h.height/2:h.width/2,o.createElement(Ca,{xAxisId:a,yAxisId:r,data:g,dataPointFormatter:Gs,errorBarOffset:v},o.createElement($s,R({},t,{layout:m,needClip:x,data:g,xAxisId:a,yAxisId:r,hide:s,legendType:l,minPointSize:i,activeBar:c,animationBegin:n,animationDuration:p,animationEasing:d,isAnimationActive:u})))}function Us(t){var{layout:a,barSettings:{dataKey:r,minPointSize:s},pos:l,bandSize:i,xAxis:c,yAxis:n,xAxisTicks:p,yAxisTicks:d,stackedData:u,displayedData:x,offset:m,cells:y,parentViewBox:w,dataStartIndex:g}=t,v=a==="horizontal"?n:c,h=u?v.scale.domain():null,f=ua({numericAxis:v}),b=v.scale.map(f);return x.map((k,z)=>{var N,M,E,A,C,D;if(u){var T=u[z+g];if(T==null)return null;N=pa(T,h)}else N=ct(k,r),Array.isArray(N)||(N=[f,N]);var P=ts(s,jt)(N[1],z);if(a==="horizontal"){var G,$=n.scale.map(N[0]),W=n.scale.map(N[1]);if($==null||W==null)return null;M=Ye({axis:c,ticks:p,bandSize:i,offset:l.offset,entry:k,index:z}),E=(G=W??$)!==null&&G!==void 0?G:void 0,A=l.size;var se=$-W;if(C=ya(se)?0:se,D={x:M,y:m.top,width:A,height:m.height},Math.abs(P)>0&&Math.abs(C)<Math.abs(P)){var re=Ze(C||P)*(Math.abs(P)-Math.abs(C));E-=re,C+=re}}else{var Z=c.scale.map(N[0]),ie=c.scale.map(N[1]);if(Z==null||ie==null)return null;if(M=Z,E=Ye({axis:n,ticks:d,bandSize:i,offset:l.offset,entry:k,index:z}),A=ie-Z,C=l.size,D={x:m.left,y:E,width:m.width,height:C},Math.abs(P)>0&&Math.abs(A)<Math.abs(P)){var le=Ze(A||P)*(Math.abs(P)-Math.abs(A));A+=le}}if(M==null||E==null||A==null||C==null)return null;var ne=_(_({},k),{},{stackedBarStart:b,x:M,y:E,width:A,height:C,value:u?N:N[1],payload:k,background:D,tooltipPosition:{x:M+A/2,y:E+C/2},parentViewBox:w},y&&y[z]&&y[z].props);return ne}).filter(Boolean)}function Hs(t){var a=ta(t,Vs),r=ks(a.stackId),s=nt();return o.createElement(aa,{id:a.id,type:"bar"},l=>o.createElement(o.Fragment,null,o.createElement(sa,{legendPayload:Bs(a)}),o.createElement(_s,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:l}),o.createElement(ra,{type:"bar",id:l,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:r,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:s}),o.createElement(De,{zIndex:a.zIndex},o.createElement(Fs,R({},a,{id:l})))))}var yt=o.memo(Hs,ea);yt.displayName="Bar";var qs=["axis","item"],Ys=o.forwardRef((t,a)=>o.createElement(ka,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:qs,tooltipPayloadSearcher:wa,categoricalChartProps:t,ref:a}));const Zs=({onClose:t})=>e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3rem] shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(tt,{size:28})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-slate-800 uppercase tracking-tighter",children:"Unified Movement Registry API"}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:"Endpoint: /flocks/:flockId/cycles/:cycleId/movements"})]})]}),e.jsx("button",{onClick:t,className:"p-3 bg-slate-100 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-2xl transition-all shadow-sm",children:e.jsx(Pe,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-10 space-y-12 no-scrollbar",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Et,{className:"text-blue-500",size:24}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Core Schemas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-blue-400 mb-6 flex items-center gap-2",children:[e.jsx(Fe,{size:12})," BIRD INFLOW (in)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-blue-300 leading-relaxed overflow-x-auto",children:`{
  "type": "in",
  "reason": "purchase",
  "birdMetrics": {
    "count": 5000,
    "ageAtMovement": 4,
    "breed": "Lohmann Brown"
  },
  "weightMetrics": {
    "startWeightGrams": 1200
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-amber-400 mb-6 flex items-center gap-2",children:[e.jsx(be,{size:12})," RESOURCE INTAKE (feed)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-amber-300 leading-relaxed overflow-x-auto",children:`{
  "type": "feed",
  "date": "2024-03-20T10:00:00Z",
  "feedMetrics": {
    "consumedKg": 350,
    "purchasedKg": 1000,
    "feedType": "Starter",
    "supplier": "Cargill Node 4"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-emerald-400 mb-6 flex items-center gap-2",children:[e.jsx(Fe,{size:12})," EGG COLLECTION"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-emerald-300 leading-relaxed overflow-x-auto",children:`{
  "type": "egg_collection",
  "reason": "daily_collection",
  "eggMetrics": {
    "count": 4850,
    "totalWeightKg": 291
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-900 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-6 flex items-center gap-2",children:[e.jsx($a,{size:12})," MASS SAMPLE (weight)"]}),e.jsx("div",{className:"bg-black/30 p-5 rounded-2xl text-[11px] font-mono text-indigo-300 leading-relaxed overflow-x-auto",children:`{
  "type": "weight",
  "weightMetrics": {
    "averageWeightGrams": 1890,
    "startWeightGrams": 1850,
    "endWeightGrams": 1920,
    "measurementMethod": "scale"
  }
}`})]}),e.jsxs("div",{className:"p-8 bg-slate-50 rounded-[2.5rem] border border-slate-200",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-slate-500 mb-6 flex items-center gap-2",children:[e.jsx(st,{size:12})," MANUAL ADJUSTMENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-slate-700 leading-relaxed border border-slate-100 shadow-inner",children:`{
  "type": "adjustment",
  "reason": "inspection",
  "birdMetrics": {
    "count": -2
  },
  "notes": "Physical audit correction"
}`})]}),e.jsxs("div",{className:"p-8 bg-rose-50 rounded-[2.5rem] border border-rose-100",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase text-rose-500 mb-6 flex items-center gap-2",children:[e.jsx(ve,{size:12})," MORTALITY EVENT"]}),e.jsx("div",{className:"bg-white p-5 rounded-2xl text-[11px] font-mono text-rose-700 leading-relaxed border border-rose-100 shadow-inner",children:`{
  "type": "mortality",
  "reason": "disease",
  "mortalityMetrics": {
    "count": 3
  },
  "notes": "Respiratory infection"
}`})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-[2.5rem] p-8 flex items-center gap-8 shadow-sm",children:[e.jsx(ve,{size:48,className:"text-amber-600 shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-black text-amber-900 uppercase tracking-tight",children:"Security & Immutability"}),e.jsxs("p",{className:"text-[11px] font-medium text-amber-800 leading-relaxed",children:["All records once committed are assigned a ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"NODE_ID"})," and entered into the audit trail. Deletion requires an explicit ",e.jsx("code",{className:"bg-amber-200 p-0.5 rounded",children:"permanent=true"})," flag and high-level clearance."]})]})]})]}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end bg-white",children:e.jsx("button",{onClick:t,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all",children:"Close Documentation"})})]})}),Xs=({currentCycle:t,movementsCount:a,flockName:r,selectedCycleId:s,formatDate:l})=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4 animate-in slide-in-from-top-4 duration-700",children:[e.jsxs("div",{className:"bg-slate-900 rounded-2xl lg:rounded-3xl p-4 lg:p-6 text-white border border-white/5 shadow-xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 transition-transform duration-1000",children:e.jsx(at,{size:60})}),e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1",children:"Cycle Integrity"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black tracking-tighter uppercase",children:(t==null?void 0:t.status)||"N/A"}),e.jsxs("div",{className:"mt-2 lg:mt-3 flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(t==null?void 0:t.status)==="active"?"bg-emerald-500 animate-pulse":"bg-slate-500"}`}),e.jsxs("span",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400",children:["Since ",t?l(t.startDate):"---"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm group",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Total Logs"}),e.jsx("h4",{className:"text-2xl lg:text-3xl font-black text-slate-900 tabular-nums",children:a}),e.jsxs("p",{className:"text-[9px] lg:text-[10px] font-bold text-blue-600 mt-1 lg:mt-2",children:["ID: ",s]})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Production Node"}),e.jsx("h4",{className:"text-xl lg:text-2xl font-black text-slate-900 uppercase truncate",children:r||"---"}),e.jsx("p",{className:"text-[9px] lg:text-[10px] font-bold text-slate-400 mt-1 lg:mt-2 uppercase tracking-widest",children:"Fleet Active"})]}),e.jsxs("div",{className:"bg-white rounded-2xl lg:rounded-3xl p-4 lg:p-6 border border-slate-200 shadow-sm flex flex-col justify-between",children:[e.jsx("p",{className:"text-[8px] lg:text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"System Health"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs lg:text-sm font-black text-slate-800 font-mono uppercase",children:"Nominal"}),e.jsx(ve,{size:18,className:"text-emerald-500"})]})]})]}),Js=({viewMode:t,setViewMode:a,searchTerm:r,setSearchTerm:s,selectedCycleId:l,onCycleChange:i,cycles:c,loadingCycles:n,onShowDocs:p,isRtl:d,t:u})=>e.jsx("div",{className:"p-4 lg:p-8 border-b border-slate-100 bg-slate-50/30",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[e.jsxs("div",{className:"flex bg-white border border-slate-200 p-1 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>a("list"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="list"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(La,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"List"})]}),e.jsxs("button",{onClick:()=>a("visual"),className:`flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all ${t==="visual"?"bg-slate-900 text-white shadow-lg":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(_t,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Visual"})]})]}),e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(Dt,{className:`absolute ${d?"right-4":"left-4"} top-1/2 -translate-y-1/2 text-slate-400`,size:16}),e.jsx("input",{type:"text",placeholder:d?"جستجوی فید داده...":"Search stream...",className:`w-full ${d?"pr-10":"pl-10"} py-2.5 bg-white border border-slate-200 rounded-xl text-xs font-bold shadow-sm focus:ring-4 focus:ring-blue-500/10 outline-none`,value:r,onChange:x=>s(x.target.value)})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-white border border-slate-200 rounded-xl px-3 py-1.5 shadow-sm gap-2 h-[42px] flex-1 min-w-[200px]",children:[e.jsx(J,{size:14,className:"text-slate-400 shrink-0"}),e.jsxs("select",{value:l,onChange:x=>i(x.target.value),className:"bg-transparent border-none text-[9px] font-black uppercase tracking-widest text-slate-700 outline-none cursor-pointer w-full",children:[e.jsx("option",{value:"",children:n?u.loading:u.selectCycle}),c.map(x=>e.jsxs("option",{value:x.cycleId,children:[x.cycleId," ",x.status==="active"?"• ACT":""]},x.cycleId))]}),n&&e.jsx(ce,{size:12,className:"animate-spin text-blue-500 shrink-0"})]}),e.jsxs("button",{onClick:p,className:"h-[42px] px-6 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 transition-all flex items-center justify-center gap-2 text-[9px] font-black uppercase tracking-widest shadow-sm ml-auto",children:[e.jsx(tt,{size:14})," ",u.reference]})]})]})}),Qs=({level:t})=>{const a=t==="high"?3:t==="medium"?2:1;return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 text-amber-400",children:[...Array(3)].map((r,s)=>e.jsx(Kt,{size:10,fill:s<a?"currentColor":"none",className:s<a?"":"text-slate-200"},s))}),e.jsx("span",{className:"text-[8px] font-black uppercase text-slate-400 tracking-widest",children:t})]})},kt=t=>{var r,s,l,i,c,n,p,d,u,x,m,y;switch(t.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"adjustment":case"sale":return((r=t.birdMetrics)==null?void 0:r.count)??0;case"mortality":return((s=t.mortalityMetrics)==null?void 0:s.count)??((l=t.birdMetrics)==null?void 0:l.count)??0;case"egg_collection":case"egg_breakage":return((i=t.eggMetrics)==null?void 0:i.count)??0;case"weight_measurement":case"weight":return((c=t.weightMetrics)==null?void 0:c.currentWeightGrams)??((n=t.weightMetrics)==null?void 0:n.averageWeightGrams)??((p=t.weightMetrics)==null?void 0:p.grams)??((d=t.weightMetrics)==null?void 0:d.startWeightGrams)??((u=t.weightMetrics)==null?void 0:u.endWeightGrams)??0;case"feed_in":case"feed_supply":return((x=t.feedMetrics)==null?void 0:x.boughtKg)??((m=t.feedMetrics)==null?void 0:m.purchasedKg)??0;case"feed_consumed":case"feed_consumption":case"feed":return((y=t.feedMetrics)==null?void 0:y.consumedKg)??0;default:return 0}},er=t=>{switch(t.type.toLowerCase()){case"bird_inflow":case"in":case"bird_outflow":case"out":case"mortality":case"sale":case"adjustment":return"Birds";case"egg_collection":case"egg_breakage":return"Eggs";case"weight_measurement":case"weight":return"Grams";case"feed_in":case"feed_supply":case"feed_consumed":case"feed_consumption":case"feed":return"KG";default:return""}},tr=t=>{const a=t.type.toLowerCase();return a==="in"?"Bird Inflow":a==="out"?"Bird Outflow":a==="weight"?"Mass Sample":a==="feed"?"Feed Withdrawal":a==="feed_in"||a==="feed_supply"?"Feed Supply":a==="feed_consumed"||a==="feed_consumption"?"Feed Consumption":t.type.replace(/_/g," ")},ar=({movements:t,formatDate:a,onEdit:r,onDelete:s,onLock:l,onUnlock:i,onViewHistory:c})=>e.jsx("div",{className:"overflow-x-auto no-scrollbar",children:e.jsxs("table",{className:"w-full text-left text-sm border-collapse min-w-[1100px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/80 text-slate-400 font-black border-b border-slate-200 uppercase tracking-[0.2em] text-[9px] lg:text-[10px]",children:[e.jsx("th",{className:"px-6 py-4 w-20 text-center",children:"Vector"}),e.jsx("th",{className:"px-6 py-4",children:"Event Time"}),e.jsx("th",{className:"px-6 py-4",children:"Type / Reason"}),e.jsx("th",{className:"px-6 py-4",children:"Quantity"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Consensus"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50 bg-white",children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-24 text-center opacity-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(Ot,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Registry Empty"})]})})}):t.map(n=>{var p;return e.jsxs("tr",{className:`hover:bg-blue-50/10 transition-all group ${n.locked?"bg-slate-50/30":""}`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`w-10 h-10 mx-auto rounded-xl flex items-center justify-center transition-transform group-hover:scale-110 ${["bird_inflow","in","egg_collection","feed_in","feed_supply"].includes(n.type.toLowerCase())?"bg-emerald-50 text-emerald-600":["mortality","egg_breakage","bird_outflow","out","feed_consumed","feed_consumption","feed"].includes(n.type.toLowerCase())?"bg-amber-50 text-amber-600":["weight","weight_measurement"].includes(n.type.toLowerCase())?"bg-blue-50 text-blue-600":"bg-slate-50 text-slate-500"}`,children:["bird_inflow","in","egg_collection","feed_in","feed_supply"].includes(n.type.toLowerCase())?e.jsx(Da,{size:18}):e.jsx(Lt,{size:18})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-xs font-black text-slate-900",children:a(n.date)}),e.jsxs("div",{className:"text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-0.5 font-mono",children:["NODE ID: ",n._id.slice(-6).toUpperCase()]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[7px] font-black uppercase tracking-widest self-start",children:tr(n)}),e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-tight ml-1",children:((p=n.reason)==null?void 0:p.replace(/_/g," "))||"registry_entry"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-end gap-1",children:[e.jsx("span",{className:"text-base font-black text-slate-900 tabular-nums",children:kt(n).toLocaleString()}),e.jsx("span",{className:"text-[8px] font-bold text-slate-400 uppercase mb-1",children:er(n)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Qs,{level:n.confidence})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${n.locked?"bg-amber-50 text-amber-600 border-amber-100":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:n.locked?e.jsxs(e.Fragment,{children:[e.jsx($e,{size:10})," Locked"]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:10})," Editable"]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(n),className:"p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all",title:"View Audit Trail",children:e.jsx(J,{size:16})}),!n.locked&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(n),className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all",title:"Edit Metrics",children:e.jsx(Tt,{size:16})}),e.jsx("button",{onClick:()=>s(n),className:"p-2 text-rose-600 hover:bg-rose-50 rounded-lg transition-all",title:"Soft Delete",children:e.jsx(Me,{size:16})})]}),e.jsx("button",{onClick:()=>n.locked?i(n):l(n),className:`p-2 rounded-lg transition-all ${n.locked?"text-amber-600 hover:bg-amber-50":"text-slate-400 hover:text-amber-600 hover:bg-amber-50"}`,title:n.locked?"Request Unlock":"Verify & Lock",children:n.locked?e.jsx($e,{size:16}):e.jsx(Xe,{size:16})})]})})]},n._id)})})]})}),sr=({loading:t,data:a})=>{if(t)return e.jsxs("div",{className:"h-[400px] flex flex-col items-center justify-center gap-4 opacity-40",children:[e.jsx(ce,{size:32,className:"animate-spin text-blue-600"}),e.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.4em]",children:"Compiling Analytics..."})]});const r=a.weights&&a.weights.length>0,s=a.eggs&&a.eggs.length>0,l=a.feed&&a.feed.length>0,i=a.birdBalance&&a.birdBalance.length>0,c=p=>{switch(p){case"in":return"#10b981";case"mortality":return"#ef4444";case"sale":case"out":return"#f59e0b";default:return"#6366f1"}},n=({active:p,payload:d,label:u})=>{if(p&&d&&d.length){const x=d[0].payload;return e.jsxs("div",{className:"bg-slate-900 border border-white/10 p-4 rounded-2xl shadow-2xl en-text",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2",children:new Date(x.date).toLocaleDateString()}),d.map((m,y)=>e.jsxs("div",{className:"flex items-center gap-3 mb-1 last:mb-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:m.color||m.fill||m.stroke}}),e.jsxs("p",{className:"text-[11px] font-black text-white uppercase tracking-tight en-text",children:[m.name||m.dataKey,": ",e.jsx("span",{className:"text-blue-400",children:m.value.toLocaleString()})]})]},y)),x.type&&e.jsxs("p",{className:`mt-2 text-[9px] font-black uppercase tracking-widest px-2 py-0.5 rounded text-center en-text ${x.type==="mortality"?"bg-rose-500/20 text-rose-400":x.type==="in"?"bg-emerald-500/20 text-emerald-400":"bg-blue-500/20 text-blue-400"}`,children:["EVENT: ",x.type]})]})}return null};return e.jsx("div",{className:"p-6 lg:p-14 space-y-8 lg:space-y-14 animate-in fade-in duration-700",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[450px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-2xl group-hover:rotate-6 transition-transform shadow-sm",children:e.jsx(st,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Mass Velocity"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Weight Progression (Grams)"})]})]}),e.jsx(Rt,{size:24,className:"text-emerald-500"})]}),e.jsx("div",{className:"flex-1 min-h-[300px] w-full relative",children:r?e.jsx(ue,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Ce,{data:a.weights,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"massCurve",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.15}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(pe,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(me,{dataKey:"date",hide:!0}),e.jsx(he,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["auto","auto"]}),e.jsx(fe,{content:e.jsx(n,{})}),e.jsx(Ae,{type:"monotone",dataKey:"grams",name:"Weight",stroke:"#3b82f6",strokeWidth:4,fillOpacity:1,fill:"url(#massCurve)",animationDuration:1e3})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(J,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Historical Mass Samples"})]})})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[450px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-50 text-emerald-600 rounded-2xl group-hover:scale-110 transition-transform shadow-sm",children:e.jsx(Pt,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Egg Collection Volume"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Total Daily Yield (Count)"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 rounded-xl border border-emerald-100",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.6)]"}),e.jsx("span",{className:"text-[10px] font-black uppercase text-emerald-600 tracking-widest",children:"Total Yield"})]})})]}),e.jsx("div",{className:"flex-1 min-h-[300px] w-full relative",children:s?e.jsx(ue,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Ys,{data:a.eggs,margin:{top:10,right:10,left:-20,bottom:0},barGap:0,children:[e.jsx(pe,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(me,{dataKey:"date",hide:!0}),e.jsx(he,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["auto","auto"]}),e.jsx(fe,{content:e.jsx(n,{})}),e.jsx(yt,{dataKey:"count",name:"Total Eggs",fill:"#10b981",radius:[12,12,0,0],barSize:72,animationDuration:1e3}),e.jsx(Aa,{type:"monotone",dataKey:"broken",name:"Broken",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(J,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Yield Ingestion"})]})})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[2.5rem] p-8 lg:p-10 shadow-sm group min-h-[480px] flex flex-col xl:col-span-2 overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-6 shrink-0 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-slate-900 text-white rounded-2xl group-hover:rotate-3 transition-transform shadow-lg",children:e.jsx(Ve,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-black text-slate-900 uppercase tracking-tight",children:"Chicken Balances"}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest",children:"Live Census Tracking & Lifecycle Events"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"In"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-rose-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"Loss"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full shadow-[0_0_8px_rgba(245,158,11,0.5)]"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-slate-500 tracking-tight en-text",children:"Out"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-[320px] w-full relative z-10",children:i?e.jsx(ue,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Ce,{data:a.birdBalance,margin:{top:20,right:20,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"popGrad",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#0f172a",stopOpacity:.08}),e.jsx("stop",{offset:"95%",stopColor:"#0f172a",stopOpacity:0})]})}),e.jsx(pe,{strokeDasharray:"3 3",vertical:!0,stroke:"#f1f5f9"}),e.jsx(me,{dataKey:"date",hide:!0}),e.jsx(he,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#94a3b8"},domain:["dataMin - 100","dataMax + 100"]}),e.jsx(fe,{content:e.jsx(n,{})}),e.jsx(Ae,{type:"monotone",dataKey:"liveBirds",name:"Fleet Population",stroke:"#0f172a",strokeWidth:4,fill:"url(#popGrad)",fillOpacity:1,animationDuration:1500,dot:p=>{const{cx:d,cy:u,payload:x}=p;return x.type?e.jsxs("g",{children:[e.jsx("circle",{cx:d,cy:u,r:8,fill:c(x.type),opacity:.2}),e.jsx("circle",{cx:d,cy:u,r:4.5,fill:c(x.type),stroke:"white",strokeWidth:2,className:"filter drop-shadow-md"})]},`event-${x.date}`):null},activeDot:{r:6,strokeWidth:0}})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-4 opacity-40",children:[e.jsx(Ve,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Census Data"})]})}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-50 flex items-center justify-between text-[9px] font-black text-slate-400 uppercase tracking-widest shrink-0 relative z-10 en-text",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ve,{size:12,className:"text-emerald-500"})," Ledger Verified"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(J,{size:12})," Sync: Active"]})]}),e.jsx("span",{children:"Protocol: CENSUS-V4.2"})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] lg:rounded-[3.5rem] p-8 lg:p-12 xl:col-span-2 shadow-2xl relative overflow-hidden min-h-[450px] flex flex-col",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 text-white",children:e.jsx(be,{size:120})}),e.jsxs("div",{className:"flex items-center gap-5 mb-10 relative z-10 shrink-0",children:[e.jsx("div",{className:"p-4 bg-white/10 text-white rounded-2xl shadow-lg border border-white/5",children:e.jsx(be,{size:32})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-2xl font-black text-white uppercase tracking-tighter",children:"Resource Drain Matrix"}),e.jsx("p",{className:"text-[9px] font-black text-slate-500 uppercase tracking-[0.4em] mt-1",children:"Consolidated Feed Withdrawal (KG)"})]})]}),e.jsx("div",{className:"flex-1 min-h-[300px] relative z-10 w-full",children:l?e.jsx(ue,{width:"100%",height:"100%",minWidth:0,children:e.jsxs(Ce,{data:a.feed,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"feedGrad",x1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#fbbf24",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#fbbf24",stopOpacity:0})]})}),e.jsx(pe,{strokeDasharray:"3 3",vertical:!1,stroke:"#ffffff10"}),e.jsx(me,{dataKey:"date",hide:!0}),e.jsx(he,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#64748b"}}),e.jsx(fe,{contentStyle:{backgroundColor:"#0f172a",borderRadius:"16px",border:"1px solid #1e293b",color:"white"},itemStyle:{color:"#fbbf24",fontWeight:900}}),e.jsx(Ae,{type:"monotone",dataKey:"consumedKg",name:"Feed Intake",stroke:"#fbbf24",strokeWidth:4,fill:"url(#feedGrad)",animationDuration:1e3})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-700 gap-4 opacity-40",children:[e.jsx(be,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Awaiting Resource Ingestion Stream"})]})})]})]})})},rr=({movement:t,flockId:a,onClose:r,api:s})=>{const[l,i]=o.useState([]),[c,n]=o.useState(!0);o.useEffect(()=>{(async()=>{try{const u=t.flockId||a;if(!u||u==="all"){i([]),n(!1);return}const x=await s.getMovementHistory(u,t.cycleId,t._id);let m=[];x&&Array.isArray(x.history)?m=x.history:x&&Array.isArray(x.data)?m=x.data:Array.isArray(x)&&(m=x),i(m)}catch(u){console.error("Audit history inaccessible",u),i([])}finally{n(!1)}})()},[t._id,a,t.cycleId,s,t.flockId]);const p=Array.isArray(l)?l:[];return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-300 flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(J,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:"Audit Trail"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mt-1",children:["Ref: ",t._id.slice(-8).toUpperCase()]})]})]}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-xl transition-all shadow-sm",children:e.jsx(Pe,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 no-scrollbar",children:c?e.jsxs("div",{className:"py-20 flex flex-col items-center gap-4 opacity-40",children:[e.jsx(ce,{className:"animate-spin text-blue-600",size:32}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Querying Node History..."})]}):p.length===0?e.jsxs("div",{className:"py-20 text-center flex flex-col items-center gap-4 opacity-30",children:[e.jsx(at,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"No revision history found"})]}):e.jsxs("div",{className:"space-y-8 relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-px bg-slate-100"}),p.map((d,u)=>e.jsxs("div",{className:"relative pl-14 group",children:[e.jsx("div",{className:"absolute left-[21px] top-0 w-2.5 h-2.5 rounded-full bg-slate-200 border-2 border-white group-hover:bg-blue-500 transition-colors"}),e.jsxs("div",{className:"bg-slate-50 border border-slate-100 rounded-2xl p-5 group-hover:bg-white group-hover:border-blue-200 group-hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-900 text-white rounded text-[8px] font-black uppercase tracking-widest",children:d.action}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-bold text-slate-50",children:[e.jsx(Ia,{size:12,className:"text-slate-400"})," ",new Date(d.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-black text-blue-600 uppercase",children:[e.jsx(Mt,{size:12})," ",d.userName||"Operator"]})]}),d.changes&&Array.isArray(d.changes)&&d.changes.length>0&&e.jsx("div",{className:"space-y-3 pt-3 border-t border-slate-100",children:d.changes.map((x,m)=>e.jsxs("div",{className:"flex items-center gap-3 text-[11px] font-medium",children:[e.jsx("span",{className:"text-slate-400 font-black uppercase tracking-tighter w-24 truncate",children:x.field}),e.jsx("span",{className:"text-rose-500 line-through opacity-50",children:String(x.oldValue)}),e.jsx(za,{size:10,className:"text-slate-300"}),e.jsx("span",{className:"text-emerald-600 font-black",children:String(x.newValue)})]},m))})]})]},u))]})}),e.jsx("div",{className:"p-8 border-t border-slate-100 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-10 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em]",children:"Close View"})})]})})},ir=({flockId:t,cycleId:a,onClose:r,onSuccess:s,api:l})=>{const[i,c]=o.useState([]),[n,p]=o.useState(!1),[d,u]=o.useState(""),x=o.useRef(null),m=g=>{var f;const v=(f=g.target.files)==null?void 0:f[0];if(!v)return;const h=new FileReader;h.onload=b=>{var E;const z=((E=b.target)==null?void 0:E.result).split(`
`),N=z[0].split(",").map(A=>A.trim()),M=z.slice(1).filter(A=>A.trim()).map(A=>{const C=A.split(",").map(T=>T.trim()),D={type:"weight_measurement",confidence:"high"};return N.forEach((T,P)=>{T==="weight"&&(D.weightMetrics={averageWeightGrams:parseFloat(C[P])}),T==="date"&&(D.date=C[P]),T==="count"&&(D.birdMetrics={count:parseInt(C[P])})}),D});c([...i,...M])},h.readAsText(v)},y=()=>{c([...i,{date:new Date().toISOString().split("T")[0],type:"weight_measurement",weightMetrics:{averageWeightGrams:0}}])},w=async()=>{if(i.length!==0){p(!0);try{await l.submitBulkMovement(t,a,i),s()}catch(g){u(g.message||"Bulk ingestion protocol failed")}finally{p(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[250] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-[3.5rem] shadow-2xl w-full max-w-6xl max-h-[85vh] flex flex-col overflow-hidden animate-in zoom-in-95",children:[e.jsxs("div",{className:"p-10 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-xl",children:e.jsx(ut,{size:32})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 uppercase tracking-tighter",children:"Bulk Ingestion Engine"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] mt-2",children:["Node Proxy: ",t.slice(-8).toUpperCase()," • Cycle: ",a]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>{var g;return(g=x.current)==null?void 0:g.click()},className:"px-6 py-3 bg-white border border-slate-200 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-50 transition-all flex items-center gap-2",children:[e.jsx(Ra,{size:14})," Import CSV"]}),e.jsx("input",{type:"file",ref:x,className:"hidden",accept:".csv",onChange:m}),e.jsx("button",{onClick:r,className:"p-3 bg-white hover:bg-rose-50 text-slate-400 hover:text-rose-500 rounded-2xl transition-all",children:e.jsx(Pe,{size:24})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-10 no-scrollbar",children:i.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 gap-6 opacity-40",children:[e.jsx(Ea,{size:80,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-black uppercase tracking-[0.2em]",children:"Buffer Ready"}),e.jsx("p",{className:"text-sm font-bold uppercase mt-2",children:"Upload CSV or add rows manually to begin batch logging"})]})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100",children:[e.jsx("th",{className:"pb-4 px-4",children:"Effective Date"}),e.jsx("th",{className:"pb-4 px-4",children:"Metric Value"}),e.jsx("th",{className:"pb-4 px-4",children:"Confidence"}),e.jsx("th",{className:"pb-4 px-4 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:i.map((g,v)=>{var h;return e.jsxs("tr",{className:"group hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"date",value:g.date,onChange:f=>{const b=[...i];b[v].date=f.target.value,c(b)},className:"bg-transparent font-bold text-sm outline-none focus:text-blue-600"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"number",value:((h=g.weightMetrics)==null?void 0:h.averageWeightGrams)||0,onChange:f=>{const b=[...i];b[v].weightMetrics={averageWeightGrams:parseFloat(f.target.value)},c(b)},className:"bg-transparent font-black text-sm outline-none focus:text-blue-600 tabular-nums"})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("select",{value:g.confidence,onChange:f=>{const b=[...i];b[v].confidence=f.target.value,c(b)},className:"bg-transparent text-[10px] font-black uppercase tracking-widest outline-none",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})}),e.jsx("td",{className:"py-4 px-4 text-right",children:e.jsx("button",{onClick:()=>c(i.filter((f,b)=>b!==v)),className:"p-2 text-slate-300 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Me,{size:16})})})]},v)})})]})}),e.jsxs("div",{className:"p-10 border-t border-slate-100 flex items-center justify-between bg-slate-50/30",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(Pa,{size:16})," Append Data Row"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:r,className:"px-10 py-5 bg-white border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-widest text-slate-400",children:"Discard Batch"}),e.jsx("button",{disabled:n||i.length===0,onClick:w,className:"px-14 py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl hover:bg-black transition-all flex items-center gap-3",children:n?e.jsx(ce,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ma,{size:18})," Commit Batch (",i.length,")"]})})]})]})]})})},Mr=({movements:t,userRole:a,capabilities:r,t:s,api:l,selectedFlockId:i,flocks:c,selectedCycleId:n,onCycleChange:p,onRefresh:d})=>{var Re;const[u,x]=o.useState("list"),[m,y]=o.useState(""),[w,g]=o.useState(!1),[v,h]=o.useState(!1),[f,b]=o.useState(!1),[k,z]=o.useState([]),[N,M]=o.useState(!1),[E,A]=o.useState(t),[C,D]=o.useState(null),[T,P]=o.useState(""),[G,$]=o.useState(null),[W,se]=o.useState(""),[re,Z]=o.useState(!1),[ie,le]=o.useState(null),[ne,Oe]=o.useState(null),[K,wt]=o.useState({weights:[],feed:[],eggs:[],birdBalance:[]}),[Nt,Le]=o.useState(!1),B=s.langToggle==="EN";o.useEffect(()=>{const j=t.filter(S=>{var V;const I=m.toLowerCase(),O=!I||S.type.toLowerCase().includes(I)||((V=S.reason)==null?void 0:V.toLowerCase().includes(I))||S._id.toLowerCase().includes(I);return S.isDeleted!==!0&&O});A(j)},[t,m]);const oe=o.useMemo(()=>{const j=[],S=[],I=[],O=[];return[...E].sort((L,F)=>new Date(L.date).getTime()-new Date(F.date).getTime()).forEach(L=>{var Ge;const F=L.date.split("T")[0],X=L.type.toLowerCase(),xe=kt(L);["weight","weight_measurement"].includes(X)?j.push({date:F,grams:xe}):["feed","feed_consumed","feed_consumption"].includes(X)?S.push({date:F,consumedKg:xe}):X==="egg_collection"?I.push({date:F,count:xe,broken:((Ge=L.eggMetrics)==null?void 0:Ge.broken)||0}):["in","bird_inflow","mortality","out","bird_outflow","sale"].includes(X)&&O.push({date:F,value:xe,type:X.includes("in")?"in":X.includes("mortality")?"mortality":"out"})}),{weights:j,feed:S,eggs:I,birdEvents:O}},[E]),Ct=o.useMemo(()=>({weights:K.weights.length>0?K.weights:oe.weights,feed:K.feed.length>0?K.feed:oe.feed,eggs:K.eggs.length>0?K.eggs:oe.eggs,birdBalance:K.birdBalance.length>0?K.birdBalance:oe.birdEvents.map(j=>({date:j.date,liveBirds:0,type:j.type}))}),[K,oe]),Te=async()=>{if(i&&i!=="all"){M(!0);try{const S=((await l.getCycles(i)).cycles||[]).sort((I,O)=>O.cycleId.localeCompare(I.cycleId));if(z(S),!n&&S.length>0){const I=S.find(O=>O.status==="active")||S[0];p(I.cycleId)}}catch(j){console.error("Failed to load cycles",j)}finally{M(!1)}}else z([])};o.useEffect(()=>{Te()},[i,l]),o.useEffect(()=>{(async()=>{if(u==="visual"&&i!=="all"&&n){Le(!0);try{const[S,I,O,V]=await Promise.all([l.getWeights(i,n).catch(()=>({weights:[]})),l.getFeed(i,n).catch(()=>({data:[]})),l.getEggs(i,n).catch(()=>({eggs:[]})),l.getBirdBalance(i,n).catch(()=>({data:[]}))]);wt({weights:S.weights||[],feed:I.data||[],eggs:O.eggs||[],birdBalance:V.data||[]})}catch(S){console.error("Visual sync failed",S)}finally{Le(!1)}}})()},[u,i,n,l]);const At=async()=>{if(!G||!W)return;const{movement:j,type:S}=G;try{const I=j.flockId||i;S==="lock"?await l.lockMovement(I,j.cycleId,j._id,W):await l.unlockMovement(I,j.cycleId,j._id,W),d(),$(null),se("")}catch(I){alert(I.message)}},St=async()=>{var O,V;if(!C)return;Z(!0);const j=C._id,S=C.cycleId,I=C.flockId||i;A(L=>L.filter(F=>F._id!==j));try{await l.deleteMovement(I,S,j,T),D(null),P("")}catch(L){console.warn("Delete request resulted in an error, but the action may have completed.",L),D(null),P(""),!((O=L.message)!=null&&O.includes("502"))&&!((V=L.message)!=null&&V.includes("504"))&&alert(L.message||"Deletion reported an error. Refreshing state...")}finally{Z(!1),d()}},We=j=>new Date(j).toLocaleDateString(B?"fa-IR":"en-US",{timeZone:"Asia/Tehran"}),It=k.find(j=>j.cycleId===n),zt=(Re=c.find(j=>j._id===i))==null?void 0:Re.name,Ke=i!=="all"&&k.length===0&&!N;return e.jsxs("div",{className:"flex flex-col gap-4 lg:gap-6 animate-in fade-in duration-500",dir:B?"rtl":"ltr",children:[i!=="all"&&n&&!Ke&&e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(Xs,{currentCycle:It,movementsCount:E.length,flockName:zt,selectedCycleId:n,isRtl:B,formatDate:We}),e.jsxs("button",{onClick:()=>b(!0),className:"px-6 py-4 bg-slate-900 text-white rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 hover:bg-black transition-all",children:[e.jsx(ut,{size:16})," ",s.bulkIngestion]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-[1.5rem] lg:rounded-[2.5rem] overflow-hidden shadow-sm flex flex-col relative",children:[e.jsx(Js,{viewMode:u,setViewMode:x,searchTerm:m,setSearchTerm:y,selectedCycleId:n,onCycleChange:p,cycles:k,loadingCycles:N,onShowDocs:()=>g(!0),isRtl:B,t:s,userRole:a}),e.jsx("div",{className:"min-h-0",children:Ke?e.jsxs("div",{className:"py-32 flex flex-col items-center justify-center text-center px-10 animate-in zoom-in-95 duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-50 text-slate-300 rounded-[2.5rem] flex items-center justify-center mb-8",children:e.jsx(Ba,{size:48,strokeWidth:1})}),e.jsx("h3",{className:"text-2xl font-black text-slate-800 uppercase tracking-tighter mb-4",children:B?"چرخه عملیاتی یافت نشد":"No Operational Cycles Detected"}),e.jsx("p",{className:"text-sm font-medium text-slate-400 uppercase tracking-widest max-w-md mb-10 leading-relaxed",children:B?"گله انتخاب شده فاقد چرخه تولید فعال است. برای شروع ثبت داده، یک چرخه جدید ایجاد کنید یا گله دیگری را انتخاب نمایید.":"The selected flock has no production cycles registered in the ledger. Please initiate a cycle or select another node to begin telemetry."}),e.jsxs("button",{onClick:()=>h(!0),className:"px-10 py-5 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-2xl shadow-blue-500/20 hover:bg-blue-700 transition-all flex items-center justify-center gap-3 active:scale-95",children:[e.jsx(Bt,{size:20})," ",B?"ایجاد اولین چرخه":"Initiate First Cycle"]})]}):u==="list"?e.jsx(ar,{movements:E,formatDate:We,onEdit:le,onDelete:D,onLock:j=>$({movement:j,type:"lock"}),onUnlock:j=>$({movement:j,type:"unlock"}),onViewHistory:Oe,userRole:a,capabilities:r}):e.jsx(sr,{loading:Nt,data:Ct})})]}),f&&e.jsx(ir,{flockId:i,cycleId:n,onClose:()=>b(!1),onSuccess:()=>{b(!1),d()},api:l}),v&&e.jsx(Wt,{flockId:i,onClose:()=>h(!1),onSuccess:()=>{h(!1),Te(),d()},api:l,t:s,isRtl:B}),ie&&e.jsx(Sa,{onClose:()=>le(null),onSubmit:()=>{le(null),d()},flocks:c,t:s,api:l,onCreateFlock:async()=>{},editingMovement:ie}),ne&&e.jsx(rr,{movement:ne,flockId:ne.flockId||i,onClose:()=>Oe(null),api:l}),C&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 max-w-md w-full shadow-2xl space-y-6 animate-in zoom-in-95 duration-300",dir:B?"rtl":"ltr",children:[e.jsxs("div",{className:"flex items-center gap-4 text-rose-600",children:[e.jsx(Me,{size:32}),e.jsx("h3",{className:"text-xl font-black uppercase",children:B?"حذف رکورد":"Delete Record"})]}),e.jsx("p",{className:"text-slate-500 font-medium leading-relaxed",children:B?"آیا از حذف دائمی این رکورد از دفتر کل اطمینان دارید؟ این عملیات قابل بازگشت نیست.":"Are you sure you want to permanently delete this record from the ledger? This action cannot be undone."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:B?"علت حذف (اختیاری)":"Deletion Reason (Optional)"}),e.jsx("textarea",{value:T,onChange:j=>P(j.target.value),placeholder:B?"علت حذف را وارد کنید...":"Enter deletion reason for audit...",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 text-xs font-medium min-h-[80px] outline-none focus:ring-4 focus:ring-rose-500/5 transition-all"})]}),e.jsxs("div",{className:"flex gap-4 pt-2",children:[e.jsx("button",{onClick:()=>{D(null),P("")},className:"flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-slate-200 transition-all",children:B?"انصراف":"Cancel"}),e.jsx("button",{disabled:re,onClick:St,className:"flex-1 py-4 bg-rose-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-rose-500/20 hover:bg-rose-700 transition-all flex items-center justify-center gap-2",children:re?e.jsx(ce,{size:14,className:"animate-spin"}):s.confirmOperation})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[200] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",dir:B?"rtl":"ltr",children:[e.jsx("h3",{className:"text-xl font-black uppercase",children:G.type==="lock"?s.verifyAndLock:s.requestUnlock}),e.jsx("textarea",{value:W,onChange:j=>se(j.target.value),placeholder:s.verificationReason,className:"w-full bg-slate-50 border rounded-2xl p-5 text-sm min-h-[120px]"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>$(null),className:"flex-1 py-4 text-slate-400 text-[10px] font-black uppercase",children:s.abort||"Abort"}),e.jsx("button",{disabled:!W.trim(),onClick:At,className:"flex-[2] py-4 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase shadow-xl disabled:opacity-30",children:s.confirmOperation})]})]})}),w&&e.jsx(Zs,{onClose:()=>g(!1)})]})};export{Mr as default};
