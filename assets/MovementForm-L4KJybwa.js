import{r as i,j as e,X as I,C as O,f as z,L as j}from"./index-eJmW9gB0.js";import{A as q}from"./arrow-left-BIuY4bw3.js";import{L as M}from"./lock-open-CUL25yl_.js";import{F as U}from"./file-text-dGVbcZgJ.js";import{S as K}from"./save-CCRvOPqh.js";const u=["adjustment","inspection","cleaning"],S={in:["purchase","transfer_in","return",...u],out:["consumption","sale_domestic","sale_export","transfer_out","spillage","wastage",...u],sale:["sale_domestic","sale_export","transfer_out",...u],mortality:["disease","feed","water","low_oxygen","temp_stress","injury",...u],adjustment:[...u]},G=({onClose:f,onSubmit:F,onCreateFlock:A,onUnlockDay:y,flocks:v=[],userRole:T,t:a})=>{const d=Array.isArray(v)?v:[],[h,x]=i.useState(d.length===0?"flock":"movement"),[s,c]=i.useState({type:"in",quantity:"",unit:"birds",flockId:d.length>0?d[0]._id:"",reason:"purchase",notes:"",confidence:"high",source:"manual_entry",value:""}),[n,g]=i.useState({name:"",capacity:"5000",startDate:new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tehran"}).format(new Date),breed:""}),[m,p]=i.useState(!1),[k,N]=i.useState(!1),[w,r]=i.useState(""),[b,C]=i.useState(""),D=T==="Admin",E=i.useMemo(()=>S[s.type]||[],[s.type]),_=async t=>{if(t.preventDefault(),!s.flockId){r(a.noFlocksAssigned);return}if(s.reason==="consumption"&&s.unit!=="kg"){r(l?"ثبت مصرف باید با واحد کیلوگرم باشد.":"Consumption must be recorded in KG.");return}if(s.type==="mortality"&&s.unit!=="birds"){r(l?"تلفات باید بر اساس قطعه پرنده باشد.":"Mortality must be recorded in Birds.");return}p(!0),r("");try{await F({...s,quantity:Number(s.quantity),value:s.value?Number(s.value):void 0}),f()}catch(o){r(o.message||"Failed to create movement")}finally{p(!1)}},L=async()=>{if(!(!y||!s.flockId||!b.trim())){N(!0);try{const t=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Tehran"}).format(new Date);await y(s.flockId,[t],b),C("")}catch(t){r(t.message||"Unlock failed")}finally{N(!1)}}},R=async t=>{t.preventDefault(),p(!0),r("");try{await A({...n,capacity:Number(n.capacity)}),x("movement")}catch(o){r(o.message||"Failed to create flock")}finally{p(!1)}},l=a.langToggle==="EN";return e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200",dir:l?"rtl":"ltr",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h==="flock"&&d.length>0&&e.jsx("button",{onClick:()=>x("movement"),className:"p-1.5 hover:bg-slate-200 rounded-lg text-slate-500 transition-colors",children:e.jsx(q,{size:18,className:l?"rotate-180":""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:h==="movement"?a.newMovement:a.addFlock}),e.jsx("p",{className:"text-[10px] font-black text-blue-600 uppercase tracking-widest mt-0.5",children:l?"کنترل عملیات گله (سرور خودکار)":"FLOCK OPERATIONS CONTROL (AUTO-TIMESTAMP)"})]})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:e.jsx(I,{size:20})})]}),e.jsx("div",{className:"max-h-[80vh] overflow-y-auto no-scrollbar",children:h==="movement"?e.jsxs("form",{onSubmit:_,className:"p-8 space-y-8",children:[w&&e.jsxs("div",{className:"bg-rose-50 text-rose-600 p-4 rounded-2xl flex items-center gap-3 text-xs font-black uppercase border border-rose-100 animate-in slide-in-from-top-2",children:[e.jsx(O,{size:18})," ",w]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:a.flock}),e.jsxs("button",{type:"button",onClick:()=>x("flock"),className:"text-[10px] font-black text-blue-600 uppercase flex items-center gap-1 hover:text-blue-700",children:[e.jsx(z,{size:10})," ",l?"جدید":"NEW"]})]}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.flockId,onChange:t=>c({...s,flockId:t.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:l?"گله هدف را انتخاب کنید":"Select Target Flock"}),d.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.type}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.type,onChange:t=>{const o=t.target.value;c({...s,type:o,reason:S[o][0],unit:o==="mortality"?"birds":o==="out"?"kg":s.unit})},children:[e.jsx("option",{value:"in",children:a.inflow}),e.jsx("option",{value:"out",children:a.outflow}),e.jsx("option",{value:"sale",children:a.sale}),e.jsx("option",{value:"mortality",children:a.mortality}),e.jsx("option",{value:"adjustment",children:a.adjustment})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.quantity}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",required:!0,step:"any",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.quantity,onChange:t=>c({...s,quantity:t.target.value}),placeholder:"0.00"}),e.jsx("div",{className:`absolute ${l?"left-4":"right-4"} top-1/2 -translate-y-1/2 text-[10px] font-black text-slate-400 uppercase bg-white px-2 py-1 rounded-lg border border-slate-100`,children:a[s.unit]||s.unit})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.unit}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.unit,onChange:t=>c({...s,unit:t.target.value}),children:[e.jsx("option",{value:"birds",children:a.birds}),e.jsx("option",{value:"kg",children:a.kg})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.operationalReason}),e.jsx("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.reason,onChange:t=>c({...s,reason:t.target.value}),children:E.map(t=>e.jsx("option",{value:t,children:a[t]||t},t))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.eventTimestamp}),e.jsx("div",{className:"w-full bg-slate-100 border border-slate-200 rounded-2xl px-4 py-4 text-xs font-bold text-slate-400 italic",children:l?"زمان به طور خودکار توسط سرور ثبت می‌شود":"Timestamp automatically handled by server"})]})]}),D&&e.jsxs("div",{className:"bg-slate-900 p-6 rounded-[2rem] border border-white/10 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h4",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2",children:[e.jsx(M,{size:14,className:"text-blue-500"})," SENTINEL LOCK OVERRULE (ADMIN)"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-xs font-medium text-white outline-none focus:ring-4 focus:ring-blue-500/10",placeholder:l?"دلیل بازگشایی امروز برای لاگ...":"Reason for today's audit log...",value:b,onChange:t=>C(t.target.value)}),e.jsx("button",{type:"button",disabled:k||!b.trim()||!s.flockId,onClick:L,className:"px-6 py-3 bg-blue-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-700 transition-all disabled:opacity-50",children:k?e.jsx(j,{size:14,className:"animate-spin"}):"Force Unlock Today"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block flex items-center gap-2",children:[e.jsx(U,{size:14,className:"text-slate-400"})," ",a.internalObservations]}),e.jsx("textarea",{rows:4,className:"w-full bg-slate-50 border border-slate-200 rounded-3xl px-6 py-4 text-sm font-medium outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm resize-none",value:s.notes,onChange:t=>c({...s,notes:t.target.value}),placeholder:l?"جزئیات عملیاتی...":"Detailed operational description for audit..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:f,className:"flex-1 py-5 border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] text-slate-500 hover:bg-slate-50 transition-all",children:a.cancel}),e.jsx("button",{type:"submit",disabled:m,className:"flex-[2] py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl hover:bg-black hover:-translate-y-0.5 transition-all flex items-center justify-center gap-3",children:m?e.jsx(j,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(K,{size:18})," ",a.saveRecord]})})]})]}):e.jsxs("form",{onSubmit:R,className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.flockName}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:n.name,onChange:t=>g({...n,name:t.target.value}),placeholder:"FLOCK-ENT-001"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.capacity}),e.jsx("input",{type:"number",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:n.capacity,onChange:t=>g({...n,capacity:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.startDate}),e.jsx("input",{type:"date",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:n.startDate,onChange:t=>g({...n,startDate:t.target.value})})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x("movement"),className:"flex-1 py-5 border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] text-slate-500",children:a.cancel}),e.jsx("button",{type:"submit",disabled:m,className:"flex-[2] py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl flex items-center justify-center gap-3",children:m?e.jsx(j,{className:"animate-spin",size:20}):a.createFlock})]})]})})]})})};export{G as default};
