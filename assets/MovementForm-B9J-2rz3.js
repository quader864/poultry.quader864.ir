import{c as R,r as n,j as e,X as M,L as S,f as ee}from"./index-eXbwFsV9.js";import{H as P,P as se}from"./package-C1hFpSZl.js";import{L as te}from"./lightbulb-Dzq5jpmH.js";import{C as ae}from"./circle-check-DQDcvGsQ.js";import{I as le}from"./info-BSE2oES5.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}],["path",{d:"M8 12h8",key:"1wcyev"}]],ce=R("circle-arrow-right",re);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],oe=R("fingerprint-pattern",ne),ue=({onClose:N,onSubmit:V,flocks:k=[],t:h,api:p,editingMovement:t})=>{var D,A;const a=h.langToggle==="EN",$=()=>new Date().toISOString().split("T")[0],[_,U]=n.useState([]),[Y,E]=n.useState(!1),[d,I]=n.useState((t==null?void 0:t.type)||""),[u,q]=n.useState((t==null?void 0:t.flockId)||((D=k[0])==null?void 0:D._id)||""),[b,T]=n.useState((t==null?void 0:t.cycleId)||""),[m,G]=n.useState(null),[y,g]=n.useState({}),[H,K]=n.useState([]),[X,L]=n.useState(!1),[B,O]=n.useState(!1),[z,v]=n.useState(!1),[j,f]=n.useState(""),[J,C]=n.useState(!1);n.useEffect(()=>{(async()=>{E(!0);try{const r=(await p.getMovementInputSchema()).data||{},o=Object.entries(r).map(([i,x])=>({id:i,label:x.label||i,description:x.description}));U(o),!t&&o.length>0&&!d&&I(o[0].id)}catch(l){console.error("Failed to load vector types",l)}finally{E(!1)}})()},[p,t]);const w=n.useCallback((s,l)=>{g(r=>{const o={...r},i=s.split(".");let x=o;for(let c=0;c<i.length-1;c++)x[i[c]]={...x[i[c]]||{}},x=x[i[c]];return x[i[i.length-1]]=l,o})},[]);n.useEffect(()=>{(async()=>{if(u){L(!0);try{const r=((await p.getCycles(u)).cycles||[]).sort((o,i)=>i.cycleId.localeCompare(o.cycleId));if(K(r),!t&&r.length>0&&!b){const o=r.find(i=>i.status==="active");T(o?o.cycleId:r[0].cycleId)}}catch(l){console.error("Cycle polling failed",l)}finally{L(!1)}}})()},[u,p,t,b]),n.useEffect(()=>{(async()=>{if(d){O(!0),f("");try{const l=await p.getMovementInputSchema(d);if(G(l.data),t&&t.type===d)g(t);else{const r={date:$(),confidence:"high"};g(r)}}catch{f(a?"دریافت ساختار داده با خطا مواجه شد":"Failed to retrieve schema")}finally{O(!1)}}})()},[d,p,t,a]);const Q=async()=>{if(d)try{const s=await p.getMovementExample(d);s.data&&g(s.data)}catch(s){console.error("Failed to load example",s)}},W=async s=>{if(s.preventDefault(),!b)return f(a?"چرخه تولید معتبری انتخاب کنید.":"Select a valid production cycle.");v(!0),f("");try{C(!0);const l=await p.validateMovementInput(d,y);if(C(!1),!l.valid){f(l.errors),v(!1);return}const r={...y,type:d,idempotencyKey:(t==null?void 0:t.idempotencyKey)||crypto.randomUUID()};t?await p.updateMovement(u,b,t._id,r):await p.createMovement(u,b,r),N(),V(r)}catch(l){f(l.message||"Registry communication failure")}finally{v(!1),C(!1)}},Z=(s,l)=>l.split(".").reduce((r,o)=>r?r[o]:void 0,s),F=(s,l)=>{var x;const r=Z(y,s.name)??"",o=s.name.split(".").pop()||"",i=a&&h[o]||s.label;return e.jsxs("div",{className:"space-y-2 group",children:[e.jsxs("div",{className:"flex justify-between items-center ml-1",children:[e.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 group-focus-within:text-blue-500 transition-colors",children:[i," ",l&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),s.hint&&e.jsxs("div",{className:"group/hint relative",children:[e.jsx(le,{size:12,className:"text-slate-300 cursor-help hover:text-blue-400 transition-colors"}),e.jsx("div",{className:`absolute bottom-full ${a?"left-0":"right-0"} mb-2 w-48 p-3 bg-slate-800 text-white text-[9px] font-medium leading-relaxed rounded-xl opacity-0 group-hover/hint:opacity-100 transition-opacity z-50 pointer-events-none shadow-xl border border-white/10`,children:s.hint})]})]}),s.type==="select"?e.jsxs("select",{value:r,onChange:c=>w(s.name,c.target.value),className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-bold uppercase outline-none focus:ring-8 focus:ring-blue-500/5 focus:bg-white transition-all shadow-sm",children:[e.jsxs("option",{value:"",children:["— ",a?"انتخاب":"SELECT"," —"]}),(x=s.options)==null?void 0:x.map(c=>e.jsx("option",{value:c,children:a&&h[c]||c.toUpperCase()},c))]}):s.type==="textarea"?e.jsx("textarea",{value:r,onChange:c=>w(s.name,c.target.value),placeholder:a?"مشاهدات خود را وارد کنید...":s.placeholder||"Enter notes...",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-medium outline-none focus:ring-8 focus:ring-blue-500/5 focus:bg-white transition-all shadow-sm min-h-[100px]"}):e.jsx("input",{type:s.type==="number"?"number":s.type==="date"?"date":s.type==="datetime"?"datetime-local":"text",value:r,onChange:c=>w(s.name,s.type==="number"?c.target.value===""?void 0:parseFloat(c.target.value):c.target.value),placeholder:s.placeholder||(s.type==="number"?"0":"..."),className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-5 py-4 text-sm font-black outline-none focus:ring-8 focus:ring-blue-500/5 focus:bg-white transition-all shadow-sm tabular-nums"})]},s.name)};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-2 sm:p-4 overflow-y-auto",dir:a?"rtl":"ltr",children:e.jsxs("div",{className:"bg-white rounded-[2rem] sm:rounded-[4rem] shadow-2xl w-full max-w-6xl my-auto animate-in zoom-in-95 duration-500 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 sm:p-10 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4 sm:gap-8",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-slate-900 text-white rounded-2xl flex items-center justify-center shadow-xl shrink-0",children:t?e.jsx(P,{size:24,className:"text-emerald-400"}):e.jsx(se,{size:24})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-black text-slate-900 uppercase tracking-tighter leading-none truncate",children:t?a?"اصلاح رکورد موجود":"AMEND RECORD":a?"ثبت جابجایی موجودی":"LOG MOVEMENT"}),e.jsxs("p",{className:"text-[8px] sm:text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] mt-1 sm:mt-3 truncate",children:["NODE PROTOCOL: ",((A=k.find(s=>s._id===u))==null?void 0:A.name)||"N/A"," • ",d.replace(/_/g," ")]})]})]}),e.jsx("button",{onClick:N,className:"p-2 sm:p-4 bg-white hover:bg-rose-50 text-slate-400 hover:text-rose-500 rounded-2xl transition-all shadow-sm",children:e.jsx(M,{size:24})})]}),e.jsxs("form",{onSubmit:W,className:"flex flex-col lg:flex-row max-h-[80vh] lg:h-[75vh] overflow-hidden",children:[e.jsxs("div",{className:"w-full lg:w-80 bg-slate-50 border-r border-slate-100 p-6 sm:p-10 space-y-6 sm:space-y-10 overflow-y-auto no-scrollbar shrink-0",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:a?"گره ناوگان":"FLEET NODE"}),e.jsx("select",{className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-xs font-black uppercase outline-none shadow-sm disabled:opacity-50",value:u,disabled:!!t,onChange:s=>q(s.target.value),children:k.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1",children:a?"چرخه حیات":"LIFECYCLE"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-xs font-black uppercase outline-none shadow-sm appearance-none disabled:opacity-50",value:b,disabled:!!t,onChange:s=>T(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:X?a?"در حال بازیابی...":"POLLING...":a?"انتخاب چرخه":"CHOOSE CYCLE"}),H.map(s=>e.jsxs("option",{value:s.cycleId,children:[s.cycleId," ",s.status==="active"?"• ACT":""]},s.cycleId))]}),e.jsx(P,{size:14,className:`absolute ${a?"left-4":"right-4"} top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none`})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:a?"نوع بردار (Vector)":"VECTOR TYPE"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:Y?e.jsxs("div",{className:"py-10 flex flex-col items-center gap-2 opacity-30",children:[e.jsx(S,{size:24,className:"animate-spin"}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Polling Types..."})]}):_.map(s=>{const l=a&&h[s.id]||s.label;return e.jsx("button",{type:"button",onClick:()=>I(s.id),disabled:!!t,className:`text-left px-4 py-3 rounded-xl text-[9px] sm:text-[10px] font-black uppercase tracking-widest transition-all ${d===s.id?"bg-blue-600 text-white shadow-lg":"bg-white text-slate-400 border border-slate-200 hover:bg-slate-100 disabled:opacity-50"}`,children:l},s.id)})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col p-6 sm:p-10 lg:p-14 overflow-y-auto no-scrollbar bg-white relative",children:B?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center gap-6 opacity-40",children:[e.jsx(S,{size:48,className:"animate-spin text-blue-600"}),e.jsx("p",{className:"text-[11px] font-black uppercase tracking-[0.5em]",children:"Synchronizing Schema..."})]}):m&&e.jsxs("div",{className:"space-y-12 animate-in fade-in duration-500",children:[j&&e.jsxs("div",{className:"bg-rose-50 text-rose-600 p-6 rounded-2xl space-y-2 border border-rose-100",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs font-black uppercase",children:[e.jsx(ee,{size:20})," ",a?"خطای اعتبارسنجی شبکه":"Validation Protocol Error"]}),e.jsx("ul",{className:`list-disc list-inside text-xs font-bold ${a?"pr-4":"pl-8"}`,children:Array.isArray(j)?j.map((s,l)=>e.jsx("li",{children:s},l)):e.jsx("li",{children:j})})]}),e.jsxs("div",{className:"bg-slate-50/50 p-8 rounded-[2.5rem] border border-slate-100 shadow-inner",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm text-blue-600 border border-slate-200",children:e.jsx(oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-black text-slate-800 uppercase tracking-tight",children:a&&h[m.type]||m.label}),e.jsx("p",{className:"text-[10px] font-medium text-slate-400 mt-1 uppercase tracking-widest",children:m.description})]})]}),e.jsxs("button",{type:"button",onClick:Q,className:"px-4 py-2 bg-white border border-slate-200 rounded-xl text-[9px] font-black uppercase tracking-widest text-blue-600 hover:bg-blue-50 transition-all flex items-center gap-2 self-start sm:self-center",children:[e.jsx(te,{size:12})," ",a?"نمونه داده":"Load Example"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:m.requiredFields.map(s=>F(s,!0))})]}),m.optionalFields.length>0&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-3 ml-2",children:[e.jsx(ce,{size:16,className:"text-slate-400"}),e.jsx("h4",{className:"text-[11px] font-black text-slate-400 uppercase tracking-widest",children:a?"جزئیات تکمیلی اختیاری":"OPTIONAL CONTEXT"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:m.optionalFields.map(s=>F(s,!1))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 sm:gap-10 pt-10 border-t border-slate-100",children:[e.jsx("div",{className:"flex-1 flex bg-slate-100 p-1.5 rounded-2xl shadow-inner min-w-[240px]",children:["high","medium","low"].map(s=>e.jsx("button",{type:"button",onClick:()=>w("confidence",s),className:`flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${y.confidence===s?"bg-white text-blue-600 shadow-xl":"text-slate-400 hover:text-slate-600"}`,children:a?h[s]:s},s))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-[2] min-w-full sm:min-w-[320px]",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 py-5 border-2 border-slate-100 rounded-2xl text-[10px] sm:text-[12px] font-black uppercase tracking-[0.2em] text-slate-400 hover:bg-slate-50 transition-all",children:a?"انصراف":"DISCARD"}),e.jsx("button",{type:"submit",disabled:z,className:"flex-[2] py-5 bg-slate-900 text-white rounded-2xl text-[10px] sm:text-[12px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all flex items-center justify-center gap-4 group",children:z||J?e.jsx(S,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:20})," ",t?a?"تایید اصلاحیه":"COMMIT AMENDMENT":a?"تایید نهایی":"COMMIT TO REGISTRY"]})})]})]})]})})]})]})})};export{ue as default};
