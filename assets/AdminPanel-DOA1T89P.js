import{c as G,r as d,j as e,Z as I,b as H,k as $,D as U,A as Z,o as A,p as V,L as T,n as W}from"./index-Boji9h6s.js";import{L as K}from"./LogicEngine-DzJCPdT5.js";import{G as q}from"./gauge-B0iEHG3C.js";import{F as B}from"./file-text-BvGyBVBS.js";import{C as J}from"./circle-check-FUip_Tmw.js";import{T as Q}from"./trending-up-CyoQ3ryj.js";import{S as Y}from"./save-4GvCUR7g.js";import"./search-BFMEyRPf.js";import"./trash-2-7jV7fanX.js";import"./download-BKvHPbTj.js";import"./clock-DTECff2T.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],f=G("rotate-ccw",O),de=({api:c,t:a})=>{var w,C,k,P,S,z,R;const[i,h]=d.useState("health"),[o,x]=d.useState(null),[j,L]=d.useState([]),[t,b]=d.useState(null),[M,m]=d.useState(!1),[v,N]=d.useState(!1),[g,n]=d.useState(null),u=a.langToggle==="EN",D=()=>c.getSystemHealth().then(x).catch(console.error),F=()=>c.getAuditLogs().then(s=>L(s.data)).catch(console.error),y=async()=>{m(!0);try{const s=await c.getAnalyticsConfig();s.success&&b(s.config)}catch(s){console.error("Config fetch failed",s)}finally{m(!1)}};d.useEffect(()=>{i==="health"?D():i==="logs"?F():i==="config"&&y()},[i]);const l=async(s,p)=>{if(t){N(!0),n(null);try{await c.updateAnalyticsConfig(s,p),b(s==="all"?p:{...t,[s]:{...t[s],...p}}),n("success"),setTimeout(()=>n(null),3e3)}catch{n("error")}finally{N(!1)}}},E=async()=>{if(window.confirm(a.resetConfirm)){m(!0);try{await c.resetAnalyticsConfig(),await y(),n("success"),setTimeout(()=>n(null),3e3)}catch{n("error")}finally{m(!1)}}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",dir:u?"rtl":"ltr",children:[e.jsx("div",{className:"flex border-b border-slate-200 bg-white px-4 sm:px-6 rounded-t-xl overflow-x-auto no-scrollbar scroll-smooth",children:[{id:"health",label:a.systemHealth,icon:e.jsx(I,{size:16})},{id:"config",label:a.globalAnalytics,icon:e.jsx(q,{size:16})},{id:"rules",label:a.detectionRules,icon:e.jsx(H,{size:16})},{id:"logs",label:a.auditTrail,icon:e.jsx(B,{size:16})}].map(s=>e.jsxs("button",{onClick:()=>h(s.id),className:`flex items-center gap-2 px-6 py-4 text-xs lg:text-sm font-bold transition-all border-b-2 whitespace-nowrap ${i===s.id?"border-blue-600 text-blue-600":"border-transparent text-slate-400 hover:text-slate-600"}`,children:[s.icon," ",s.label]},s.id))}),e.jsxs("div",{className:"bg-white rounded-b-xl border border-t-0 border-slate-200 p-4 sm:p-8 min-h-[600px]",children:[g&&e.jsxs("div",{className:`mb-6 p-4 rounded-2xl flex items-center justify-between animate-in slide-in-from-top-4 ${g==="success"?"bg-emerald-50 text-emerald-600 border border-emerald-100":"bg-rose-50 text-rose-600 border border-rose-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g==="success"?e.jsx(J,{size:18}):e.jsx($,{size:18}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:g==="success"?a.configSaved:a.configSaveError})]}),e.jsx("button",{onClick:()=>n(null),className:"p-1 hover:bg-black/5 rounded-lg",children:e.jsx(f,{size:14})})]}),i==="health"&&o&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg group",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(U,{size:12})," ",a.dbConnectivity]}),e.jsx("div",{className:`text-xl font-black ${(w=o.database)!=null&&w.connected?"text-emerald-600":"text-rose-600"}`,children:(C=o.database)!=null&&C.connected?a.operational:a.disconnected}),e.jsx("div",{className:"w-full bg-slate-200 h-1 mt-4 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${(k=o.database)!=null&&k.connected?"bg-emerald-500 w-full":"bg-rose-500 w-0"}`})})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(Z,{size:12})," ",a.pendingJobs]}),e.jsx("div",{className:"text-xl font-black text-blue-600 tabular-nums",children:((P=o.jobs)==null?void 0:P.pending)||0}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Recalculation Queue"})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(A,{size:12})," ",a.systemStatus]}),e.jsx("div",{className:"text-xl font-black text-slate-800 uppercase tracking-tighter",children:o.status}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Build Version: 2.5.4"})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(V,{size:12})," ",a.serverTime]}),e.jsx("div",{className:"text-sm font-mono text-slate-500 font-bold",children:new Date(o.timestamp).toLocaleTimeString("fa-IR",{timeZone:"Asia/Tehran"})}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Asia/Tehran Enforced"})]})]}),i==="config"&&e.jsx("div",{className:"space-y-8 max-w-5xl mx-auto",children:M?e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center gap-4 text-slate-400",children:[e.jsx(T,{className:"animate-spin",size:40}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Synchronizing Parameters..."})]}):t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(W,{size:16,className:"text-blue-600"})," ",a.pricing]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:a.foodPrice,value:t.pricing.foodPricePerKg,onChange:s=>l("pricing",{foodPricePerKg:s})}),e.jsx(r,{label:a.waterPrice,value:t.pricing.waterPricePerLiter,onChange:s=>l("pricing",{waterPricePerLiter:s})}),e.jsx(r,{label:a.medCost,value:t.pricing.medicineCostPerBird,onChange:s=>l("pricing",{medicineCostPerBird:s})}),e.jsx(r,{label:a.electricCost,value:t.pricing.electricityCostPerDay,onChange:s=>l("pricing",{electricityCostPerDay:s})}),e.jsx(r,{label:a.eggPrice,value:t.pricing.eggSellPrice,onChange:s=>l("pricing",{eggSellPrice:s})}),e.jsx(r,{label:a.birdPrice,value:t.pricing.birdSellPrice,onChange:s=>l("pricing",{birdSellPrice:s})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(Q,{size:16,className:"text-emerald-600"})," ",a.consumptionTargets]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:a.expectedFood,value:t.consumption.expectedFoodPerBirdPerDay,onChange:s=>l("consumption",{expectedFoodPerBirdPerDay:s})}),e.jsx(r,{label:a.expectedWater,value:t.consumption.expectedWaterPerBirdPerDay,onChange:s=>l("consumption",{expectedWaterPerBirdPerDay:s})}),e.jsx(r,{label:a.expectedEggs,value:t.consumption.expectedEggProductionPerBird,step:.01,onChange:s=>l("consumption",{expectedEggProductionPerBird:s})}),e.jsx(r,{label:a.expectedMortality,value:t.consumption.expectedMortalityRate,step:.001,onChange:s=>l("consumption",{expectedMortalityRate:s})})]})]}),e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(f,{size:16,className:"text-amber-600"})," Fallback Parameters"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:"Consumption Fallback (G)",value:((S=t.fallbacks)==null?void 0:S.perBirdConsumptionGrams)||70,onChange:s=>l("fallbacks",{perBirdConsumptionGrams:s})}),e.jsx(r,{label:"Mortality Fallback (%)",value:((z=t.fallbacks)==null?void 0:z.expectedMortalityRate)||.5,step:.01,onChange:s=>l("fallbacks",{expectedMortalityRate:s})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(A,{size:16,className:"text-rose-600"})," ",a.safetyThresholds]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:a.mortalityAlert,value:t.thresholds.mortalityRateAlert*100,onChange:s=>l("thresholds",{mortalityRateAlert:s/100})}),e.jsx(r,{label:a.mortalityCritical,value:t.thresholds.mortalityRateCritical*100,onChange:s=>l("thresholds",{mortalityRateCritical:s/100})}),e.jsx(r,{label:a.fcrMax,value:t.thresholds.feedConversionRatioMax,step:.1,onChange:s=>l("thresholds",{feedConversionRatioMax:s})}),e.jsx(r,{label:a.costMax,value:t.thresholds.costPerBirdMax,onChange:s=>l("thresholds",{costPerBirdMax:s})}),e.jsx(r,{label:a.profitMin,value:t.thresholds.minProfitPerBird,onChange:s=>l("thresholds",{minProfitPerBird:s})})]})]})]})]}),e.jsxs("div",{className:"pt-10 flex flex-col sm:flex-row gap-4 justify-between border-t border-slate-100",children:[e.jsxs("div",{className:"text-slate-400",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Global Policy Hash"}),e.jsxs("p",{className:"text-[9px] font-mono font-bold mt-1",children:["SHA256: 0x",((R=t.lastUpdated)==null?void 0:R.slice(-12).toUpperCase())||"SYNCING"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-6 py-3 bg-slate-50 text-slate-400 border border-slate-200 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-rose-50 hover:text-rose-600 hover:border-rose-100 transition-all",children:[e.jsx(f,{size:14})," ",a.resetDefaults]}),e.jsx("button",{onClick:()=>l("all",t),disabled:v,className:"flex items-center gap-2 px-8 py-3 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-black transition-all disabled:opacity-50",children:v?e.jsx(T,{size:14,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:14})," ",a.saveConfig]})})]})]})]})}),i==="rules"&&e.jsx(K,{api:c,t:a}),i==="logs"&&e.jsx("div",{className:"space-y-3",children:j.length===0?e.jsxs("div",{className:"py-24 text-center text-slate-300 flex flex-col items-center gap-4",children:[e.jsx(B,{size:48,className:"opacity-20"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:a.noAuditLogs})]}):e.jsx("div",{className:"overflow-hidden border border-slate-100 rounded-xl",children:j.map((s,p)=>e.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between p-4 border-b last:border-0 border-slate-50 hover:bg-slate-50 transition-colors ${u?"sm:flex-row-reverse text-right":""}`,children:[e.jsxs("div",{className:"flex items-start sm:items-center gap-4 mb-2 sm:mb-0",children:[e.jsx("div",{className:"text-[10px] font-black tabular-nums bg-slate-100 px-2 py-1 rounded-lg text-slate-500 shrink-0",children:new Date(s.timestamp).toLocaleTimeString("fa-IR",{timeZone:"Asia/Tehran"})}),e.jsxs("div",{className:`text-xs font-bold text-slate-800 ${u?"text-right":"text-left"}`,children:[e.jsx("span",{className:"text-blue-600 uppercase tracking-tighter",children:s.actorRole})," ",s.action,"d ",s.targetType]})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-mono bg-slate-50 px-2 py-1 rounded self-start sm:self-center",children:["ID: ",s.targetId.slice(-8).toUpperCase()]})]},p))})})]})]})},r=({label:c,value:a,step:i=.1,onChange:h})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:c}),e.jsx("input",{type:"number",step:i,className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-xs font-bold text-slate-800 outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all",defaultValue:a,onBlur:o=>{const x=parseFloat(o.target.value);!isNaN(x)&&x!==a&&h(x)}})]});export{de as default};
