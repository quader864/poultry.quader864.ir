import{c as O,r as n,j as e,X as A,C as w,f as E,L as j}from"./index-C3cTeMHF.js";import{S as T}from"./shield-check-Ne2-4zxh.js";import{Z as R}from"./zap-C1QX5NHY.js";import{L as M,S as U}from"./save-DckiBila.js";import{F as P}from"./file-text-DrWCzLYQ.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Y=O("arrow-left",H),S={in:["purchase","transfer_in","return","adjustment"],out:["sale_domestic","sale_export","transfer_out","adjustment"],sale:["sale_domestic","sale_export","adjustment"],mortality:["disease","feed","water","low_oxygen","temp_stress","injury","inspection","cleaning"],adjustment:["adjustment","inspection"]},W=({onClose:u,onSubmit:C,onCreateFlock:F,onUnlockDay:v,flocks:d,userRole:z,t:a})=>{const[g,h]=n.useState(d.length===0?"flock":"movement"),[s,r]=n.useState({date:new Date().toISOString().slice(0,16),type:"in",quantity:"",unit:"birds",flockId:d.length>0?d[0]._id:"",reason:"purchase",notes:"",confidence:"high",source:"manual_entry",value:""}),[l,x]=n.useState({name:"",capacity:"5000",startDate:new Date().toISOString().split("T")[0],breed:""}),[p,b]=n.useState(!1),[k,y]=n.useState(!1),[m,c]=n.useState(""),[f,N]=n.useState(""),_=z==="Admin",D=n.useMemo(()=>S[s.type]||[],[s.type]),L=async t=>{if(t.preventDefault(),!s.flockId){c(a.noFlocksAssigned);return}b(!0),c("");try{await C({...s,quantity:Number(s.quantity),value:s.value?Number(s.value):void 0,date:new Date(s.date).toISOString()}),u()}catch(i){c(i.message||"Failed to create movement")}finally{b(!1)}},q=async()=>{if(!(!v||!s.flockId||!f.trim())){y(!0);try{const t=s.date.split("T")[0];await v(s.flockId,[t],f),N("")}catch(t){c(t.message||"Unlock failed")}finally{y(!1)}}},I=async t=>{t.preventDefault(),b(!0),c("");try{await F({...l,capacity:Number(l.capacity)}),h("movement")}catch(i){c(i.message||"Failed to create flock")}finally{b(!1)}},o=a.langToggle==="EN";return e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200",dir:o?"rtl":"ltr",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g==="flock"&&d.length>0&&e.jsx("button",{onClick:()=>h("movement"),className:"p-1.5 hover:bg-slate-200 rounded-lg text-slate-500 transition-colors",children:e.jsx(Y,{size:18,className:o?"rotate-180":""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:g==="movement"?a.newMovement:a.addFlock}),e.jsx("p",{className:"text-[10px] font-black text-blue-600 uppercase tracking-widest mt-0.5",children:o?"موتور ثبت سازمانی":"Enterprise Ledger Engine"})]})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-slate-200 rounded-full text-slate-400 transition-colors",children:e.jsx(A,{size:20})})]}),e.jsx("div",{className:"max-h-[80vh] overflow-y-auto no-scrollbar",children:g==="movement"?e.jsxs("form",{onSubmit:L,className:"p-8 space-y-8",children:[m&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-2xl flex items-center gap-3 text-xs font-black uppercase border border-red-100 animate-pulse",children:[e.jsx(w,{size:18})," ",m]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:a.flock}),e.jsxs("button",{type:"button",onClick:()=>h("flock"),className:"text-[10px] font-black text-blue-600 uppercase flex items-center gap-1 hover:text-blue-700",children:[e.jsx(E,{size:10})," ",o?"جدید":"NEW"]})]}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.flockId,onChange:t=>r({...s,flockId:t.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:o?"گله هدف را انتخاب کنید":"Select Target Flock"}),d.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.type}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.type,onChange:t=>{const i=t.target.value;r({...s,type:i,reason:S[i][0]})},children:[e.jsx("option",{value:"in",children:a.inflow}),e.jsx("option",{value:"out",children:a.outflow}),e.jsx("option",{value:"sale",children:a.sale}),e.jsx("option",{value:"mortality",children:a.mortality}),e.jsx("option",{value:"adjustment",children:a.adjustment})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.quantity}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",required:!0,step:"any",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.quantity,onChange:t=>r({...s,quantity:t.target.value}),placeholder:"0.00"}),e.jsx("div",{className:`absolute ${o?"left-4":"right-4"} top-1/2 -translate-y-1/2 text-[10px] font-black text-slate-400 uppercase bg-white px-2 py-1 rounded-lg border border-slate-100`,children:a[s.unit]||s.unit})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.unit}),e.jsxs("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.unit,onChange:t=>r({...s,unit:t.target.value}),children:[e.jsx("option",{value:"birds",children:a.birds}),e.jsx("option",{value:"kg",children:a.kg})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.operationalReason}),e.jsx("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.reason,onChange:t=>r({...s,reason:t.target.value}),children:D.map(t=>e.jsx("option",{value:t,children:a[t]||t},t))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.eventTimestamp}),e.jsx("input",{type:"datetime-local",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:s.date,onChange:t=>r({...s,date:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block flex items-center gap-2",children:[e.jsx(T,{size:14,className:"text-blue-500"})," ",a.confidenceLevel]}),e.jsx("div",{className:"flex bg-slate-100 p-1 rounded-2xl border border-slate-200 gap-1",children:["high","medium","low"].map(t=>e.jsx("button",{type:"button",onClick:()=>r({...s,confidence:t}),className:`flex-1 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${s.confidence===t?"bg-white text-slate-900 shadow-md border border-slate-200":"text-slate-400 hover:text-slate-600"}`,children:a[t]||t},t))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block flex items-center gap-2",children:[e.jsx(R,{size:14,className:"text-amber-500"})," ",a.entryOrigin]}),e.jsxs("div",{className:"w-full bg-slate-100 border border-slate-200 rounded-2xl px-4 py-4 text-sm font-bold text-slate-500 flex items-center gap-2 cursor-not-allowed",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),a[s.source]||s.source.replace("_"," ")]})]})]}),_&&e.jsxs("div",{className:"bg-slate-50 p-6 rounded-[2rem] border border-slate-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-[10px] font-black text-slate-600 uppercase tracking-[0.2em] flex items-center gap-2",children:[e.jsx(M,{size:14,className:"text-blue-600"})," Sentinel Lock Overrule (Admin Only)"]}),e.jsxs("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:["Date: ",s.date.split("T")[0]]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{className:"flex-1 bg-white border border-slate-200 rounded-xl px-4 py-3 text-xs font-medium outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500",placeholder:"Unlock reason for audit log...",value:f,onChange:t=>N(t.target.value)}),e.jsx("button",{type:"button",disabled:k||!f.trim()||!s.flockId,onClick:q,className:"px-6 py-3 bg-white border border-slate-200 text-blue-600 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-50 transition-all disabled:opacity-50",children:k?e.jsx(j,{size:14,className:"animate-spin"}):"Force Unlock Date"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block flex items-center gap-2",children:[e.jsx(P,{size:14,className:"text-slate-400"})," ",a.internalObservations]}),e.jsx("textarea",{rows:4,className:"w-full bg-slate-50 border border-slate-200 rounded-3xl px-6 py-4 text-sm font-medium outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm resize-none",value:s.notes,onChange:t=>r({...s,notes:t.target.value}),placeholder:o?"شرح دقیق برای پیگیری بازرسی...":"Detailed description for audit trail..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 py-5 border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] text-slate-500 hover:bg-slate-50 transition-all",children:a.cancel}),e.jsx("button",{type:"submit",disabled:p,className:"flex-[2] py-5 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl shadow-blue-500/30 hover:bg-blue-700 hover:-translate-y-0.5 transition-all flex items-center justify-center gap-3",children:p?e.jsx(j,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx(U,{size:18})," ",a.saveRecord]})})]})]}):e.jsxs("form",{onSubmit:I,className:"p-8 space-y-8",children:[m&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-2xl flex items-center gap-3 text-xs font-black uppercase border border-red-100 animate-pulse",children:[e.jsx(w,{size:18})," ",m]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.flockName}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:l.name,onChange:t=>x({...l,name:t.target.value}),placeholder:"e.g. FLOCK-ALPHA-2025"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.capacity}),e.jsx("input",{type:"number",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-black outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:l.capacity,onChange:t=>x({...l,capacity:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.startDate}),e.jsx("input",{type:"date",required:!0,className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:l.startDate,onChange:t=>x({...l,startDate:t.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest block",children:a.breed}),e.jsx("input",{type:"text",className:"w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-bold outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all shadow-sm",value:l.breed,onChange:t=>x({...l,breed:t.target.value}),placeholder:"e.g. Cobb 500"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 py-5 border border-slate-200 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] text-slate-500 hover:bg-slate-50 transition-all",children:a.cancel}),e.jsx("button",{type:"submit",disabled:p,className:"flex-[2] py-5 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl shadow-slate-900/10 hover:bg-black hover:-translate-y-0.5 transition-all flex items-center justify-center gap-3",children:p?e.jsx(j,{className:"animate-spin",size:20}):e.jsx(e.Fragment,{children:a.createFlock})})]})]})})]})})};export{W as default};
