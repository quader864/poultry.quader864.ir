import{c as v,r as o,j as e,D as T,S as f,f as I,A as U,n as B,L as D}from"./index-eXbwFsV9.js";import{Z as V}from"./zap-nT6kNMMU.js";import{G as Z}from"./gauge-H95m17ek.js";import{C as q}from"./circle-check-DQDcvGsQ.js";import{T as J}from"./trending-up-BTe_fcKt.js";import{S as W}from"./save-BatVkUcT.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],O=v("dollar-sign",K);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],L=v("file-text",_);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],j=v("rotate-ccw",Q),re=({api:d,t})=>{var C,P,S,z,M,A,R;const[i,b]=o.useState("health"),[n,x]=o.useState(null),[N,E]=o.useState([]),[a,u]=o.useState(null),[H,m]=o.useState(!1),[y,w]=o.useState(!1),[h,c]=o.useState(null),g=t.langToggle==="EN",F=()=>d.getSystemHealth().then(x).catch(console.error),$=()=>d.getAuditLogs().then(s=>E(s.data)).catch(console.error),k=async()=>{m(!0);try{const s=await d.getAnalyticsConfig();s.success&&u(s.config)}catch(s){console.error("Config fetch failed",s)}finally{m(!1)}};o.useEffect(()=>{i==="health"?F():i==="logs"?$():i==="config"&&k()},[i]);const l=async(s,p)=>{if(a){w(!0),c(null);try{await d.updateAnalyticsConfig(s,p),u(s==="all"?p:{...a,[s]:{...a[s],...p}}),c("success"),setTimeout(()=>c(null),3e3)}catch{c("error")}finally{w(!1)}}},G=async()=>{if(window.confirm(t.resetConfirm)){m(!0);try{await d.resetAnalyticsConfig(),await k(),c("success"),setTimeout(()=>c(null),3e3)}catch{c("error")}finally{m(!1)}}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",dir:g?"rtl":"ltr",children:[e.jsx("div",{className:"flex border-b border-slate-200 bg-white px-4 sm:px-6 rounded-t-xl overflow-x-auto no-scrollbar scroll-smooth",children:[{id:"health",label:t.systemHealth,icon:e.jsx(V,{size:16})},{id:"config",label:t.globalAnalytics,icon:e.jsx(Z,{size:16})},{id:"models",label:t.resourceModels,icon:e.jsx(T,{size:16})},{id:"rules",label:t.detectionRules,icon:e.jsx(f,{size:16})},{id:"logs",label:t.auditTrail,icon:e.jsx(L,{size:16})}].map(s=>e.jsxs("button",{onClick:()=>b(s.id),className:`flex items-center gap-2 px-6 py-4 text-xs lg:text-sm font-bold transition-all border-b-2 whitespace-nowrap ${i===s.id?"border-blue-600 text-blue-600":"border-transparent text-slate-400 hover:text-slate-600"}`,children:[s.icon," ",s.label]},s.id))}),e.jsxs("div",{className:"bg-white rounded-b-xl border border-t-0 border-slate-200 p-4 sm:p-8 min-h-[400px]",children:[h&&e.jsxs("div",{className:`mb-6 p-4 rounded-2xl flex items-center justify-between animate-in slide-in-from-top-4 ${h==="success"?"bg-emerald-50 text-emerald-600 border border-emerald-100":"bg-rose-50 text-rose-600 border border-rose-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h==="success"?e.jsx(q,{size:18}):e.jsx(I,{size:18}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:h==="success"?t.configSaved:t.configSaveError})]}),e.jsx("button",{onClick:()=>c(null),className:"p-1 hover:bg-black/5 rounded-lg",children:e.jsx(j,{size:14})})]}),i==="health"&&n&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg group",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(T,{size:12})," ",t.dbConnectivity]}),e.jsx("div",{className:`text-xl font-black ${(C=n.database)!=null&&C.connected?"text-emerald-600":"text-rose-600"}`,children:(P=n.database)!=null&&P.connected?t.operational:t.disconnected}),e.jsx("div",{className:"w-full bg-slate-200 h-1 mt-4 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${(S=n.database)!=null&&S.connected?"bg-emerald-500 w-full":"bg-rose-500 w-0"}`})})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(U,{size:12})," ",t.pendingJobs]}),e.jsx("div",{className:"text-xl font-black text-blue-600 tabular-nums",children:((z=n.jobs)==null?void 0:z.pending)||0}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Recalculation Queue"})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(f,{size:12})," ",t.systemStatus]}),e.jsx("div",{className:"text-xl font-black text-slate-800 uppercase tracking-tighter",children:n.status}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Build Version: 2.5.4"})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-100 shadow-sm transition-all hover:bg-white hover:shadow-lg",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx(B,{size:12})," ",t.serverTime]}),e.jsx("div",{className:"text-sm font-mono text-slate-500 font-bold",children:new Date(n.timestamp).toLocaleTimeString("fa-IR",{timeZone:"Asia/Tehran"})}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 mt-2 uppercase",children:"Asia/Tehran Enforced"})]})]}),i==="config"&&e.jsx("div",{className:"space-y-8 max-w-5xl mx-auto",children:H?e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center gap-4 text-slate-400",children:[e.jsx(D,{className:"animate-spin",size:40}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"Synchronizing Parameters..."})]}):a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(O,{size:16,className:"text-blue-600"})," ",t.pricing]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:t.foodPrice,value:a.pricing.foodPricePerKg,onChange:s=>l("pricing",{foodPricePerKg:s})}),e.jsx(r,{label:t.waterPrice,value:a.pricing.waterPricePerLiter,onChange:s=>l("pricing",{waterPricePerLiter:s})}),e.jsx(r,{label:t.medCost,value:a.pricing.medicineCostPerBird,onChange:s=>l("pricing",{medicineCostPerBird:s})}),e.jsx(r,{label:t.electricCost,value:a.pricing.electricityCostPerDay,onChange:s=>l("pricing",{electricityCostPerDay:s})}),e.jsx(r,{label:t.eggPrice,value:a.pricing.eggSellPrice,onChange:s=>l("pricing",{eggSellPrice:s})}),e.jsx(r,{label:t.birdPrice,value:a.pricing.birdSellPrice,onChange:s=>l("pricing",{birdSellPrice:s})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(J,{size:16,className:"text-emerald-600"})," ",t.consumptionTargets]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:t.expectedFood,value:a.consumption.expectedFoodPerBirdPerDay,onChange:s=>l("consumption",{expectedFoodPerBirdPerDay:s})}),e.jsx(r,{label:t.expectedWater,value:a.consumption.expectedWaterPerBirdPerDay,onChange:s=>l("consumption",{expectedWaterPerBirdPerDay:s})}),e.jsx(r,{label:t.expectedEggs,value:a.consumption.expectedEggProductionPerBird,step:.01,onChange:s=>l("consumption",{expectedEggProductionPerBird:s})}),e.jsx(r,{label:t.expectedMortality,value:a.consumption.expectedMortalityRate,step:.001,onChange:s=>l("consumption",{expectedMortalityRate:s})})]})]}),e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(j,{size:16,className:"text-amber-600"})," Fallback Parameters"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:"Consumption Fallback (G)",value:((M=a.fallbacks)==null?void 0:M.perBirdConsumptionGrams)||70,onChange:s=>l("fallbacks",{perBirdConsumptionGrams:s})}),e.jsx(r,{label:"Mortality Fallback (%)",value:((A=a.fallbacks)==null?void 0:A.expectedMortalityRate)||.5,step:.01,onChange:s=>l("fallbacks",{expectedMortalityRate:s})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xs font-black text-slate-900 uppercase tracking-widest flex items-center gap-2 pb-2 border-b-2 border-slate-100",children:[e.jsx(f,{size:16,className:"text-rose-600"})," ",t.safetyThresholds]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(r,{label:t.mortalityAlert,value:a.thresholds.mortalityRateAlert*100,onChange:s=>l("thresholds",{mortalityRateAlert:s/100})}),e.jsx(r,{label:t.mortalityCritical,value:a.thresholds.mortalityRateCritical*100,onChange:s=>l("thresholds",{mortalityRateCritical:s/100})}),e.jsx(r,{label:t.fcrMax,value:a.thresholds.feedConversionRatioMax,step:.1,onChange:s=>l("thresholds",{feedConversionRatioMax:s})}),e.jsx(r,{label:t.costMax,value:a.thresholds.costPerBirdMax,onChange:s=>l("thresholds",{costPerBirdMax:s})}),e.jsx(r,{label:t.profitMin,value:a.thresholds.minProfitPerBird,onChange:s=>l("thresholds",{minProfitPerBird:s})})]})]})]})]}),e.jsxs("div",{className:"pt-10 flex flex-col sm:flex-row gap-4 justify-between border-t border-slate-100",children:[e.jsxs("div",{className:"text-slate-400",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:"Global Policy Hash"}),e.jsxs("p",{className:"text-[9px] font-mono font-bold mt-1",children:["SHA256: 0x",((R=a.lastUpdated)==null?void 0:R.slice(-12).toUpperCase())||"SYNCING"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-6 py-3 bg-slate-50 text-slate-400 border border-slate-200 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-rose-50 hover:text-rose-600 hover:border-rose-100 transition-all",children:[e.jsx(j,{size:14})," ",t.resetDefaults]}),e.jsx("button",{onClick:()=>l("all",a),disabled:y,className:"flex items-center gap-2 px-8 py-3 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-black transition-all disabled:opacity-50",children:y?e.jsx(D,{size:14,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:14})," ",t.saveConfig]})})]})]})]})}),i==="logs"&&e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsxs("div",{className:"py-24 text-center text-slate-300 flex flex-col items-center gap-4",children:[e.jsx(L,{size:48,className:"opacity-20"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest",children:t.noAuditLogs})]}):e.jsx("div",{className:"overflow-hidden border border-slate-100 rounded-xl",children:N.map((s,p)=>e.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center justify-between p-4 border-b last:border-0 border-slate-50 hover:bg-slate-50 transition-colors ${g?"sm:flex-row-reverse text-right":""}`,children:[e.jsxs("div",{className:"flex items-start sm:items-center gap-4 mb-2 sm:mb-0",children:[e.jsx("div",{className:"text-[10px] font-black tabular-nums bg-slate-100 px-2 py-1 rounded-lg text-slate-500 shrink-0",children:new Date(s.timestamp).toLocaleTimeString("fa-IR",{timeZone:"Asia/Tehran"})}),e.jsxs("div",{className:`text-xs font-bold text-slate-800 ${g?"text-right":"text-left"}`,children:[e.jsx("span",{className:"text-blue-600 uppercase tracking-tighter",children:s.actorRole})," ",s.action,"d ",s.targetType]})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-mono bg-slate-50 px-2 py-1 rounded self-start sm:self-center",children:["ID: ",s.targetId.slice(-8).toUpperCase()]})]},p))})}),(i==="models"||i==="rules")&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 text-blue-600 rounded-[2rem] mb-6 flex items-center justify-center shadow-inner",children:e.jsx(B,{size:40,className:"animate-spin-slow"})}),e.jsx("h3",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:t.policyEngine}),e.jsx("p",{className:"text-xs font-medium text-slate-400 max-w-sm mt-3 leading-relaxed",children:g?"ویرایشگر مدل و قوانین از یک رابط مجهز به JSON-schema برای به‌روزرسانی زنده و ایمن منطق شناسایی استفاده می‌کند.":"The model and rule editors use a JSON-schema powered interface for safe live-updates to the detection logic."}),e.jsx("button",{className:"mt-8 px-8 py-3 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all",children:t.openEditor})]})]})]})},r=({label:d,value:t,step:i=.1,onChange:b})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest block ml-1",children:d}),e.jsx("input",{type:"number",step:i,className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-xs font-bold text-slate-800 outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all",defaultValue:t,onBlur:n=>{const x=parseFloat(n.target.value);!isNaN(x)&&x!==t&&b(x)}})]});export{re as default};
